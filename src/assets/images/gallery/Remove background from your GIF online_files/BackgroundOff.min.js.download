function UploadFilesFromPreviousOperation(n,t,i){if(window.previousOperationId){showLoader();let r=window.previousOperationFileNames.reduce((n,t)=>n?`${n}&previousOperationFileNames=${encodeURIComponent(t)}`:`&previousOperationFileNames=${encodeURIComponent(t)}`,null);$.ajax({method:"GET",url:`${APIBasePath}Common/UploadFilesFromPreviousOperation?idUpload=${encodeURIComponent(window.uploadModelId)}`+`&previousOperationId=${encodeURIComponent(window.previousOperationId)}`+r+`&maxFiles=${window.uploaderMaxFilesNumber}`,dataType:"json",timeout:window.executionTimeout,success:n=>{hideLoader(),n.filter(n=>n.IsSuccess).forEach(n=>{var i=t.append(n.FileName);i&&(i.uploadFileName=n.UploadFileName)}),i&&i(n.map(n=>n.FileName))},complete:()=>{hideLoader(),btnWork&&btnWork.removeClass("hidden"),n.val("")},error:(i,r)=>{var u,f;handleError(i,r);u=n.prop("files");for(let n=0;n<u.length;n++)f=u.item(n).name,t.remove(f);n.val("")}})}}function MousePanHelper(n){function u(){i&&(t=!0,n.css("cursor","grabbing"))}function r(){i&&(t=!1,n.css("cursor","grab"))}var i=!0,t=!1;this.setEnabled=t=>{i=t||t==null,i&&n.css("cursor","grab")};n.mousedown(u);n.mouseup(r);n.mouseleave(r);n.mousemove(r=>{if(i&&t){const t=jQuery.Event("pan:changed");t.x=r.originalEvent.movementX;t.y=r.originalEvent.movementY;n.trigger(t)}});n.on("touchstart",n=>{if(i){const i=n.originalEvent.changedTouches;i.length===1&&(t={x:i[0].clientX,y:i[0].clientY})}});n.on("touchend",n=>{if(i){const i=n.originalEvent.changedTouches;i.length===1&&(t=!1)}});n.on("touchmove",r=>{if(i&&t){const i=r.originalEvent.changedTouches;if(i.length===1){const u=t;t={x:i[0].clientX,y:i[0].clientY};const r=jQuery.Event("pan:changed");r.x=t.x-u.x;r.y=t.y-u.y;n.trigger(r)}}})}function ImagePreviewContainer(n,t){function y(n){i>=b||(i*=a,l.updateUi(n),r.trigger("zoom:changed"))}function p(n){i!==1&&(i/=a,i<1&&(i=1),l.updateUi(n),r.trigger("zoom:changed"))}function o(n,t,i){if(!i)throw new Error("options is not specified");if(!i.icon)throw new Error("glyph icon is not specified");if(!i.title)throw new Error("title is not specified");if(i.toggle){if(!i.onSet)throw new Error("onSet event handler is not specified");if(!i.onReset)throw new Error("onReset event handler is not specified");}else if(!i.onClick)throw new Error("onClick event handler is not specified");const r=i.toggle?new d(i):new w(i);return t==null||t>=n.find(".glyphicon").length?n.append(r.element):t<=0?n.prepend(r.element):n.find(".glyphicon").eq(t).before(r.element),r}function w(n){this.element=$(`<span class="glyphicon glyphicon-${n.icon}" aria-hidden="true" title="${n.title}"></span>`);var i=n.icon,t=!0;this.element.click(()=>{this.click()});this.click=()=>{if(this.isEnabled())n.onClick(this.element)};this.setIcon=n=>{i!==n&&(this.element.removeClass("glyphicon-"+i),this.element.addClass("glyphicon-"+n),i=n)};this.setTitle=n=>{this.element.attr("title",n)};this.isEnabled=()=>t;this.setEnabled=n=>{(n==null&&(n=!0),t!=n)&&(t=n,t?this.element.removeClass("glyphicon-disabled"):this.element.addClass("glyphicon-disabled"))};this.isVisible=()=>!this.element.hasClass("hidden");this.isActive=()=>this.element.hasClass("glyphicon-active");this.setActive=n=>{n==null||n?this.element.addClass("glyphicon-active"):this.element.removeClass("glyphicon-active")};this.setVisible=n=>{n==null&&(n=!0),n?this.element.removeClass("hidden"):this.element.addClass("hidden")};n.enabled==null||n.enabled||this.setEnabled(!1);n.visible==null||n.visible||this.setVisible(!1);n.isActive&&this.setActive()}function d(n){function i(n,i){t.isActive()?(t.setActive(!1),i&&i(t)):(t.setActive(),n&&n(t))}const t=this;w.apply(this,arguments);this.click=()=>{this.isEnabled()&&i(n.onSet,n.onReset)};this.set=()=>{this.isActive()||this.click()};this.reset=()=>{this.isActive()&&this.click()}}var i,v;const l=this;t||(t={});t.fullscreenContainer||(t.fullscreenContainer=n);const e=$('        <div class="preview-container">            <div class="preview-wrapper">                <div class="preview-box"><\/div>            <\/div>            <div class="right-panel">            <\/div>            <div class="left-panel">            <\/div>        <\/div>\t    ');n.prepend(e);const r=e.find(".preview-box"),f=e.find(".preview-wrapper"),h=e.find(".left-panel"),c=e.find(".right-panel");i=1;const a=1.3,b=500,s={},u={x:0,y:0},k=new MousePanHelper(r);v=!0;r.on("pan:changed",n=>{u.x+=n.x,u.y+=n.y,this.updateUi()});this.getPreviewBox=()=>r;this.getPreviewContainer=()=>e;this.enablePanning=n=>{k.setEnabled(n),v=n==null||n};this.resetZoom=()=>{i=1,u.x=0,u.y=0};this.updateUi=n=>{var t;if(t=this.oldZoom!=null?i/this.oldZoom:i,this.oldZoom=i,u.x*=t,u.y*=t,n){const i=n.x-f.width()/2,r=n.y-f.height()/2;u.x-=i*(t-1);u.y-=r*(t-1)}const e=Math.max(r.width()/f.width(),r.height()/f.height());this.realScale=i/e;const o=TransformationMatrix.scale(i/e),s=TransformationMatrix.translate((-r.width()+f.width())/2,(-r.height()+f.height())/2),h=TransformationMatrix.translate(u.x,u.y),c=TransformationMatrix.compose(s,h,o);r.css("transform",TransformationMatrix.toCSS(c))};this.getScale=()=>this.realScale;this.appendButtonToLeftPanel=n=>o(h,null,n);this.prependButtonToLeftPanel=n=>o(h,0,n);this.insertButtonToLeftPanel=(n,t)=>o(h,n,t);this.appendButtonToRightPanel=n=>o(c,null,n);this.prependButtonToRightPanel=n=>o(c,0,n);this.insertButtonToRightPanel=(n,t)=>o(c,n,t);f.bind("mousewheel",n=>{(n.originalEvent.preventDefault(),n.buttons)||(n.originalEvent.wheelDelta>0?y(s):p(s))});f.mousemove(n=>{const t=f.offset();s.x=n.originalEvent.pageX-t.left;s.y=n.originalEvent.pageY-t.top});this.appendButtonToRightPanel({icon:"zoom-in",title:Resources.ImagePreviewZoomInBtn,onClick:()=>y()});this.appendButtonToRightPanel({icon:"zoom-out",title:Resources.ImagePreviewZoomOutBtn,onClick:()=>p()});this.appendButtonToRightPanel({icon:"ban-circle",title:Resources.ImagePreviewDropZoomBtn,onClick:()=>{this.resetZoom(),this.updateUi()}});this.appendButtonToRightPanel({icon:"resize-full",title:Resources.ImagePreviewFullscreenBtn,toggle:!0,onSet:n=>{n.setIcon("resize-small"),n.setTitle(Resources.ImagePreviewLeaveFullscreenBtn),t.onEnterFullscreen&&t.onEnterFullscreen(),t.fullscreenContainer.addClass("fullscreen"),$("html, body").css("overflow","hidden"),this.updateUi()},onReset:n=>{n.setIcon("resize-full"),n.setTitle(Resources.ImagePreviewFullscreenBtn),t.fullscreenContainer.removeClass("fullscreen"),t.onLeaveFullscreen&&t.onLeaveFullscreen(),$("html, body").css("overflow","initial"),this.updateUi()}})}function Slider(n){this.container=n;this.container.addClass("slider");this.container.append($('        <div class="slider-navs">            <span class="glyphicon glyphicon-circle-arrow-left slider-nav-btn slider-prev-slide" title="'+window.Resources.PrevSlide+'"><\/span>            <span class="glyphicon glyphicon-circle-arrow-right slider-nav-btn slider-next-slide" title="'+window.Resources.NextSlide+'"><\/span>        <\/div>    '));this.container.append($('        <div class="slider-slides">        <\/div>    '));this.sliderNavs=this.container.find(".slider-navs");this.slides=this.container.find(".slider-slides");this.elements=[];this.selectedSlide=-1;var t=this;this.sliderNavs.find(".slider-prev-slide").click(()=>this.prevSlide());this.sliderNavs.find(".slider-next-slide").click(()=>this.nextSlide());this.show=()=>{this.showDeny=!1,this.updateUi()};this.hide=()=>{this.showDeny=!0,this.container.addClass("hidden")};this.add=(n,t,i)=>{n&&n.element&&((t==null&&(t=this.elements.length),t<0||t>this.elements.length)||(n.element.addClass("slider-slide"),n.element.addClass("hidden"),t===this.elements.length?this.slides.append(n.element):this.slides.find(".slider-slide").eq(t).before(n.element),this.elements.splice(t,0,n),this.elements.length===1&&i==null?(this.raiseItemSelecting(this.selectedSlide,0),this.selectedSlide=0,this.raiseItemSelected()):i?this.selectedSlide!==t&&(this.raiseItemSelecting(this.selectedSlide,t),this.selectedSlide=t,this.raiseItemSelected()):this.selectedSlide>=t&&this.selectedSlide++,this.updateUi()))};this.remove=n=>{if(n==null&&(n=this.elements.length-1),!(n<0)&&!(n>=this.elements.length)){if(this.slides.find(".slider-slide").eq(n).remove(),this.elements.splice(n,1),this.selectedSlide===n){var t=this.elements.length>0?0:-1;this.raiseItemSelecting(this.selectedSlide,t);this.selectedSlide=t;this.raiseItemSelected()}else this.selectedSlide>=n&&this.selectedSlide--;this.updateUi()}};this.clear=()=>{this.raiseItemSelecting(this.selectedSlide,-1),this.slides.empty(),this.elements=[],this.selectedSlide=-1,this.updateUi(),this.raiseItemSelected()};this.nextSlide=()=>{this.selectSlide(this.selectedSlide<this.elements.length-1?this.selectedSlide+1:0)};this.prevSlide=()=>{this.selectSlide(this.selectedSlide>0?this.selectedSlide-1:this.elements.length-1)};this.selectSlide=n=>{this.selectedSlide!==n&&(this.raiseItemSelecting(this.selectedSlide,n),this.selectedSlide=n,this.updateUi(),this.raiseItemSelected())};this.raiseItemSelecting=(n,t)=>{this.onItemSelecting(this.getSlideObject(n),this.getSlideObject(t))};this.raiseItemSelected=()=>{this.onItemSelected(this.getSlideObject(this.selectedSlide))};this.getSlideObject=n=>n<0||n>=this.elements.length?null:this.elements[n];this.onItemSelecting=(n,t)=>{var i=jQuery.Event("slider:selecting");i.oldItem=n;i.newItem=t;this.container.trigger(i)};this.onItemSelected=n=>{var t=jQuery.Event("slider:selected");t.item=n;this.container.trigger(t)};this.updateUi=()=>{this.elements.length?this.showDeny||this.container.removeClass("hidden"):this.container.addClass("hidden"),this.elements.length>1?this.sliderNavs.removeClass("hidden"):this.sliderNavs.addClass("hidden"),this.slides.find(".slider-slide").each(function(n){Number(n)===Number(t.selectedSlide)?$(this).removeClass("hidden"):$(this).addClass("hidden")})};this.updateUi()}function requestImageInfo(n){if(!n)throw new Error("request options is not specified.");if(!n.uploadId)throw new Error("upload ID is not specified.");if(!n.fileName)throw new Error("file name is not specified.");if(!n.onSuccess)throw new Error("on success event handler is not specified.");if(window.UseCommonWebApi){$.ajax({method:"POST",url:`${window.APIBasePath}GetImageInfo`,data:{idMain:n.uploadId,FileName:n.fileName,Application:window.AppType},dataType:"json",timeout:window.executionTimeout,success:t=>{if(t.IsSuccess)subscribeOperationStatus({operationId:t.Payload,timeout:window.executionTimeout,onComplete:t=>{n.onSuccess(t)},onError:t=>{if(n.onError)n.onError(t)}});else if(n.onError)n.onError(t.Error,t.idError)},error:(t,i)=>{if(n.onError)n.onError(t,i)}});return}n.controllerName||(n.controllerName="Imaging");$.ajax({url:`${window.APIBasePath}${n.controllerName}/GetImageInfo?uploadId=${n.uploadId}&fileName=${encodeURIComponent(n.fileName)}&app=${window.AppType}`,dataType:"json",timeout:window.executionTimeout,success:t=>n.onSuccess(t),error:(t,i)=>{if(n.onError)n.onError(t,i)}})}function requestImagingFormats(n){if(!n)throw new Error("request options is not specified.");if(!n.method)throw new Error("method name is not specified.");if(!n.onSuccess)throw new Error("on success event handler is not specified.");n.sourceFormat||(n.sourceFormat="");let t=`${window.CommonAPIBasePath}/imaging/api/getformats?method=${n.method}`;return n.sourceFormat&&(t+=`&format=${n.sourceFormat}`),$.ajax({url:t,dataType:"json",timeout:8e5,success:t=>{if(t.isSuccess)n.onSuccess(t)}})}function subscribeOperationStatus(n){if(!n)throw new Error("request options is not specified.");if(!n.operationId)throw new Error("Operation id is not specified.");if(!n.onComplete)throw new Error("On Complete event handler is not specified.");if(!n.onError)throw new Error("On Error event handler is not specified.");if(!Number.isInteger(n.timeout)||n.timeout<=0)throw new Error("incorrect timeout");n.period||(n.period=2e3);n.delayFactor||(n.delayFactor=1.5);let t=n.period;const u=t,f=n.delayFactor;let r;setTimeout(function i(){getOperationStatus(n.operationId,n.timeout,n.apiBasePath).done((e,o,s)=>{if(s&&s.status===204)console.error(`Server is not available. Re-request will be in ${window.delayBeforeRetryRequest/1e3} seconds`),setTimeout(i,window.delayBeforeRetryRequest);else{if(e.State==="Error")n.onError(e.Payload);if(e.State==="Completed")n.onComplete(e.Payload);if(e.State==="Pending"||e.State==="Starting"||e.State==="InProgress"){if(n.onProgress)n.onProgress(e.Progress,e.State);r===e.State?t*=f:(t=u,r=e.State);setTimeout(i,t)}else n.onFinished&&n.onFinished()}}).fail((t,r)=>{if(!handleAjaxError(t,i,[204])){const i=getErrorMessage(t,r);n.onError(i)}})},t)}function chainAsyncOperation(n,t,i){const r=jQuery.Deferred();return n.done(n=>{n.IsSuccess?subscribeOperationStatus({operationId:n.Payload,timeout:t,apiBasePath:i,onProgress:()=>{},onComplete:n=>{r.resolve({IsSuccess:!0,Payload:n})},onError:n=>{r.reject(n)}}):r.reject(n.Error)}).fail((n,t)=>{r.reject(n,t)}),r.promise()}function getOperationStatus(n,t,i){return i||(i=window.APIBasePath),$.ajax({method:"GET",url:`${i}Common/GetStatus?id=${encodeURIComponent(n)}`,dataType:"json",timeout:t})}function requestPreviewImages(n){if(!n)throw new Error("request options is not specified.");if(!n.uploadId)throw new Error("upload ID cannot be empty");if(!n.fileName)throw new Error("file name cannot be empty");if(!n.onImagePrepared)throw new Error("onImagePrepared handler cannot be empty");const i=n.pageIndex?n.pageIndex+1:1,r=n.folderName?n.folderName:n.uploadId;if(window.UseCommonWebApi){requestPreviewImagesFromCommonWebApi(n);return}let t=`${window.ViewerAPIBasePath?window.ViewerAPIBasePath:window.APIBasePath}DocumentPages?file=${encodeURIComponent(n.fileName)}&folderName=${r}&currentPage=${i}`;n.flags&&(t+=Array.isArray(n.flags)?"&flags="+n.flags.join("|"):"&flags="+n.flags);$.ajax({url:t,dataType:"json",timeout:8e5,success:t=>{let i;if(t.length>1){if(n.numPages=Number(t[0]),n.onNumPages)n.onNumPages(n.numPages);const r=[];for(let i=1;i<t.length;i++){const u=JSON.parse(t[i]);u.pageIndex=i-1;prepareViewerImageInfo(u);u.numPages=n.numPages;n.onImagePrepared(u);r.push(u)}if(n.onImagesPrepared)n.onImagesPrepared(r);i=t.length-1}else{const r=JSON.parse(t[0]);r.pageIndex=n.pageIndex;i=n.pageIndex+1;prepareViewerImageInfo(r);r.numPages=n.numPages;n.onImagePrepared(r)}n.useSequence&&n.numPages&&i<n.numPages&&(n.pageIndex=i,requestPreviewImages(n))},error:(t,i)=>{if(!handleAjaxError(t,()=>{requestPreviewImages(n)})){const r=getErrorMessage(t,i);n.onError(r,t.responseJSON)}}})}function requestPreviewImagesFromCommonWebApi(n){if(!n)throw new Error("request options is not specified.");if(!n.uploadId)throw new Error("upload ID cannot be empty");if(!n.fileName)throw new Error("file name cannot be empty");if(!n.onImagePrepared)throw new Error("onImagePrepared handler cannot be empty");const t=n.pageIndex?n.pageIndex+1:1,i=n.folderName?n.folderName:n.uploadId;n.receivedPages||(n.receivedPages=0);$.ajax({method:"POST",url:`${window.APIBasePath}GetImagePreview`,data:{idMain:i,FileName:n.fileName,Application:window.AppType,CurrentPage:t,Flags:n.flags},dataType:"json",timeout:window.executionTimeout,success:t=>{if(t.IsSuccess)subscribeOperationStatus({operationId:t.Payload,timeout:window.executionTimeout,onComplete:t=>{if(n.numPages||(n.numPages=t.NumPages),n.onNumPages){n.onNumPages(n.numPages);n.onNumPages=null}const i=[];if(t.Pages&&t.Pages.length&&t.Pages.forEach(t=>{prepareViewerImageInfo(t);t.pageIndex=n.receivedPages;n.receivedPages++;t.numPages=n.numPages;n.onImagePrepared(t);i.push(t)}),n.onImagesPrepared&&i.length>1)n.onImagesPrepared(i);n.useSequence&&n.numPages&&n.receivedPages<n.numPages&&(n.pageIndex=n.receivedPages,requestPreviewImagesFromCommonWebApi(n))},onError:t=>{n.onError(t)}});else n.onError(t.Error)},error:(t,i)=>{if(!handleAjaxError(t,()=>{requestPreviewImagesFromCommonWebApi(n)})){const r=getErrorMessage(t,i);n.onError(r,t.responseJSON)}}})}function prepareViewerImageInfo(n){if(n.imageSrc=n.SharedURL?n.SharedURL:getViewerPageImageSrc(n.ImagePath),n.FileName=n.ImagePath.replace(/^.*[\\\/]/,""),n.ImageSize){var t=n.ImageSize.split("x");t.length===2&&(n.ImageWidth=Number(t[0]),n.ImageHeight=Number(t[1]))}}function getViewerPageImageSrc(n){return`${window.ViewerAPIBasePath?window.ViewerAPIBasePath:window.APIBasePath}PageImage?imagePath=${encodeURIComponent(n)}`}function getThumbnailUrl(n){if(!n)throw new Error("request options is not specified.");if(!n.uploadId)throw new Error("upload ID cannot be empty");if(!n.fileName)throw new Error("file name cannot be empty");let t=`${window.APIBasePath}Common/GetThumbnail?uploadId=${encodeURIComponent(n.uploadId)}&fileName=${encodeURIComponent(n.fileName)}`;return n.width&&Number.isInteger(n.width)&&(t+=`&width=${n.width}`),n.height&&Number.isInteger(n.height)&&(t+=`&height=${n.height}`),n.pageIndex&&Number.isInteger(n.pageIndex)&&(t+=`&pageIndex=${n.pageIndex}`),typeof n.highQuality=="boolean"&&(t+=`&highQuality=${n.highQuality}`),t}function requestImageThumbnailUrl(n){return new Promise((t,i)=>{const r={idMain:n.uploadId,FileName:n.fileName,Application:window.AppType,HighQuality:typeof n.highQuality=="boolean"?n.highQuality:!1,PageIndex:n.pageIndex&&Number.isInteger(n.pageIndex)?n.pageIndex:0};n.width&&Number.isInteger(n.width)&&(r.Width=n.width);n.height&&Number.isInteger(n.height)&&(r.Height=n.height);$.ajax({method:"POST",url:`${window.APIBasePath}GetImageThumbnail`,data:r,dataType:"json",timeout:window.executionTimeout,success:n=>{n.IsSuccess?subscribeOperationStatus({operationId:n.Payload,timeout:window.executionTimeout,onComplete:n=>{n.UploadFileName?t(n.UploadFileName):t(`${window.APIBasePath}Common/DownloadFile?id=${encodeURIComponent(n.id)}&file=${encodeURIComponent(n.FileName)}`)},onError:n=>{i(n)}}):i(n.Error)},error:(n,t)=>{i(n,t)}})})}function fetchThumbnailBlobAsUrl(n){return window.UseCommonWebApi?requestImageThumbnailUrl(n):new Promise(t=>{t(getThumbnailUrl(n))})}function handleAjaxError(n,t,i){let r=[0];return(i&&i.length&&(r=r.concat(i)),!r.includes(n.status))?!1:(console.error(`Server is not available. Re-request will be in ${window.delayBeforeRetryRequest/1e3} seconds`),setTimeout(t,window.delayBeforeRetryRequest),!0)}function PageNavigator(n){function o(){const n=t.getSelectedIndex()+1;n>=t.getCount()||t.setSelectedIndex(n)}function s(){const n=t.getSelectedIndex()-1;n<0||t.setSelectedIndex(n)}function u(t){const u=jQuery.Event("navigator:changed");u.selectedIndex=t;u.selectedPage=t>=0?n[t]:null;e.element.trigger(u);f(i,t>0);f(r,t<n.length-1)}function f(n,t){t===undefined||t?n.removeAttr("disabled"):n.attr("disabled","disabled")}const e=this;this.element=$('            <div class="page-navs">                <span class="glyphicon glyphicon-arrow-left prev-page" title="'+window.Resources.PrevPage+'" disabled><\/span>                <div class="page-selector"><\/div>                <span class="glyphicon glyphicon-arrow-right next-page" title="'+window.Resources.NextPage+'"><\/span>            <\/div>        ');const t=this.element.find(".page-selector").StyledDropdown();t.setEmptyText(Resources.PageNavigatorSelectPagePlaceholder);t.setFilterText(Resources.PageNavigatorFilterPlaceholder);t.setElements(n);t.setSelectedIndex(0);const i=this.element.find(".prev-page"),r=this.element.find(".next-page");i.click(()=>s());r.click(()=>o());this.element.find(".page-selector").on("dropdown:changed",n=>u(n.selectedIndex));this.setVisible=n=>{n==null||n?this.element.removeClass("hidden"):this.element.addClass("hidden")};this.setChanged=(n,i)=>{t.setChanged(n,i)};u(0)}function MultiPageItem(n,t,i){this.topElement=$('<div class="preview-holder"><\/div>');this.bottomElement=$("<div><\/div>");const r=$('<div class="slide-options"><\/div>'),u=$('<div class="inline-block"><\/div>'),f=$(`<h3>${t.getSlideTitle(i)}</h3>`);f.append(u);this.bottomElement.append(f);this.bottomElement.append(r);t.setContainers({previewContainer:this.topElement,optionsContainer:r,afterTitleContainer:u},i)}function MultiPageSlide(n,t,i){function c(n,t){h[t]=n;u.find(".slide-page").eq(t).append(n.topElement);f.find(".slide-page").eq(t).append(n.bottomElement)}const u=$('                    <div class="multi-page-top">                        <div class="slide-page hidden">                        <\/div>                    <\/div>'),e=$('<div class="multi-page-middle"><\/div>'),f=$('                    <div class="multi-page-bottom">                        <div class="slide-page hidden">                        <\/div>                    <\/div>');n.element.append(u);n.element.append(e);n.element.append(f);const o=!t.isCommonPageHidden(),s=o?[Resources.PageNavigatorAllPagesTitle]:[];for(let n=1;n<=i;n++)s.push(n),u.append($('<div class="slide-page hidden"><\/div>')),f.append($('<div class="slide-page hidden"><\/div>'));this.pageNav=new PageNavigator(s);e.append(this.pageNav.element);this.pageNav.element.on("navigator:changed",n=>this.setCurrentPage(n.selectedIndex));const h={};var r;n.element.on("slide:changed",n=>{if(n.pageIndex!=null)this.pageNav.setChanged(n.pageIndex,!0);else for(let n=0;n<=i;n++)this.pageNav.setChanged(n,!0)});n.element.on("slide:reset",n=>{if(n.pageIndex!=null)this.pageNav.setChanged(n.pageIndex,!1);else for(let n=0;n<=i;n++)this.pageNav.setChanged(n,!1)});this.onDisplayed=()=>{if(r!=null)t.onDisplayed(r)};this.setEnabled=n=>{r!=null&&t.setEnabled(n,r)};this.setCurrentPage=n=>{if(o||n++,!h[n]){const i=new MultiPageItem(this,t,n);c(i,n)}(r==null||r!==n)&&(this.setEnabled(!1),r=n,this.setEnabled(),u.find(".slide-page").addClass("hidden").eq(n).removeClass("hidden"),f.find(".slide-page").addClass("hidden").eq(n).removeClass("hidden"),this.onDisplayed())};t.hidePageNavigator=()=>{this.pageNav.setVisible(!1)};t.showPageNavigator=()=>{this.pageNav.setVisible()};this.setCurrentPage(0)}function SinglePageSlide(n,t){const i=$('<div class="preview-holder"><\/div>'),r=$('<div class="slide-options"><\/div>'),u=$(`<h3>${t.getSlideTitle()}</h3>`),f=$('<div class="inline-block"><\/div>');u.append(f);n.element.append(i);n.element.append(u);n.element.append(r);t.setContainers({previewContainer:i,optionsContainer:r,afterTitleContainer:f},1);this.onDisplayed=()=>{t.onDisplayed(1)};this.setEnabled=n=>{t.setEnabled(n,1)}}function ImagingSlide(n,t){this.element=$("<div><\/div>");n.setEventRouter(this.element);n.slideElement=this.element;var i;i=t>1?new MultiPageSlide(this,n,t):new SinglePageSlide(this,n);this.setError=n=>{this.element.empty(),this.element.append(n)};this.onDisplayed=()=>{i.onDisplayed()};this.setEnabled=n=>i.setEnabled(n)}function SlideContentController(n){this.setContainers=()=>{};this.getSlideTitle=()=>{};this.onDisplayed=()=>{};this.setEnabled=()=>{};var t;this.setEventRouter=n=>{t=n};this.isCommonPageHidden=()=>n.hideCommonPage!=null?n.hideCommonPage:!1;this._pageChanged=n=>{if(t){const i=jQuery.Event("slide:changed");i.pageIndex=n;t.trigger(i)}};this._pageReset=n=>{if(t){const i=jQuery.Event("slide:reset");i.pageIndex=n;t.trigger(i)}}}function PreviewSlideContentController(n){function s(){return{singlePageMode:!0,uploadId:n.uploadId,fileName:n.fileName,hasAlpha:n.hasAlpha,sharedOptions:e,slideElement:i.slideElement,onError:t=>{if(n.onError)n.onError(t)},onBusy:t=>{if(n.onBusy)n.onBusy(t)}}}function h(r){return{allPagesMode:!r,uploadId:n.uploadId,fileName:n.fileName,pageNum:r,hasAlpha:n.hasAlpha,sharedOptions:e,onError:t=>{if(n.onError)n.onError(t)},onBusy:t=>{if(n.onBusy)n.onBusy(t)},setOptionsForAllPages:()=>{for(let n=1;n<=u;n++)t[n]&&t[n].setOptions&&t[n].setOptions(i.getOptions())},onAllPagesReset:()=>{showModalDialog({title:Resources.ResetAllDlgTitle,body:Resources.ResetAllDlgBody,onConfirm:()=>{for(let n=1;n<=u;n++)i._pageReset(n),t[n]&&t[n].setOptions&&t[n].setOptions(i.getOptions(),!0);t[0]&&t[0].setDirty(!1)}})},onPageChanged:()=>{i._pageChanged(r),t[0]&&t[0].setDirty(),o()},onPageReset:()=>{i._pageReset(r),t[r].setOptions(i.getOptions()),o()},slideElement:i.slideElement,hidePageNavigator:i.hidePageNavigator,showPageNavigator:i.showPageNavigator}}function c(){requestPreviewImages({uploadId:n.uploadId,fileName:n.fileName,flags:n.viewerFlags,onImagePrepared:n=>{f(t,n)},onError:n=>{t.setError(n)}})}function l(i){requestPreviewImages({uploadId:n.uploadId,fileName:n.fileName,flags:n.viewerFlags,pageIndex:Math.max(i-1,0),onNumPages:()=>{},onImagePrepared:n=>{f(t[i],n)},onImagesPrepared:n=>{for(let i=0;i<n.length;i++)f(t[i+1],n[i])},onError:n=>{t[i].setError(n)}})}function f(n,t){n&&n.setPreviewInfo&&!n.previewInfo&&n.setPreviewInfo(t)}function o(){if(t[0]){var n=!1;for(let i=1;i<=u;i++){const r=t[i];if(r&&r.hasOwnChanges&&r.hasOwnChanges()){n=!0;break}}t[0].setDirty(n)}}if(!n)throw new Error("options is not specified.");if(!n.fileName)throw new Error("file name is not specified.");if(!n.uploadId)throw new Error("upload ID is not specified.");if(!n.contentProviderFactory)throw new Error("content provider factory is not specified.");if(typeof n.contentProviderFactory!="function")throw new Error("specified content provider factory is not a function.");SlideContentController.apply(this,arguments);const i=this,u=n.numPages?n.numPages:1,r=u>1;var t;r&&(t={});const e={};this.setContainers=(i,u)=>{if(r){const r=t[u];(r==null||r.setPreviewInfo==null)&&(t[u]=n.contentProviderFactory(i,h(u)),t[u].init&&t[u].init(),t[u].setOptions(this.getOptions()),r?t[u].setPreviewInfo(r):l(u))}else t=n.contentProviderFactory(i,s()),t.init&&t.init(),c()};this.getImageLoaded=()=>t.getImageLoaded();this.getSlideTitle=t=>t?`${n.fileName}, page ${t}`:n.fileName;this.onDisplayed=n=>{r?t[n]&&t[n].onDisplayed():t&&t.onDisplayed()};this.setEnabled=(n,i)=>{r?t[i]&&t[i].setEnabled&&t[i].setEnabled(n):t&&t.setEnabled&&t.setEnabled(n)};this.getOptions=()=>r?t[0]!=null?t[0].getOptions():null:t!=null?t.getOptions():null;this.getPageOptions=()=>{if(!r)return null;var n=[];for(let i=1;i<=u;i++)if(t[i]&&t[i].getOptions){const r=t[i].getOptions();r&&(r.pageIndex=i-1,n.push(r))}return n}}function uploadFromCloudButtonClickEventHandler(n,t,i){const u=Array.isArray(n.items)?n.items.length:Array.isArray(n.images)?n.images.length:0,r=window.uploaderMaxFilesNumber-u;r>0&&i(r,()=>{showLoader(),$("#workButton").addClass("hidden")}).then(i=>{i&&i.length&&(t?t(i):i.filter(n=>n.IsSuccess).forEach(t=>{const i=n.append(t.FileName);i&&(i.uploadFileName=t.UploadFileName)}))}).catch((t,i)=>{if(t!=="popup_closed_by_user"){handleError(t,i);const r=input.prop("files");for(let t=0;t<r.length;t++){const i=r.item(t).name;n.remove(i)}}}).always(()=>{hideLoader(),$("#workButton").removeClass("hidden")})}function saveFilesToCloudStorage(n,t,i,r,u){n&&t&&t.length&&($("#cloud-storage-msg").addClass("hidden"),$("#cloud-storage-loader").removeClass("hidden"),i().then(n=>{if(n==null||n){const n=$("#cloud-storage-msg");n.text(r);n.removeClass("hidden");n.removeClass("alert-danger");n.addClass("alert-success");n.fadeOut(100).fadeIn(100).fadeOut(100).fadeIn(100)}}).catch(()=>{const n=$("#cloud-storage-msg");n.text(u);n.removeClass("hidden");n.addClass("alert");n.addClass("alert-danger");n.removeClass("alert-success");n.fadeOut(100).fadeIn(100).fadeOut(100).fadeIn(100)}).always(()=>{$("#cloud-storage-loader").addClass("hidden")}))}function GoogleDriveService(){function i(t){const r=new $.Deferred,i=window.AcceptedExtensions?window.AcceptedExtensions.split(",").map(n=>n.trim().toLowerCase()):null,u=new google.picker.DocsView(google.picker.ViewId.DOCS_IMAGES).setIncludeFolders(!0);i&&i.length&&u.setQuery(i.map(n=>"*"+n).join("||"));u.setLabel(Resources.FilteredByExtension);const f=new google.picker.DocsView(google.picker.ViewId.DOCS);f.setIncludeFolders(!0);f.setLabel(Resources.FullContent);const e=(new google.picker.PickerBuilder).enableFeature(google.picker.Feature.MULTISELECT_ENABLED).setAppId(window.GoogleDriveAppId).setDeveloperKey(window.GoogleDriveDeveloperKey).setOAuthToken(n.oAuthToken()).addView(u).addView(f).setMaxItems(t).setOrigin(window.location.protocol+"//"+window.location.host).setLocale(window.locale).setCallback(n=>{if(n.action===google.picker.Action.PICKED){let t;if(i){const r=n.docs.filter(n=>n.name.includes(".")).map(n=>"."+n.name.split(".").pop().toLowerCase()).filter(n=>!i.includes(n)).filter((n,t,i)=>i.indexOf(n)===t).map(n=>n.replace(".","").toUpperCase());r.length&&(r.length===1?alert("File type "+r[0]+" is not supported"):alert("File types "+r.join(", ")+" are not supported"));t=n.docs.filter(n=>{if(!n.name.includes("."))return!1;const t="."+n.name.split(".").pop().toLowerCase();return i.includes(t)})}else t=n.docs;r.resolve(t)}else n.action===google.picker.Action.CANCEL&&r.resolve()}).build();return e.setVisible(!0),r}function u(){const i=new $.Deferred,t=new google.picker.DocsView(google.picker.ViewId.FOLDERS);t.setIncludeFolders(!0);t.setLabel(Resources.Directories);t.setSelectFolderEnabled(!0);const r=(new google.picker.PickerBuilder).setAppId(window.GoogleDriveAppId).setDeveloperKey(window.GoogleDriveDeveloperKey).setOAuthToken(n.oAuthToken()).addView(t).setMaxItems(1).setOrigin(window.location.protocol+"//"+window.location.host).setLocale(window.locale).setCallback(n=>{if(n.action===google.picker.Action.PICKED){let t=null;n.docs.length&&(t=n.docs[0].id);i.resolve(t)}else n.action===google.picker.Action.CANCEL&&i.resolve()}).build();return r.setVisible(!0),i}function f(t){return!t||!t.length?(new $.Deferred).resolve(!1):$.ajax({method:"POST",url:`${APIBasePath}Common/UploadFromGoogleDisk`,data:{Files:t.map(n=>({FileId:n.id,Name:n.name,MimeType:n.mimeType})),Token:n.oAuthToken(),IdUpload:window.uploadModelId},dataType:"json",timeout:window.executionTimeout})}function e(t,i,r){if(!t||!i||!r||!r.length)return(new $.Deferred).resolve(!1);const u=r.map(n=>"files="+encodeURIComponent(n)).join("&");return $.ajax({method:"POST",url:`${APIBasePath}Common/UploadToGoogleDisk?folderId=${t}&uploadId=${i}&${u}`,data:{Token:n.oAuthToken()},dataType:"json",timeout:window.executionTimeout})}function o(){let n=!1;this.load=()=>{const t=new $.Deferred;return n?t.resolve():window.gapi.load("picker",()=>{n=!0,t.resolve()}),t}}function s(){let n=null;this.auth=()=>{const t=new $.Deferred;if(n)return t.resolve(n),t;const i=google.accounts.oauth2.initTokenClient({client_id:window.GoogleDriveClientId,scope:"https://www.googleapis.com/auth/drive.file https://www.googleapis.com/auth/drive.readonly",callback:i=>{i.access_token?(n=i.access_token,t.resolve(n)):t.reject(i.error)}});return i.requestAccessToken(),t};this.oAuthToken=()=>n}function h(){let n=!1;this.createDefaultFolderIfNotExists=t=>n?(new $.Deferred).resolve(!1):$.ajax({method:"POST",url:`${APIBasePath}Common/CreateGoogleDriveFolderIfNotExist`,data:{token:t},dataType:"json",timeout:window.executionTimeout,success:()=>{n=!0}})}const t=new o,n=new s,r=new h;this.uploadFromGoogleDrive=(r,u)=>t.load().then(()=>n.auth()).then(()=>i(r)).then(n=>(n&&n.length&&u&&u(),f(n)));this.uploadFile=()=>t.load().then(()=>n.auth()).then(()=>i(1)).then(t=>t&&t.length?$.ajax({method:"GET",headers:{Authorization:"Bearer "+n.oAuthToken()},url:`https://www.googleapis.com/drive/v3/files/${t[0].id}?alt=media`}):null);this.saveToGoogleDrive=(i,f)=>!i||!f||!f.length?(new $.Deferred).resolve(!1):t.load().then(()=>n.auth()).then(n=>r.createDefaultFolderIfNotExists(n)).then(()=>u()).then(n=>e(n,i,f))}function loadGoogleDriveScripts(){return attachScript("https://apis.google.com/js/api.js").then(()=>attachScript("https://accounts.google.com/gsi/client"))}function initalizeGoogleUploadFromButton(n,t){$("#googledrive-btn").click(()=>{$("#googledrive-btn").addClass("disabled"),loadGoogleDriveScripts().then(()=>{$("#googledrive-btn").removeClass("disabled"),uploadFromCloudButtonClickEventHandler(n,t,(n,t)=>window.GoogleDriveService.uploadFromGoogleDrive(n,t)),gaEvent("Upload","from_Google_Drive")})})}function saveFilesToGoogleDrive(n,t){loadGoogleDriveScripts().then(()=>{saveFilesToCloudStorage(n,t,()=>window.GoogleDriveService.saveToGoogleDrive(n,t),Resources.GoogleDriveSuccess,Resources.GoogleDriveError),gaEvent("Result","save_to_Google_Drive")})}function getFilesFromDropbox(n){const t=new $.Deferred;return window.Dropbox.choose({success:n=>{t.resolve(n)},cancel:()=>{t.resolve()},linkType:"direct",multiselect:n,extensions:window.AcceptedExtensions?window.AcceptedExtensions.split(",").map(n=>n.trim()):null}),t}function uploadFilesFromDropbox(n,t){if(!n||!n.length)return(new $.Deferred).resolve(!1);const i=n.slice(0,t).map(n=>({Name:n.name,Link:n.link}));return $.ajax({method:"POST",url:`${APIBasePath}Common/UploadFromDropbox`,data:{Files:i,IdUpload:window.uploadModelId},dataType:"json",timeout:window.executionTimeout})}function loadDropboxScripts(){return attachScript("https://www.dropbox.com/static/api/2/dropins.js",{"data-app-key":window.DropboxAppKey,id:"dropboxjs"})}function initalizeDropboxUploadFromButton(n,t){$("#dropboxdrive-btn").click(()=>{$("#dropboxdrive-btn > svg").addClass("animatedsvg"),loadDropboxScripts().then(function(){$("#dropboxdrive-btn > svg").removeClass("animatedsvg");uploadFromCloudButtonClickEventHandler(n,t,(n,t)=>getFilesFromDropbox(n>1).then(i=>(i&&i.length&&t&&t(),uploadFilesFromDropbox(i,n))));gaEvent("Upload","from_Dropbox")})})}function saveFilesToDropbox(n,t){loadDropboxScripts().then(()=>{saveFilesToCloudStorage(n,t,()=>{const r=t.map(t=>({url:`${APIBasePath}Common/DownloadFile?id=${encodeURIComponent(n)}&file=${encodeURIComponent(t)}`,filename:decodeURIComponent(t)})),i=new $.Deferred;return window.Dropbox.save({files:r,success:()=>{i.resolve(!0)},progress:()=>{},cancel:()=>{i.resolve(!1)},error:n=>{i.reject(n)}}),i},Resources.DropboxSuccess,Resources.DropboxError),gaEvent("Result","save_to_Dropbox")})}function runObjectDetection(n){n.page||(n.page=1);const t=n.withProgress!=null?n.withProgress:!1,i=n.timeout?Number(n.timeout):8e5,r=$.ajax({method:"POST",url:`${window.ObjectDetectionAPIBasePath}DetectObjectBounds`,data:{idMain:n.idUpload,FileName:n.fileName,PageNumbers:[n.page],WithProgress:t},dataType:"json",timeout:i});return t?chainAsyncOperation(r,i,window.ObjectDetectionAPIBasePath):r}function runImageMasking(n){const t=n.withProgress!=null?n.withProgress:!1,i=n.timeout?Number(n.timeout):8e5,r=$.ajax({method:"POST",url:`${window.APIBasePath}BackgroundOff`,data:{idMain:n.idUpload,FileName:n.fileName,ToFormat:n.destFormat,PageIndex:n.page?n.page-1:0,WithProgress:t,GetResultImage:n.getResult!=null?n.getResult:!1,PrecalculateMarkers:n.precalculate!=null?n.precalculate:!1,BackgroundColor:n.backgroundColor,FeatheringRadius:n.smooth,SessionId:n.sessionId,RemoveSession:n.removeSession,AssumedObjects:n.assumedObjects,BackgroundPoints:convertPointsToMarkers(n.backgroundPoints),ForegroundPoints:convertPointsToMarkers(n.foregroundPoints),OrphanedPoints:convertPointsToMarkers(n.orphanedPoints)},dataType:"json",timeout:i});return t?chainAsyncOperation(r,i):r}function convertMarkersToPoints(n){const t=pako.inflate(new Uint8Array(hexToBytes(n.Mask)),{raw:!0}),u=t.length/n.Bounds.Height,i=[];var r=0;for(let f=0;f<n.Bounds.Height;f++){for(let u=0;u<n.Bounds.Width;u++)(t[r+Math.floor(u/8)]&1<<u%8)!=0&&i.push({X:u+n.Bounds.X,Y:f+n.Bounds.Y});r+=u}return i}function convertPointsToMarkers(n){if(!n||!n.length)return null;const t=n.minX!=null?n.minX:Math.min.apply(Math,n.map(n=>n.X)),i=n.minY!=null?n.minY:Math.min.apply(Math,n.map(n=>n.Y)),r=(n.maxX!=null?n.maxX:Math.max.apply(Math,n.map(n=>n.X)))-t+1,u=(n.maxY!=null?n.maxY:Math.max.apply(Math,n.map(n=>n.Y)))-i+1,f=Math.ceil(r/8),e=new Uint8Array(f*u);n.forEach(n=>{const u=n.Y-i,r=n.X-t;e[u*f+Math.floor(r/8)]|=1<<r%8});const o=pako.deflate(e,{raw:!0});return{Bounds:{X:t,Y:i,Width:r,Height:u},Mask:bytesToHex(o)}}function MultipleProcessingState(n,t){var i=0;this.isInProcessing=()=>i>0;this.startProcessing=()=>{!i&&n&&n(),i++};this.stopProcessing=()=>{i--,!i&&t&&t()}}function MarkersAware(n,t,i){function a(n,t,i){return t>=n.X&&t<n.X+n.Width&&i>=n.Y&&i<n.Y+n.Height}function l(){const n=[];let t=9999999,i=9999999,r=0,u=0;this.addPoint=(f,e)=>{n.push({X:f,Y:e}),t>f&&(t=f),r<f&&(r=f),i>e&&(i=e),u<e&&(u=e)};this.getArray=()=>(n.minX=t,n.maxX=r,n.minY=i,n.maxY=u,n)}const e=0,o=1,h=2,f=[];for(let i=0;i<n;i++){const n=[];for(let i=0;i<t;i++)n.push(e);f.push(n)}this.addBackgroundPoints=n=>{n&&n.forEach(n=>{f[Math.round(n.X)][Math.round(n.Y)]=o})};this.addForegroundPoints=n=>{n&&n.forEach(n=>{f[Math.round(n.X)][Math.round(n.Y)]=h})};this.addObjectRectangles=i=>{if(i)for(let r=0;r<n;r++)for(let n=0;n<t;n++)i.every(t=>!a(t,r,n))&&(f[r][n]=o)};let r={},u,s,c=!1;this.createMarker=n=>{switch(n.name){case"foregroundMarker":u=h;break;case"backgroundMarker":u=o;break;case"eraser":u=e}s=Math.round(n.width/i)};this.addRectToMarker=(i,l,a,v)=>{const g=Math.max(Math.round(i),0),nt=Math.max(Math.round(l),0),rt=Math.min(Math.round(i)+a,n-1),ut=Math.min(Math.round(l)+v,t-1),tt=rt-g,it=ut-nt,d=[];let y,p,w,b,k;if(u===e)for(p=0;p<it;p++)for(y=0;y<tt;y++)w=y+g,b=p+nt,k=`${w};${b}`,(p%s||y%s)&&f[w][b]===e&&(!r[k]||r[k]===u)||(r[k]=u,d.push({x:w,y:b}));else{const n=u===o?h:o;for(p=0;p<it;p++)for(y=0;y<tt;y++)w=y+g,b=p+nt,k=`${w};${b}`,(p%s||y%s)&&f[w][b]!==n&&(!r[k]||r[k]===u)||(r[k]=u,d.push({x:w,y:b}))}return c=!0,d.forEach(n=>f[n.x][n.y]=u),d};this.addCircleToMarker=(i,l,a)=>{const y=Math.max(Math.floor(i-a),0),p=Math.max(Math.floor(l-a),0),k=Math.min(Math.ceil(i+a),n-1),d=Math.min(Math.ceil(l+a),t-1),w=k-y,b=d-p,v=[];if(u===e)for(let n=0;n<b;n++){const t=n+p;for(let o=0;o<w;o++){const h=o+y,c=`${h};${t}`;(n%s||o%s)&&f[h][t]===e&&(!r[c]||r[c]===u)||Math.sqrt((i-h)*(i-h)+(l-t)*(l-t))<=a&&(r[c]=u,v.push({x:h,y:t}))}}else{const n=u===o?h:o;for(let t=0;t<b;t++){const e=t+p;for(let o=0;o<w;o++){const h=o+y,c=`${h};${e}`;(t%s||o%s)&&f[h][e]!==n&&(!r[c]||r[c]===u)||Math.sqrt((i-h)*(i-h)+(l-e)*(l-e))<=a&&(r[c]=u,v.push({x:h,y:e}))}}}return c=!0,v.forEach(n=>f[n.x][n.y]=u),v};this.flushMarker=()=>{const n=Object.keys(r).map(n=>{const t=n.split(";");return{value:r[n],point:{X:Number(t[0]),Y:Number(t[1])}}});return r={},c=!1,{foregroundMarker:n.filter(n=>n.value===h).map(n=>n.point),backgroundMarker:n.filter(n=>n.value===o).map(n=>n.point),eraser:n.filter(n=>n.value===e).map(n=>n.point)}};this.getAllMarkers=()=>{const i=new l,u=new l;for(let r=0;r<n;r++){const n=f[r];for(let f=0;f<t;f++)switch(n[f]){case h:i.addPoint(r,f);break;case o:u.addPoint(r,f)}}return r={},c=!1,{foregroundMarker:i.getArray(),backgroundMarker:u.getArray(),eraser:[]}};this.canClear=()=>{for(let i=0;i<n;i++){const n=f[i];for(let i=0;i<t;i++)if(n[i]!==e)return!0}return!1};this.clear=()=>{r={};c=!1;const i=new l;for(let r=0;r<n;r++){const n=f[r];for(let u=0;u<t;u++)n[u]!==e&&(n[u]=e,i.addPoint(r,u))}return{eraser:i.getArray()}};this.isDirty=()=>c}function BoundaryCollection(n){function i(){if(t.length&&n.onDirty)n.onDirty(f.isDirty())}const f=this,t=[],u=[];var r=!1;this.add=r=>{this.resetActiveElements();const f=new ObjectBoundary({collection:this,assumedObject:r,divContainer:n.divContainer,imageInfo:n.imageInfo,scaleProvider:n.scaleProvider,onDirty:i});if(t.push(f),r&&u.push(f),n.onEmpty)n.onEmpty(!1);i()};this.remove=u=>{const f=t.indexOf(u);if(!(f<0)){if(u.hasDefaultBoundary()&&(r=!0),u.remove(),t.splice(f,1),n.onEmpty)n.onEmpty(t.length===0);i()}};this.clear=()=>{if(t.length&&t.some(n=>n.hasDefaultBoundary())&&(r=!0),t.forEach(n=>n.remove()),t.splice(0,t.length),n.onEmpty)n.onEmpty(!0);i()};this.unbind=()=>{n.onEmpty=null,n.onDirty=null};this.isEmpty=()=>t.length===0;this.isDirty=()=>r||t.some(n=>n.isDirty()||!n.hasDefaultBoundary());this.resetUserChanges=()=>{if(this.isDirty()){if(r=!1,t.length&&(t.forEach(n=>n.remove()),t.splice(0,t.length)),u.length&&u.forEach(n=>{t.push(n),n.resetUserChanges(),n.setVisible()}),n.onEmpty)n.onEmpty(t.length===0);i()}};this.resetActiveElements=()=>{t.forEach(n=>n.setActive(!1))};this.getAssumedObjects=()=>t.map(n=>n.getAssumedObject());this.updateUiOnResize=()=>{t.forEach(n=>n.updateUiOnResize())}}function ObjectBoundary(n){function a(t){t==null||t?o.addClass(f):o.removeClass(f);n.onDirty()}function w(){u.css({left:t.x+"px",top:t.y+"px",width:t.width+"px",height:t.height+"px","background-position-x":-t.x+"px","background-position-y":-t.y+"px"})}function rt(i,u){i&&(n.collection.resetActiveElements(),nt.setActive(),l=i,p=u,r=Object.assign({},t),s=Object.assign({},t))}function ut(i){if(l){const r=n.scaleProvider(),u=(i.x-p.x)/r,f=(i.y-p.y)/r;ot(u,f);ht();s=Object.assign({},t);w();a()}}function ft(){l=null}function ot(n,t){switch(l){case"m":st(n,t);break;case"e":b(n);break;case"n":d(t);break;case"w":k(n);break;case"s":g(t);break;case"ne":d(t);b(n);break;case"nw":d(t);k(n);break;case"sw":g(t);k(n);break;case"se":g(t);b(n)}}function st(n,i){t.x=r.x+n;t.y=r.y+i}function b(n){t.width=r.width+n;t.width<0&&(t.width=-t.width,t.x=r.x-t.width)}function k(n){t.x=r.x+n;t.width=r.width-n;t.width<0&&(t.width=-t.width,t.x=r.x+r.width)}function d(n){t.y=r.y+n;t.height=r.height-n;t.height<0&&(t.height=-t.height,t.y=r.y+r.height)}function g(n){t.height=r.height+n;t.height<0&&(t.height=-t.height,t.y=r.y-t.height)}function ht(){const u=0,f=0,i=n.divContainer.width(),r=n.divContainer.height();i&&r&&(t.x<u?(t.width=s.width,t.x=u):t.x+t.width>i&&(t.width=s.width,t.x=i-t.width),t.y<f?(t.height=s.height,t.y=f):t.y+t.height>r&&(t.height=s.height,t.y=r-t.height),Math.round(t.width)||(t.width=1,t.x>=i-1&&t.x--),Math.round(t.height)||(t.height=1,t.y>=r-1&&t.y--))}var t,r,s,p,l;const nt=this,tt="boundbox-active",f="boundbox-btn-active",i=createUUID(),u=$(`					<div class="boundbox-container">                        <span class="boundbox-view-box"></span>                        <span class="boundbox-dashed boundbox-dashed-h"></span>                        <span class="boundbox-dashed boundbox-dashed-v"></span>                        <span class="boundbox-center"></span>                        <span class="boundbox-face boundbox-move" data-action="m" data-box-id="${i}"></span>                        <span class="boundbox-line boundbox-line-e" data-action="e" data-box-id="${i}"></span>                        <span class="boundbox-line boundbox-line-n" data-action="n" data-box-id="${i}"></span>                        <span class="boundbox-line boundbox-line-w" data-action="w" data-box-id="${i}"></span>                        <span class="boundbox-line boundbox-line-s" data-action="s" data-box-id="${i}"></span>                        <span class="boundbox-borderpoint boundbox-point-e" data-action="e" data-box-id="${i}"></span>                        <span class="boundbox-borderpoint boundbox-point-n" data-action="n" data-box-id="${i}"></span>                        <span class="boundbox-borderpoint boundbox-point-w" data-action="w" data-box-id="${i}"></span>                        <span class="boundbox-borderpoint boundbox-point-s" data-action="s" data-box-id="${i}"></span>                        <span class="boundbox-point boundbox-point-ne" data-action="ne" data-box-id="${i}"></span>                        <span class="boundbox-point boundbox-point-nw" data-action="nw" data-box-id="${i}"></span>                        <span class="boundbox-point boundbox-point-sw" data-action="sw" data-box-id="${i}"></span>                        <span class="boundbox-point boundbox-point-se" data-action="se" data-box-id="${i}"></span>                        <div class="boundbox-btn boundbox-btn-home" data-btn="home" title="${Resources.BackgroundOffBoundsHomeBtn}"><div></div></div>                        <div class="boundbox-btn boundbox-btn-person" data-btn="person" title="${Resources.BackgroundOffBoundsTypeBtn}"><div></div></div>                        <div class="boundbox-btn boundbox-btn-close ${f}" data-btn="close" title="${Resources.BackgroundOffBoundsRemoveBtn}"><div></div></div>                    </div>	        `);n.divContainer.append(u);const v=n.imageInfo.ImageWidth,y=n.imageInfo.ImageHeight;u.css({"background-image":`url("${n.imageInfo.imageSrc}")`,"background-size":`${v}px ${y}px`});const o=u.find("div.boundbox-btn").eq(0),e=u.find("div.boundbox-btn").eq(1),h=u.find("div.boundbox-btn").eq(2),c=n.assumedObject!=null;c||(o.addClass("hidden"),n.assumedObject={Bounds:{X:v/4*(1+Math.random()),Y:y/4*(1+Math.random()),Width:v/3,Height:y/3},Label:"car"});t={x:n.assumedObject.Bounds.X,y:n.assumedObject.Bounds.Y,width:n.assumedObject.Bounds.Width,height:n.assumedObject.Bounds.Height};const et=Object.assign({},t),it=n.assumedObject.Label;it==="person"&&e.addClass(f);this.setActive=n=>{n==null||n?u.addClass(tt):u.removeClass(tt)};this.setVisible=n=>{n==null||n?u.removeClass("hidden"):u.addClass("hidden")};this.isVisible=()=>!u.hasClass("hidden");this.remove=()=>{c?this.setVisible(!1):u.remove()};this.getAssumedObject=()=>({Bounds:{X:t.x,Y:t.y,Width:t.width,Height:t.height},Label:e.hasClass(f)?"person":"car"});this.isDirty=()=>o.hasClass(f);this.hasDefaultBoundary=()=>c;this.resetUserChanges=()=>{o.hasClass(f)&&(a(!1),t=Object.assign({},et),it==="person"?e.addClass(f):e.removeClass(f),w())};this.updateUiOnResize=()=>{let t=n.scaleProvider();const i=20,f=8,r=10,l=2,a=c?3:2,v=r*2+i*a+f*(a-1),y=u.width();v/t>y&&(t=v/y);t=Math.min(t,1);const s={width:i/t,height:i/t,"border-width":l/t,"border-radius":l/t,top:r/t};o.css(Object.assign({right:(r+2*(f+i))/t},s));e.css(Object.assign({right:(r+f+i)/t},s));h.css(Object.assign({right:r/t},s))};n.divContainer.on("mousedown",function(n){const t=$(n.target);t.data("box-id")===i&&rt(t.data("action"),{x:n.clientX,y:n.clientY})});n.divContainer.on("mousemove",function(n){ut({x:n.clientX,y:n.clientY})});n.divContainer.on("mouseup",ft);n.divContainer.on("touchstart",function(n){const r=$(n.target);if(r.data("box-id")===i){n.preventDefault();n.stopImmediatePropagation();const t=n.originalEvent.changedTouches;t.length===1&&rt(r.data("action"),{x:t[0].pageX,y:t[0].pageY})}});n.divContainer.on("touchmove",function(n){const r=$(n.target);if(r.data("box-id")===i){n.preventDefault();n.stopImmediatePropagation();const t=n.originalEvent.changedTouches;t.length===1&&ut({x:t[0].pageX,y:t[0].pageY})}});n.divContainer.on("touchend",ft);o.click(()=>{nt.resetUserChanges()});o.on("touchstart",()=>o.click());e.click(()=>{e.hasClass(f)?e.removeClass(f):e.addClass(f),a()});e.on("touchstart",()=>e.click());h.click(()=>{showModalDialog({title:Resources.BackgroundOffBoundsRemoveDlgTitle,body:Resources.BackgroundOffBoundsRemoveDlgBody,onConfirm:()=>{a(),n.collection.remove(this)}})});h.on("touchstart",()=>h.click());w();this.updateUiOnResize()}function BackgroundEditor(n,t){function wt(n){if(!n.detectObjects||lt||k)n.detectObjects||k?(n.assumedObjects=k?k:lt,d(n,!0,n.assumedObjects)):d(n,!0);else{b=!0;t.onProcessing(!0);t.loader.show({msg:Resources.BackgroundOffDetectionProcess,progressEmulation:{duration:6e3,period:300}});n.withProgress=!0;runObjectDetection(n).done(i=>{if(t.loader.hide(),i.IsSuccess){gaEvent("ObjectDetection","done");i.Payload.Pages.length&&i.Payload.Pages[0].DetectedObjects&&i.Payload.Pages[0].DetectedObjects.length&&(n.assumedObjects=i.Payload.Pages[0].DetectedObjects,lt=i.Payload.Pages[0].DetectedObjects);t.onProcessing(!1);d(n,!0,n.assumedObjects)}else{gaEvent("ObjectDetection","error");t.msg.showError(`${Resources.BackgroundOffDetectionError}: ${i.idError}`);b=!1;t.onProcessing(!1);needShowReportWindow(i.Error)?showReportWindow({idUpload:n.idUpload,fileName:n.fileName,msg:Resources.BackgroundOffDetectionError,explanation:Resources.ServerErrorExplanation,data1:i.Error}):showAlert(i.Error?i.Error:i.idError)}}).fail(i=>{if(!handleAjaxError(i,()=>{wt(n)})){gaEvent("ObjectDetection","error");const r=i.idError?i.idError:i,u=i.Error?i.Error:i;t.msg.showError(`${Resources.BackgroundOffDetectionError}: ${r}`);t.loader.hide();b=!1;t.onProcessing(!1);showReportWindow({idUpload:n.idUpload,fileName:n.fileName,msg:Resources.BackgroundOffDetectionError,explanation:Resources.ServerErrorExplanation,data1:u,data2:i})}});gaEvent("ObjectDetection","sent")}}function d(n,i,u){b=!0;t.onProcessing(!0);return t.loader.show({msg:Resources.BackgroundOffSegmentationProcess,progressEmulation:n.sessionId?null:{duration:2e4,period:300}}),n.withProgress=!0,gaEvent("Segmentation","sent"),runImageMasking(n).done(o=>{o.IsSuccess?(gaEvent("Segmentation","done"),w.sessionId=o.Payload.SessionId,requestPreviewImages({uploadId:t.idUpload,fileName:o.Payload.FileName,folderName:o.Payload.Folder,onImagePrepared:n=>{ot++;const c=n.SharedURL?n.SharedURL:`${n.imageSrc}&v=${ot}`;if(nt.css({background:`url("${c}")`}),i){tt.setEnabled();it.setVisible();ft.setResultViewMode();k=null;p=!0;t.onBorderStateChanged({showBounds:p,removeAllEnabled:u&&u.length>0,dirty:!1});e.previewWidth=n.ImageWidth;e.previewHeight=n.ImageHeight;e.scaleX=e.previewWidth/e.imageWidth;e.scaleY=e.previewHeight/e.imageHeight;h.prop("width",n.ImageWidth);h.prop("height",n.ImageHeight);a.prop("width",n.ImageWidth);a.prop("height",n.ImageHeight);f.clearRect(0,0,n.ImageWidth,n.ImageHeight);s=new MarkersAware(n.ImageWidth,n.ImageHeight,5);u&&(u.forEach(n=>{r.add(n)}),fi(u.map(n=>n.Bounds)));ui(o.Payload);t.onFirstProcessCompleted()}else ft.showBackground(),h.add(l).fadeOut().delay(2e3).fadeIn({complete:()=>{ft.showBackground(!1)}})}})):(gaEvent("Segmentation","error"),t.msg.showError(`${Resources.BackgroundOffSegmentationError}: ${o.idError}`),t.loader.hide(),needShowReportWindow(o.Error)?showReportWindow({idUpload:n.idUpload,fileName:n.fileName,msg:Resources.BackgroundOffSegmentationError,explanation:Resources.ServerErrorExplanation,data1:o.Error}):showAlert(o.Error?o.Error:o.idError))}).fail(t=>{handleAjaxError(t,()=>{d(n,i,u)})||(gaEvent("Segmentation","error"),needShowReportWindow(t.Error)?(showReportWindow({idUpload:window.uploadModelId,uploadedFileNames:filesToConvert,msg:errorInfo.Error.ExceptionMessage,explanation:Resources.ServerErrorExplanation,data1:errorInfo.Error}),fileUploader.replaceFiles([])):showAlert(window.getFullErrorMessage(t.Error)))}).always(()=>{t.loader.hide();b=!1;t.onProcessing(!1)})}function rt(n){n?(v.removeClass("editor-borders"),t.msg.showError([`<p>${Resources.BackgroundOffNoObjectBoundsMsg1}</p>`,`<p>${Resources.BackgroundOffNoObjectBoundsMsg2}</p>`])):(v.addClass("editor-borders"),t.msg.hide())}function ii(){r&&r.isDirty()&&showModalDialog({title:Resources.BackgroundOffBoundsApplyDlgTitle,body:Resources.BackgroundOffBoundsApplyDlgBody,onConfirm:()=>{ft.applyUserBounds()},onReject:()=>{r.resetUserChanges()}})}function kt(n){if(ut=i!=null&&!b,ut){gaEvent("Edit",i.name);st.stop();s.createMarker(i);bt=h.offset();switch(i.name){case"foregroundMarker":f.fillStyle=ct;break;case"backgroundMarker":f.fillStyle=et}gt({x:n.x*e.scaleX,y:n.y*e.scaleY})}}function at(){if(ut=!1,i&&(o&&u.clearRect(0,0,o.ImageWidth,o.ImageHeight),s&&s.isDirty())){t.onEditorDirty(!0);c&&c.isEnabled&&(c.timeout?st.start(c.timeout):vt())}}function vt(){t.onEditorDirty(!1);if(s&&s.isDirty()){const n=w.precalculate?s.getAllMarkers():s.flushMarker();if(n.foregroundMarker.length||n.backgroundMarker.length||n.eraser.length){const t=Object.assign({},w);n.foregroundMarker.length&&(t.foregroundPoints=n.foregroundMarker);n.backgroundMarker.length&&(t.backgroundPoints=n.backgroundMarker);n.eraser.length&&(t.orphanedPoints=n.eraser);d(t)}}}function ri(){s&&s.canClear()&&showModalDialog({title:Resources.BackgroundOffClearDlgTitle,body:Resources.BackgroundOffClearDlgBody,onConfirm:()=>{const n=s.clear();if(n.eraser.length){o&&f.clearRect(0,0,o.ImageWidth,o.ImageHeight);t.onEditorDirty(!1);const i=Object.assign({},w);i.orphanedPoints=n.eraser;d(i)}}})}function dt(n){const t={x:n.x*e.scaleX,y:n.y*e.scaleY};ut&&gt(t);i!=null&&ei(t)}function gt(n){const t=i.width;if(i.name==="eraser"){const i=s.addRectToMarker(n.x-t/2,n.y-t/2,t,t);f.clearRect(n.x-t/2,n.y-t/2,t,t)}else{const i=s.addCircleToMarker(n.x,n.y,t/2);f.beginPath();f.arc(n.x,n.y,t/2,0,2*Math.PI);f.fill()}}function ui(n){if(n.BackgroundPoints){f.fillStyle=et;const t=convertMarkersToPoints(n.BackgroundPoints);ni(t);s.addBackgroundPoints(t)}if(n.ForegroundPoints){f.fillStyle=ct;const t=convertMarkersToPoints(n.ForegroundPoints);ni(t);s.addForegroundPoints(t)}}function ni(n){f.beginPath();n.forEach(n=>f.rect(n.X,n.Y,1,1));f.fill()}function fi(n){n&&n.length&&(f.fillStyle=et,f.beginPath(),f.rect(0,0,o.ImageWidth,o.ImageHeight),f.fill(),n=n.map(n=>({X:n.X*e.scaleX,Y:n.Y*e.scaleY,Width:n.Width*e.scaleX,Height:n.Height*e.scaleY})),n.forEach(n=>f.clearRect(n.X,n.Y,n.Width,n.Height)),s.addObjectRectangles(n))}function ei(n){if(o){u.clearRect(0,0,o.ImageWidth,o.ImageHeight);switch(i.name){case"foregroundMarker":u.fillStyle=ct;break;case"backgroundMarker":u.fillStyle=et;break;case"eraser":u.lineWidth=3;u.strokeStyle=yt;u.strokeRect(n.x-i.width/2,n.y-i.width/2,i.width,i.width);u.strokeStyle=pt;u.strokeRect(n.x-i.width/2+2,n.y-i.width/2+2,i.width-4,i.width-4);return}u.strokeStyle=pt;u.beginPath();u.arc(n.x,n.y,i.width/2,0,2*Math.PI);u.fill();u.stroke();u.strokeStyle=yt;u.beginPath();u.arc(n.x,n.y,i.width/2+2,0,2*Math.PI);u.stroke()}}var y,c,p,r,i,o,w,ot,b,s,lt,k,ut,bt;const ft=this;n.empty();const ti=$('<div class="editor-layout editor-grid-background"><\/div>'),g=$('<div class="editor-layout hidden"><\/div>'),l=$('<div class="editor-layout editor-full-preview"><\/div>'),nt=$('<div class="editor-layout editor-segment-preview"><\/div>'),h=$('<canvas class="editor-layout editor-markers"><\/canvas>'),a=$('<canvas class="editor-layout editor-markers"><\/canvas>'),v=$('<div class="editor-layout editor-borders hidden"><\/div>'),f=h[0].getContext("2d"),u=a[0].getContext("2d");n.append(ti);n.append(g);n.append(l);n.append(nt);n.append(h);n.append(a);n.append(v);y="init";p=!1;const st=new SingleShotTimer(()=>{vt()}),ht=t.imagePreviewContainer.appendButtonToLeftPanel({icon:"picture",title:Resources.BackgroundOffShowOriginalTooltip,enabled:!0,visible:!0,isActive:!0,onClick:()=>{t.onEditorReady(!1);this.setOriginalViewMode()}}),tt=t.imagePreviewContainer.appendButtonToLeftPanel({icon:"user",title:Resources.BackgroundOffShowPreviewTooltip,enabled:!1,visible:!0,onClick:()=>{t.onEditorReady(!1);this.setResultViewMode()}}),it=t.imagePreviewContainer.appendButtonToLeftPanel({icon:"pencil",title:Resources.BackgroundOffEditModeTooltip,enabled:!0,visible:!1,onClick:()=>{t.onEditorReady(!0);this.setEditorViewMode();t.onBorderStateChanged({showBounds:p,removeAllEnabled:r!=null&&!r.isEmpty()})}}),ct="green",et="red",yt="black",pt="white";ot=0;b=!1;const e={scaleX:1,scaleY:1};this.showBackground=n=>{n==null||n?g.removeClass("hidden"):g.addClass("hidden")};this.showImage=n=>{n==null||n?(l.removeClass("hidden"),typeof n=="number"?l.css("filter",`grayscale(${n}) contrast(0.7)`):l.css("filter","initial")):l.addClass("hidden")};this.showSegment=n=>{n==null||n?nt.removeClass("hidden"):nt.addClass("hidden")};this.showMarkers=i=>{i==null||i?p?(t.imagePreviewContainer.enablePanning(!1),n.css("cursor","initial"),h.addClass("hidden"),a.addClass("hidden"),v.removeClass("hidden"),rt(r.isEmpty())):(h.removeClass("hidden"),a.removeClass("hidden"),v.addClass("hidden"),rt(!1),ii()):(t.imagePreviewContainer.enablePanning(),h.addClass("hidden"),a.addClass("hidden"),v.addClass("hidden"),rt(!1))};this.setOriginalViewMode=()=>{y!=="original"&&(y="original",ht.setActive(),tt.setActive(!1),it.setActive(!1),this.showBackground(!1),this.showImage(),this.showSegment(!1),this.showMarkers(!1))};this.setResultViewMode=()=>{y!=="result"&&(y="result",ht.setActive(!1),tt.setActive(),it.setActive(!1),this.showBackground(),this.showImage(!1),this.showSegment(),this.showMarkers(!1))};this.setEditorViewMode=()=>{y!=="editor"&&(y="editor",ht.setActive(!1),tt.setActive(!1),it.setActive(),this.showBackground(!1),this.showImage(1),this.showSegment(),this.showMarkers())};this.setBackgroundColor=n=>{n||(n="transparent");const t=tinycolor(n);t.getAlpha()?g.css({"background-color":n}):g.css({"background-color":"initial"})};this.setImage=(i,u)=>{t.msg.hide();t.onEditorReady(!1);if(this.setOriginalViewMode(),tt.setEnabled(!1),it.setVisible(!1),ot=0,o=i,n.css({width:i.ImageWidth+"px",height:i.ImageHeight+"px"}),e.imageWidth=i.ImageWidth,e.imageHeight=i.ImageHeight,l.css({background:`url("${i.imageSrc}")`}),nt.css({background:"initial"}),r&&(r.unbind(),r.clear(),r=null),r=new BoundaryCollection({divContainer:v,imageInfo:i,scaleProvider:t.imagePreviewContainer.getScale,onDirty:n=>{t.onBorderStateChanged({dirty:n})},onEmpty:n=>{t.onBorderStateChanged({removeAllEnabled:!n});n&&rt(!0)}}),u==null||u){const n=function(){const n=t.optionsProvider?t.optionsProvider():{};n.idUpload=t.idUpload;n.fileName=i.FileName;w=Object.assign({},n);wt(n)};this.getSessionId()?runImageMasking({removeSession:!0,sessionId:this.getSessionId()}).always(n):n()}};this.refresh=()=>{o&&this.setImage(o)};this.updateOnResize=()=>{r&&r.updateUiOnResize()};this.setEditorTool=r=>{if(r&&r.name==="clear"){ri();return}r&&(p=r.name==="bounds");p?(i=null,r&&this.showMarkers()):(i=r,!r&&o&&u.clearRect(0,0,o.ImageWidth,o.ImageHeight),r?(t.imagePreviewContainer.enablePanning(!1),n.css("cursor","none"),this.showMarkers()):t.imagePreviewContainer.enablePanning())};this.doBorderCommand=n=>{if(r)switch(n){case"add":r.isEmpty()&&rt(!1);r.add();break;case"removeAll":r.clear()}};this.applyChanges=()=>{vt()};this.applyUserBounds=()=>{r&&(k=r.getAssumedObjects(),this.refresh())};this.setAutoUpdateOptions=n=>{c=n,c&&c.isEnabled&&c.timeout&&st.start(c.timeout)};this.getSessionId=()=>w?w.sessionId:null;ut=!1;bt=null;n.mousedown(n=>kt({x:n.offsetX,y:n.offsetY}));n.mouseup(at);n.mouseleave(at);n.mousemove(n=>dt({x:n.offsetX,y:n.offsetY}));n.on("touchstart",i=>{i.preventDefault();i.stopImmediatePropagation();const r=i.originalEvent.changedTouches;if(r.length===1){const u=n.offset(),f=t.imagePreviewContainer.getScale();kt({x:(r[0].pageX-u.left)/f,y:(r[0].pageY-u.top)/f})}});n.on("touchend",at);n.on("touchmove",i=>{i.preventDefault();i.stopImmediatePropagation();const r=i.originalEvent.changedTouches;if(r.length===1){const u=n.offset(),f=t.imagePreviewContainer.getScale();dt({x:(r[0].pageX-u.left)/f,y:(r[0].pageY-u.top)/f})}});n.on("zoom:changed",()=>{this.updateOnResize()})}function BackgroundOffSlideContent(n,t){function c(n){i.setBackgroundColor(n)}function l(n){o.setVisible(n);r.showEditModeWidgets(n)}function a(n){o.setBorderWidgets(n);r.setBorderWidgets(n)}function v(){i.applyChanges()}function y(){i.applyUserBounds()}function p(n){i.setAutoUpdateOptions(n)}function w(){i.refresh()}function b(n){Object.assign(e,n);i.refresh()}function k(){u.updateUi();i.updateOnResize()}function d(n){function f(n){r.html(n!=null?Math.round(n)+"%":"")}function e(){t.interval&&(clearInterval(t.interval),t.interval=null)}function s(){t.progress+=t.delta;Math.round(t.progress)<100?f(t.progress):e()}const o=$('<div class="loader-inner aspose-loader-alt"><\/div>'),r=$('<span class="loader-progress"><\/span>'),u=$('<span class="loader-status"><\/span>'),i=$('<div class="bgoff-loader hidden"><\/div>');i.append(o);i.append(r);i.append(u);n.append(i);o.loaders();const t={};this.show=n=>{if(e(),i.removeClass("hidden"),!n){r.html("");u.html("");return}if(u.html(n.msg!=null?n.msg:""),n.progressEmulation&&n.progressEmulation.duration){f(0);t.progress=0;const i=n.progressEmulation.period?n.progressEmulation.period:100;t.delta=i/n.progressEmulation.duration*100;t.interval=setInterval(s,i)}else f(n.progress)};this.hide=()=>{e(),i.addClass("hidden")}}function g(n){const t=$('<span class="bgoff-msg bgoff-msg-error hidden"><\/span>');n.append(t);this.showError=n=>{t.html(n),t.removeClass("hidden")};this.hide=()=>{t.addClass("hidden")}}function nt(n,t){const i=$("<div><\/div>").ColorPicker(),h=$('\t\t\t<div class="options-div">\t\t\t\t<label>'+Resources.BackgroundOffBackgroundColorOptionTitle+"<\/label>\t\t\t<\/div>");if(h.append(i),n.append(h),i.setColor("transparent"),t.onColorChanged)i.on("color:changed",n=>{gaEvent("SetOptions","bg_color");t.onColorChanged(n.colorRgb)});const r=$('<button class="btn btn-success">'+Resources.BackgroundOffApplyBtn+"<\/button>"),u=$('<button class="btn btn-success" title="'+Resources.BackgroundOffAutoApplyTooltip+'"><span class="glyphicon glyphicon-time"><\/span><\/button>'),f=$('<div class="options-div asposeBtn apply-group hidden"><\/div>'),e=$('<button class="btn btn-success">'+Resources.BackgroundOffApplyBtn+"<\/button>");if(f.append(r),f.append(u),f.append(e),n.append(f),r.click(()=>{t.onApplyBtnClick()}),e.click(()=>{t.onApplyBoundsBtnClick()}),u.click(()=>{const r=$('<div>\t\t\t\t\t\t\t\t<input type="checkbox"/>\t\t\t\t\t\t\t\t<label>'+Resources.BackgroundOffAutoApplyParameterPart1+"<\/label>\t\t\t\t\t\t\t\t<label>"+Resources.BackgroundOffAutoApplyParameterPart2+'<\/label>\t\t\t\t\t\t\t\t<input type="number" min="0" max="30"/>\t\t\t\t\t\t\t\t<label>'+Resources.BackgroundOffAutoApplyParameterPart3+"<\/label>\t\t\t\t\t\t\t<\/div>"),i=r.find("input[type=checkbox]"),n=r.find("input[type=number]"),u=this.getAutoUpdateOptions();u.isEnabled?i.prop("checked","checked"):n.attr("disabled","disabled");n.val(u.timeout/1e3);i.change(()=>{i.is(":checked")?n.removeAttr("disabled"):n.attr("disabled","disabled")});showModalDialog({title:Resources.BackgroundOffAutoUpdateDlgTitle,body:r,onConfirm:()=>{const r={isEnabled:i.is(":checked"),timeout:Number(n.val())*1e3};window.sessionStorage.setItem("autoUpdateEnabled",r.isEnabled);window.sessionStorage.setItem("autoUpdateTimeout",r.timeout);this.updateUi();t.onAutoUpdateSet(r)}})}),t.onProcessRequested){const r=$('<button class="btn btn-success">'+Resources.BackgroundOffProcessBtn+"<\/button>"),i=$('<div class="options-div asposeBtn"><\/div>');i.append(r);n.append(i);r.click(()=>{i.addClass("hidden"),t.onProcessRequested()})}const s=$('<button class="btn btn-error">'+Resources.BackgroundOffRefreshBtn+' <span class="glyphicon glyphicon-refresh"><\/button>'),o=$('<div class="options-div asposeBtn hidden"><\/div>');o.append(s);n.append(o);s.click(()=>{showModalDialog({title:Resources.BackgroundOffRefreshDlgTitle,body:['<div><input type="checkbox" checked/><label>'+Resources.BackgroundOffDetectOption+"<\/label><\/div>",'<div><input type="checkbox" checked/><label>'+Resources.BackgroundOffPrecalcOption+"<\/label><\/div>"],onConfirm:n=>{t.onReProcessRequested({detectObjects:n.find("input[type=checkbox]").eq(0).is(":checked"),precalculate:n.find("input[type=checkbox]").eq(1).is(":checked")})}})});this.getBackgroundColor=()=>i.getColor();this.setBackgroundColor=n=>i.setColor(n);this.getAutoUpdateOptions=()=>{var t=window.sessionStorage.getItem("autoUpdateEnabled"),n;return t=t==null?!0:t!=="false",n=window.sessionStorage.getItem("autoUpdateTimeout"),n=n==null?1e4:Number(n),{isEnabled:t,timeout:n}};var c=!1;this.showEditModeWidgets=n=>{n==null||n?(f.removeClass("hidden"),o.addClass("hidden")):(f.addClass("hidden"),c&&o.removeClass("hidden"))};this.setBtnApplyEnabled=n=>{n==null||n?r.removeClass("disabled").removeAttr("disabled"):r.addClass("disabled").attr("disabled","disabled")};this.setBtnRefreshVisible=n=>{n==null||n?(c=!0,o.removeClass("hidden")):o.addClass("hidden")};this.setBtnRefreshEnabled=n=>{n==null||n?s.removeClass("disabled").removeAttr("disabled"):s.addClass("disabled").attr("disabled","disabled")};this.setBorderWidgets=n=>{n.showBounds!=null&&(n.showBounds?(r.addClass("hidden"),u.addClass("hidden"),e.removeClass("hidden")):(r.removeClass("hidden"),u.removeClass("hidden"),e.addClass("hidden"))),n.dirty!=null&&(n.dirty?e.removeClass("disabled").removeAttr("disabled"):e.addClass("disabled").attr("disabled","disabled"))};this.updateUi=()=>{i.updateUi(),this.getAutoUpdateOptions().isEnabled?u.find("span").addClass("active"):u.find("span").removeClass("active")};this.updateUi();this.setBtnApplyEnabled(!1)}function tt(n,t){function l(){h.find("div").removeClass(c);i=null;f.removeClass("glyphicon-chevron-up");f.addClass("glyphicon-chevron-down");r.addClass("collapsed hidden");u.addClass("hidden")}function v(n){n.each(function(){var t=!1;const n=()=>{const n=(this.value-this.min)/(this.max-this.min)*100;this.style.setProperty("--webkitProgressPercent",`${n}%`)},r=()=>{t&&n()},i=()=>t=!1,u=()=>t=!0;this.addEventListener("mousemove",r);this.addEventListener("mousedown",u);this.addEventListener("mouseup",i);this.addEventListener("mouseleave",i);this.addEventListener("click",n);$(this).on("touchmove",r);$(this).on("touchstart",u);$(this).on("touchend",i);$(this).on("rangebar:updated",n);n()})}const a=this,s=$('<div class="editor-tools hidden"><\/div>'),h=$('<div class="tools-panel">\t\t\t\t\t\t\t\t<div title="'+Resources.BackgroundOffBoundsTool+'" data-tool="bounds" data-class="btn1"><\/div>\t\t\t\t\t\t\t\t<div title="'+Resources.BackgroundOffForegroundTool+'" data-tool="foregroundMarker" data-class="btn2"><\/div>\t\t\t\t\t\t\t\t<div title="'+Resources.BackgroundOffBackgroundTool+'" data-tool="backgroundMarker" data-class="btn3"><\/div>\t\t\t\t\t\t\t\t<div title="'+Resources.BackgroundOffEraserTool+'" data-tool="eraser" data-class="btn4"><\/div>\t\t\t\t\t\t\t\t<div title="'+Resources.BackgroundOffClearTool+'" data-tool="clear" data-class="btn5"><\/div>\t\t\t\t\t\t\t<\/div>'),r=$('<div class="options-panel collapsed hidden"><\/div>'),f=$('<span class="expander glyphicon glyphicon-chevron-down"><\/span>'),e=$('<input type="range" min="1" max="50" value="50" title="'+Resources.BackgroundOffBrushSize+'"/>');v(e);r.append(f);r.append(e);s.append(h);s.append(r);n.append(s);const u=$('<div class="options-panel bounds-panel btn1 hidden"><\/div>');u.append($('<div class="simpleBtn addBtn" title = "'+Resources.BackgroundOffBoundsAddBtn+'"><\/div>'));u.append($('<div class="simpleBtn removeBtn" title = "'+Resources.BackgroundOffBoundsRemoveAllBtn+'"><\/div>'));s.append(u);var i=null;const o={foregroundMarker:10,backgroundMarker:10,eraser:25};e.on("change",()=>{if(i){o[i]=Number(e.val());window.sessionStorage.setItem(i,o[i]);t.onToolChanged(this.getCurrentTool())}});const c="active-tool";h.find("div").slice(0,4).click(function(){const n=$(this);if(n.hasClass(c))l();else{h.find("div").removeClass(c);n.addClass(c);const t=n.data("tool");t==="bounds"?(r.addClass("hidden"),l(),u.removeClass("hidden"),n.addClass(c),i=t):(r.removeClass("btn1 btn2 btn3 btn4"),r.addClass(n.data("class")),i&&i!=="bounds"||(r.removeClass("hidden"),u.addClass("hidden")),i=t,e.val(o[i]),e.trigger("rangebar:updated"))}t.onToolChanged(a.getCurrentTool())});h.find("div").eq(4).click(function(){t.onToolChanged({name:$(this).data("tool")})});u.find(".addBtn").click(()=>{t.onBorderCommand("add")});u.find(".removeBtn").click(function(){$(this).hasClass("disabled")||showModalDialog({title:Resources.BackgroundOffBoundsRemoveAllDlgTitle,body:Resources.BackgroundOffBoundsRemoveAllDlgBody,onConfirm:()=>{t.onBorderCommand("removeAll")}})});f.click(()=>{r.hasClass("collapsed")?(r.removeClass("collapsed"),f.removeClass("glyphicon-chevron-down"),f.addClass("glyphicon-chevron-up")):(r.addClass("collapsed"),f.removeClass("glyphicon-chevron-up"),f.addClass("glyphicon-chevron-down"))});this.isVisible=()=>!this.element.hasClass("hidden");this.setVisible=n=>{if(n==null&&(n=!0),n)s.removeClass("hidden");else{l();t.onToolChanged(null);s.addClass("hidden")}};this.setBorderWidgets=n=>{n.showBounds!=null&&(n.showBounds?(i="bounds",r.addClass("hidden"),l(),u.removeClass("hidden"),h.find("div").eq(0).addClass(c)):i==="bounds"&&l()),n.removeAllEnabled!=null&&(n.removeAllEnabled?u.find(".removeBtn").removeClass("disabled"):u.find(".removeBtn").addClass("disabled"))};this.getCurrentTool=()=>i?{name:i,width:o[i]}:null;this.restoreValues=()=>{const n=window.sessionStorage.getItem("foregroundMarker");n&&(o.foregroundMarker=Number(n));const t=window.sessionStorage.getItem("backgroundMarker");t&&(o.backgroundMarker=Number(t));const r=window.sessionStorage.getItem("eraser");r&&(o.eraser=Number(r));i&&(e.val(o[i]),e.trigger("rangebar:updated"))};this.restoreValues()}n.previewContainer.addClass("bgoff-preview");n.optionsContainer.addClass("bgoff-options");var f=!1;const u=new ImagePreviewContainer(n.previewContainer,{fullscreenContainer:t.slideElement,onEnterFullscreen:()=>{gaEvent("Fullscreen","enter"),t.hidePageNavigator&&t.hidePageNavigator()},onLeaveFullscreen:()=>{gaEvent("Fullscreen","leave"),t.showPageNavigator&&t.showPageNavigator()}});addEvent(window,"resize",k);const s=new d(n.previewContainer),h=new g(n.previewContainer),r=new nt(n.optionsContainer,{onColorChanged:c,onApplyBtnClick:v,onApplyBoundsBtnClick:y,onAutoUpdateSet:p,onProcessRequested:t.singlePageMode?null:w,onReProcessRequested:b}),e={detectObjects:!0,precalculate:!0,smooth:2},i=new BackgroundEditor(u.getPreviewBox(),{idUpload:t.uploadId,optionsProvider:()=>Object.assign({},e),imagePreviewContainer:u,loader:s,msg:h,onEditorReady:l,onEditorDirty:n=>{r.setBtnApplyEnabled(n)},onFirstProcessCompleted:()=>{r.setBtnRefreshVisible()},onProcessing:n=>{r.setBtnRefreshEnabled(!n);t.onBusy(n)},onBorderStateChanged:a}),o=new tt(u.getPreviewContainer(),{onToolChanged:n=>{i.setEditorTool(n),r.setBorderWidgets({showBounds:n&&n.name==="bounds"})},onBorderCommand:n=>i.doBorderCommand(n)});this.init=()=>{};this.setEnabled=()=>{};this.setDirty=n=>{t.singlePageMode||(f=n==null||n)};this.setError=n=>{t.onError(n);h.showError(n);s.hide()};this.onDisplayed=()=>{u.updateUi(),o.restoreValues(),i.setAutoUpdateOptions(r.getAutoUpdateOptions()),r.updateUi()};this.getOptions=()=>{const n=i.getSessionId();return n?{SessionId:n,BackgroundColor:r.getBackgroundColor().colorHex,Smooth:e.smooth}:null};this.setOptions=(n,t)=>{(!f||t)&&f&&(f=!1)};this.hasOwnChanges=()=>f;this.setPreviewInfo=n=>{n&&(this.previewInfo=n,i.setImage(n,t.singlePageMode!=null&&t.singlePageMode),u.resetZoom(),u.updateUi())};window.genericBackgroundColor&&r.setBackgroundColor(window.genericBackgroundColor)}function registerFileUpload(n,t,i){n.ajaxForm({url:`${APIBasePath}Common/UploadMultipleFiles`,dataType:"json",beforeSend:()=>{btnWork.addClass("hidden"),showLoader(0)},success:n=>{hideLoader(),n.filter(n=>n.IsSuccess).forEach(n=>{const t=i.append(n.FileName);t&&(t.uploadFileName=n.UploadFileName)}),SEONavigate("uploaded"),hideAlert(),t.val("")},uploadProgress:(n,t,i,r)=>{showLoader(r)},complete:()=>{btnWork.removeClass("hidden"),urlUploader.hideUrlPanel()},error:(n,t)=>i.handleUploadError(n,t)})}function AssignSaveAsDropdown(n){gaEvent("SetOptions","dest_format");const t=$(n).text(),i=$(n).data("format");$("#btnSaveAs").html(t+getIconHtmlCode("sym-icon sym-icon-dropdown","caret-down"));$("#format").val(t===window.Default?"":i);t===window.Default?fileUploader.items.forEach(n=>{n.error&&n.error===n.formatError&&(n.setError(null),n.formatError=null)}):fileUploader.items.forEach(n=>{n.imageInfo&&n.imageInfo.ToFormats&&(n.imageInfo.ToFormats.indexOf(i.toUpperCase())>=0?(n.setError(null),n.formatError=null):(n.formatError=`"${n.fileName}" image cannot be saved in ${t} format.`,n.setError(n.formatError)))});updateWorkBtnState()}function updateWorkBtnState(){var n=!0;fileUploader.items.length===0?n=!1:fileUploader.items.some(n=>n.error||!n.hasMaskingResult)&&(n=!1);n?btnWork.removeAttr("disabled"):btnWork.attr("disabled","disabled")}function onGettingAllResults(n){gaEvent("Processing","done");showLoader();console.log(n);navigateToDownloadFile({folder:n[0].Folder,fileNames:n.map(n=>n.FileName)}).then(()=>{$("#workButton").removeClass("hidden"),hideLoader(),gotoScrollTop()})}!function(n,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.TransformationMatrix=t():n.TransformationMatrix=t()}(window,function(){return function(n){function t(r){if(i[r])return i[r].exports;var u=i[r]={i:r,l:!1,exports:{}};return n[r].call(u.exports,u,u.exports,t),u.l=!0,u.exports}var i={};return t.m=n,t.c=i,t.d=function(n,i,r){t.o(n,i)||Object.defineProperty(n,i,{enumerable:!0,get:r})},t.r=function(n){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"});Object.defineProperty(n,"__esModule",{value:!0})},t.t=function(n,i){var r,u;if((1&i&&(n=t(n)),8&i)||4&i&&"object"==typeof n&&n&&n.__esModule)return n;if(r=Object.create(null),t.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:n}),2&i&&"string"!=typeof n)for(u in n)t.d(r,u,function(t){return n[t]}.bind(null,u));return r},t.n=function(n){var i=n&&n.__esModule?function(){return n.default}:function(){return n};return t.d(i,"a",i),i},t.o=function(n,t){return Object.prototype.hasOwnProperty.call(n,t)},t.p="",t(t.s=0)}([function(n,t,i){"use strict";function y(n,t){return Array.isArray(t)?[n.a*t[0]+n.c*t[1]+n.e,n.b*t[0]+n.d*t[1]+n.f]:{x:n.a*t.x+n.c*t.y+n.e,y:n.b*t.x+n.d*t.y+n.f}}function ut(n,t){return t.map(function(t){return y(n,t)})}function p(n){return{a:parseFloat(n.a),b:parseFloat(n.b),c:parseFloat(n.c),d:parseFloat(n.d),e:parseFloat(n.e),f:parseFloat(n.f)}}function ft(n){var t=n.match(w);if(null===t||t.length<7)throw new Error("'".concat(n,"' is not a matrix"));return{a:parseFloat(t[1]),b:parseFloat(t[2]),c:parseFloat(t[3]),d:parseFloat(t[4]),e:parseFloat(t[5]),f:parseFloat(t[6])}}function et(){return{a:1,c:0,e:0,b:0,d:1,f:0}}function b(n){var i=n.a,r=n.b,u=n.c,f=n.d,e=n.e,o=n.f,t=i*f-r*u;return{a:f/t,b:r/-t,c:u/-t,d:i/t,e:(f*e-u*o)/-t,f:(r*e-i*o)/t}}function k(n){return(k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n})(n)}function e(n){return void 0===n}function u(n){return"number"==typeof n&&!Number.isNaN(n)&&Number.isFinite(n)}function ot(n){return"object"===k(t=n)&&null!==t&&!Array.isArray(t)&&"a"in n&&u(n.a)&&"b"in n&&u(n.b)&&"c"in n&&u(n.c)&&"d"in n&&u(n.d)&&"e"in n&&u(n.e)&&"f"in n&&u(n.f);var t}function r(n){return{a:1,c:0,e:n,b:0,d:1,f:arguments.length>1&&void 0!==arguments[1]?arguments[1]:0}}function st(n){return function(n){if(Array.isArray(n))return s(n)}(n)||g(n)||d(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}()}function ht(n){return function(n){if(Array.isArray(n))return n}(n)||g(n)||d(n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}()}function d(n,t){if(n){if("string"==typeof n)return s(n,t);var i=Object.prototype.toString.call(n).slice(8,-1);return"Object"===i&&n.constructor&&(i=n.constructor.name),"Map"===i||"Set"===i?Array.from(i):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?s(n,t):void 0}}function s(n,t){(null==t||t>n.length)&&(t=n.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=n[i];return r}function g(n){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(n))return Array.from(n)}function f(){for(var i,u=arguments.length,n=new Array(u),t=0;t<u;t++)n[t]=arguments[t];i=function(n,t){return{a:n.a*t.a+n.c*t.b,c:n.a*t.c+n.c*t.d,e:n.a*t.e+n.c*t.f+n.e,b:n.b*t.a+n.d*t.b,d:n.b*t.c+n.d*t.d,f:n.b*t.e+n.d*t.f+n.f}};switch((n=Array.isArray(n[0])?n[0]:n).length){case 0:throw new Error("no matrices provided");case 1:return n[0];case 2:return i(n[0],n[1]);default:var r=ht(n),e=r[0],o=r[1],s=r.slice(2),h=i(e,o);return f.apply(void 0,[h].concat(st(s)))}}function ct(){return f.apply(void 0,arguments)}function nt(n,t,i){var u=lt(n),o=at(n),s={a:u,c:-o,e:0,b:o,d:u,f:0};return e(t)||e(i)?s:f([r(t,i),s,r(-t,-i)])}function h(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;return nt(n*vt/180,t,i)}function c(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,o;return e(t)&&(t=n),o={a:n,c:0,e:0,b:0,d:t,f:0},e(i)||e(u)?o:f([r(i,u),o,r(-i,-u)])}function tt(n,t){return{a:1,c:n,e:0,b:t,d:1,f:0}}function it(n,t){return{a:1,c:l(n),e:0,b:l(t),d:1,f:0}}function a(n,t){return it(n*Math.PI/180,t*Math.PI/180)}function yt(n){return v(n)}function pt(n){return v(n)}function v(n){return"matrix(".concat(n.a,",").concat(n.b,",").concat(n.c,",").concat(n.d,",").concat(n.e,",").concat(n.f,")")}function rt(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e10;return{a:Math.round(n.a*t)/t,b:Math.round(n.b*t)/t,c:Math.round(n.c*t)/t,d:Math.round(n.d*t)/t,e:Math.round(n.e*t)/t,f:Math.round(n.f*t)/t}}function wt(n,t){var o=null!=n[0].x?n[0].x:n[0][0],s=null!=n[0].y?n[0].y:n[0][1],h=null!=t[0].x?t[0].x:t[0][0],c=null!=t[0].y?t[0].y:t[0][1],l=null!=n[1].x?n[1].x:n[1][0],a=null!=n[1].y?n[1].y:n[1][1],v=null!=t[1].x?t[1].x:t[1][0],y=null!=t[1].y?t[1].y:t[1][1],i=null!=n[2].x?n[2].x:n[2][0],r=null!=n[2].y?n[2].y:n[2][1],u=null!=t[2].x?t[2].x:t[2][0],e=null!=t[2].y?t[2].y:t[2][1];return rt(f([{a:h-u,b:c-e,c:v-u,d:y-e,e:u,f:e},b({a:o-i,b:s-r,c:l-i,d:a-r,e:i,f:r})]))}function bt(n){function t(n){switch(n.type){case"matrix":if("a"in n&&"b"in n&&"c"in n&&"d"in n&&"e"in n&&"f"in n)return p(n);throw new Error("MISSING_MANDATORY_PARAM");case"translate":if(!("tx"in n))throw new Error("MISSING_MANDATORY_PARAM");return"ty"in n?r(n.tx,n.ty):r(n.tx);case"scale":if(!("sx"in n))throw new Error("MISSING_MANDATORY_PARAM");return"sy"in n?c(n.sx,n.sy):c(n.sx);case"rotate":if(!("angle"in n))throw new Error("MISSING_MANDATORY_PARAM");return"cx"in n&&"cy"in n?h(n.angle,n.cx,n.cy):h(n.angle);case"skewX":if(!("angle"in n))throw new Error("MISSING_MANDATORY_PARAM");return a(n.angle,0);case"skewY":if(!("angle"in n))throw new Error("MISSING_MANDATORY_PARAM");return a(0,n.angle);case"shear":if(!("shx"in n&&"shy"in n))throw new Error("MISSING_MANDATORY_PARAM");return tt(n.shx,n.shy);default:throw new Error("UNSUPPORTED_DESCRIPTOR");}}return Array.isArray(n)?n.map(t):t(n)}function o(n,t,i,r){this.message=n;this.expected=t;this.found=i;this.location=r;this.name="SyntaxError";"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,o)}function kt(n,t){function c(n,t){return{type:"literal",text:n,ignoreCase:t}}function k(n,t,i){return{type:"class",parts:n,inverted:t,ignoreCase:i}}function sr(n){return{type:"other",description:n}}function ht(t){var r,i=w[t];if(i)return i;for(r=t-1;!w[r];)r--;for(i={line:(i=w[r]).line,column:i.column};r<t;)10===n.charCodeAt(r)?(i.line++,i.column=1):i.column++,r++;return w[t]=i,i}function lt(n,i){var r={},u,f;return ct&&(r.filename=t.filename),u=ht(n),r.start={offset:n,line:u.line,column:u.column},f=ht(i),r.end={offset:i,line:f.line,column:f.column},r}function s(n){var t=b[b.length-1];r<t.pos||(r>t.pos&&(t.pos=r,t.variants=[]),t.variants.push(n))}function hr(n,t,i){return new o(o.buildMessage(n,t),n,t,i)}function at(){var t,e,n,o,f;for(t=r,e=[],n=u();n!==i;)e.push(n),n=u();for((n=function t(){var n,e,f,u;if(n=r,(e=vt())!==i){if(f=[],(u=h())!==i)for(;u!==i;)f.push(u),u=h();else f=i;f!==i&&(u=t())!==i?(n,n=pi(e,u)):(r=n,n=i)}else r=n,n=i;return n===i&&(n=vt()),n}())===i&&(n=null),o=[],f=u();f!==i;)o.push(f),f=u();return t,t=yi(n)}function vt(){var t;return(t=function(){var t,w,k,o,d,p,g,nt,tt,rt,ut,ft,c,b=function(n){0===f&&s(n)};if(t=r,b(ii),n.substr(r,6)===it?(w=it,r+=6):w=i,w!==i){for(k=[],o=u();o!==i;)k.push(o),o=u();if(b(v),40===n.charCodeAt(r)?(o=l,r++):o=i,o!==i){for(d=[],p=u();p!==i;)d.push(p),p=u();if((p=e())!==i)if(h()!==i)if((g=e())!==i)if(h()!==i)if((nt=e())!==i)if(h()!==i)if((tt=e())!==i)if(h()!==i)if((rt=e())!==i)if(h()!==i)if((ut=e())!==i){for(ft=[],c=u();c!==i;)ft.push(c),c=u();b(y);41===n.charCodeAt(r)?(c=a,r++):c=i;c!==i?(t,t=wi(p,g,nt,tt,rt,ut)):(r=t,t=i)}else r=t,t=i;else r=t,t=i;else r=t,t=i;else r=t,t=i;else r=t,t=i;else r=t,t=i;else r=t,t=i;else r=t,t=i;else r=t,t=i;else r=t,t=i;else r=t,t=i}else r=t,t=i}else r=t,t=i;return t}())===i&&(t=function(){var t,p,k,o,d,c,w,g,h,b=function(n){0===f&&s(n)};if(t=r,b(ri),n.substr(r,9)===rt?(p=rt,r+=9):p=i,p!==i){for(k=[],o=u();o!==i;)k.push(o),o=u();if(b(v),40===n.charCodeAt(r)?(o=l,r++):o=i,o!==i){for(d=[],c=u();c!==i;)d.push(c),c=u();if((c=e())!==i){for((w=yt())===i&&(w=null),g=[],h=u();h!==i;)g.push(h),h=u();b(y);41===n.charCodeAt(r)?(h=a,r++):h=i;h!==i?(t,t=bi(c,w)):(r=t,t=i)}else r=t,t=i}else r=t,t=i}else r=t,t=i;return t}())===i&&(t=function(){var t,p,k,o,d,c,w,g,h,b=function(n){0===f&&s(n)};if(t=r,b(ui),n.substr(r,5)===ut?(p=ut,r+=5):p=i,p!==i){for(k=[],o=u();o!==i;)k.push(o),o=u();if(b(v),40===n.charCodeAt(r)?(o=l,r++):o=i,o!==i){for(d=[],c=u();c!==i;)d.push(c),c=u();if((c=e())!==i){for((w=yt())===i&&(w=null),g=[],h=u();h!==i;)g.push(h),h=u();b(y);41===n.charCodeAt(r)?(h=a,r++):h=i;h!==i?(t,t=ki(c,w)):(r=t,t=i)}else r=t,t=i}else r=t,t=i}else r=t,t=i;return t}())===i&&(t=function(){var t,w,d,o,g,p,b,nt,c,k=function(n){0===f&&s(n)};if(t=r,k(fi),n.substr(r,6)===ft?(w=ft,r+=6):w=i,w!==i){for(d=[],o=u();o!==i;)d.push(o),o=u();if(k(v),40===n.charCodeAt(r)?(o=l,r++):o=i,o!==i){for(g=[],p=u();p!==i;)g.push(p),p=u();if((p=e())!==i){for((b=function(){var n,t,u;return n=r,h()!==i&&(t=e())!==i&&h()!==i&&(u=e())!==i?(n,n=ur(t,u)):(r=n,n=i),n}())===i&&(b=null),nt=[],c=u();c!==i;)nt.push(c),c=u();k(y);41===n.charCodeAt(r)?(c=a,r++):c=i;c!==i?(t,t=di(p,b)):(r=t,t=i)}else r=t,t=i}else r=t,t=i}else r=t,t=i;return t}())===i&&(t=function(){var t,p,b,o,k,c,d,h,w=function(n){0===f&&s(n)};if(t=r,w(ei),n.substr(r,5)===et?(p=et,r+=5):p=i,p!==i){for(b=[],o=u();o!==i;)b.push(o),o=u();if(w(v),40===n.charCodeAt(r)?(o=l,r++):o=i,o!==i){for(k=[],c=u();c!==i;)k.push(c),c=u();if((c=e())!==i){for(d=[],h=u();h!==i;)d.push(h),h=u();w(y);41===n.charCodeAt(r)?(h=a,r++):h=i;h!==i?(t,t=gi(c)):(r=t,t=i)}else r=t,t=i}else r=t,t=i}else r=t,t=i;return t}())===i&&(t=function(){var t,p,b,o,k,c,d,h,w=function(n){0===f&&s(n)};if(t=r,w(oi),n.substr(r,5)===ot?(p=ot,r+=5):p=i,p!==i){for(b=[],o=u();o!==i;)b.push(o),o=u();if(w(v),40===n.charCodeAt(r)?(o=l,r++):o=i,o!==i){for(k=[],c=u();c!==i;)k.push(c),c=u();if((c=e())!==i){for(d=[],h=u();h!==i;)d.push(h),h=u();w(y);41===n.charCodeAt(r)?(h=a,r++):h=i;h!==i?(t,t=nr(c)):(r=t,t=i)}else r=t,t=i}else r=t,t=i}else r=t,t=i;return t}()),t}function e(){var e,t,u,o;return e=r,t=r,(u=g())===i&&(u=null),(o=function(){var t,u,e;return t=r,(u=function(){var t,e,u,o;return function(n){0===f&&s(n)}(hi),f++,t=r,(e=p())===i&&(e=null),46===n.charCodeAt(r)?(u=st,r++):u=i,u!==i&&(o=p())!==i?(t,t=er(e,o)):(r=t,t=i),t===i&&(t=r,(e=p())!==i?(46===n.charCodeAt(r)?(u=st,r++):u=i,u!==i?(t,t=or(e)):(r=t,t=i)):(r=t,t=i)),f--,t}())!==i?((e=wt())===i&&(e=null),t=u=[u,e]):(r=t,t=i),t===i&&(t=r,(u=p())!==i&&(e=wt())!==i?t=u=[u,e]:(r=t,t=i)),t}())!==i?t=u=[u,o]:(r=t,t=i),t!==i&&(e,t=tr(t)),(e=t)===i&&(e=r,t=r,(u=g())===i&&(u=null),(o=function(){var t,n;return t=r,(n=p())!==i&&(t,n=fr(n)),n}())!==i?t=u=[u,o]:(r=t,t=i),t!==i&&(e,t=ir(t)),e=t),e}function yt(){var n,t;return n=r,h()!==i&&(t=e())!==i?(n,n=rr(t)):(r=n,n=i),n}function h(){var n,f,t,e,o;if(n=r,f=[],(t=u())!==i)for(;t!==i;)f.push(t),t=u();else f=i;if(f!==i){for((t=pt())===i&&(t=null),e=[],o=u();o!==i;)e.push(o),o=u();n=f=[f,t,e]}else r=n,n=i;if(n===i)if(n=r,(f=pt())!==i){for(t=[],e=u();e!==i;)t.push(e),e=u();n=f=[f,t]}else r=n,n=i;return n}function pt(){var t;return function(n){0===f&&s(n)}(si),44===n.charCodeAt(r)?(t=kt,r++):t=i,t}function wt(){var t,u,e,o;return t=r,function(n){0===f&&s(n)}(ci),dt.test(n.charAt(r))?(u=n.charAt(r),r++):u=i,u!==i?((e=g())===i&&(e=null),(o=p())!==i?t=u=[u,e,o]:(r=t,t=i)):(r=t,t=i),t}function g(){var t;return function(n){0===f&&s(n)}(li),gt.test(n.charAt(r))?(t=n.charAt(r),r++):t=i,t}function p(){var n,t;if(n=[],(t=bt())!==i)for(;t!==i;)n.push(t),t=bt();else n=i;return n}function bt(){var t;return function(n){0===f&&s(n)}(ai),ni.test(n.charAt(r))?(t=n.charAt(r),r++):t=i,t}function u(){var t;return function(n){0===f&&s(n)}(vi),ti.test(n.charAt(r))?(t=n.charAt(r),r++):t=i,t}var ct;t=void 0!==t?t:{};var d,i={},nt={transformList:at},tt=at,it="matrix",l="(",a=")",rt="translate",ut="scale",ft="rotate",et="skewX",ot="skewY",kt=",",st=".",dt=/^[eE]/,gt=/^[+\-]/,ni=/^[0-9]/,ti=/^[ \t\r\n]/,ii=c("matrix",!1),v=c("(",!1),y=c(")",!1),ri=c("translate",!1),ui=c("scale",!1),fi=c("rotate",!1),ei=c("skewX",!1),oi=c("skewY",!1),si=c(",",!1),hi=sr("fractionalConstant"),ci=k(["e","E"],!1,!1),li=k(["+","-"],!1,!1),ai=k([["0","9"]],!1,!1),vi=k([" ","\t","\r","\n"],!1,!1),yi=function(n){return n},pi=function(n,t){return n.concat(t)},wi=function(n,t,i,r,u,f){return[{type:"matrix",a:n,b:t,c:i,d:r,e:u,f:f}]},bi=function(n,t){var i={type:"translate",tx:n};return t&&(i.ty=t),[i]},ki=function(n,t){var i={type:"scale",sx:n};return t&&(i.sy=t),[i]},di=function(n,t){var i={type:"rotate",angle:n};return t&&(i.cx=t[0],i.cy=t[1]),[i]},gi=function(n){return[{type:"skewX",angle:n}]},nr=function(n){return[{type:"skewY",angle:n}]},tr=function(n){return parseFloat(n.join(""))},ir=function(n){return parseInt(n.join(""))},rr=function(n){return n},ur=function(n,t){return[n,t]},fr=function(n){return n.join("")},er=function(n,t){return[n?n.join(""):null,".",t.join("")].join("")},or=function(n){return n.join("")},r=0,w=[{line:1,column:1}],b=[],f=0;if("startRule"in t){if(!(t.startRule in nt))throw new Error("Can't start parsing from rule \""+t.startRule+'".');tt=nt[t.startRule]}if(ct="string"==typeof t.filename&&t.filename.length>0,b.push({pos:r,variants:[]}),(d=tt())!==i&&r===n.length)return d;throw d!==i&&r<n.length&&s({type:"end"}),function(){var i=b[0],t=i.pos;return hr(i.variants,t<n.length?n.charAt(t):null,t<n.length?lt(t,t+1):lt(t,t))}();}function dt(n){return kt(n)}var w,l;i.r(t);i.d(t,"applyToPoint",function(){return y});i.d(t,"applyToPoints",function(){return ut});i.d(t,"fromObject",function(){return p});i.d(t,"fromString",function(){return ft});i.d(t,"identity",function(){return et});i.d(t,"inverse",function(){return b});i.d(t,"isAffineMatrix",function(){return ot});i.d(t,"rotate",function(){return nt});i.d(t,"rotateDEG",function(){return h});i.d(t,"scale",function(){return c});i.d(t,"shear",function(){return tt});i.d(t,"skew",function(){return it});i.d(t,"skewDEG",function(){return a});i.d(t,"toCSS",function(){return yt});i.d(t,"toSVG",function(){return pt});i.d(t,"toString",function(){return v});i.d(t,"transform",function(){return f});i.d(t,"compose",function(){return ct});i.d(t,"translate",function(){return r});i.d(t,"fromTriangles",function(){return wt});i.d(t,"smoothMatrix",function(){return rt});i.d(t,"fromDefinition",function(){return bt});i.d(t,"fromTransformAttribute",function(){return dt});w=/^matrix\(\s*([0-9_+-.e]+)\s*,\s*([0-9_+-.e]+)\s*,\s*([0-9_+-.e]+)\s*,\s*([0-9_+-.e]+)\s*,\s*([0-9_+-.e]+)\s*,\s*([0-9_+-.e]+)\s*\)$/i;var lt=Math.cos,at=Math.sin,vt=Math.PI;l=Math.tan;!function(n,t){function i(){this.constructor=n}i.prototype=t.prototype;n.prototype=new i}(o,Error);o.buildMessage=function(n,t){function i(n){return n.charCodeAt(0).toString(16).toUpperCase()}function u(n){return n.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(n){return"\\x0"+i(n)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(n){return"\\x"+i(n)})}function r(n){return n.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(n){return"\\x0"+i(n)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(n){return"\\x"+i(n)})}function f(n){return e[n.type](n)}var e={literal:function(n){return'"'+u(n.text)+'"'},"class":function(n){var t=n.parts.map(function(n){return Array.isArray(n)?r(n[0])+"-"+r(n[1]):r(n)});return"["+(n.inverted?"^":"")+t+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(n){return n.description},not:function(n){return"not "+f(n.expected)}};return"Expected "+function(n){var i,r,t=n.map(f);if(t.sort(),t.length>0){for(i=1,r=1;i<t.length;i++)t[i-1]!==t[i]&&(t[r]=t[i],r++);t.length=r}switch(t.length){case 1:return t[0];case 2:return t[0]+" or "+t[1];default:return t.slice(0,-1).join(", ")+", or "+t[t.length-1]}}(n)+" but "+function(n){return n?'"'+u(n)+'"':"end of input"}(t)+" found."}}])}),function(n){n.ImagingFileUploader=function(t,i,r,u,f=true,e){this.items=[];this.fileInput=t;this.parent=i;n(i).change(()=>{r(),gaEvent("Upload","localFile")});this.showMoveLinks=f;t.change(fileInputChangedEventHandler);u||(u=10);this.isEmpty=()=>this.items.length===0;this.isMultiple=()=>Boolean(n(this.fileInput).attr("multiple"));this.itemTooltipProvider=null;this.itemAdditionalContentProvider=null;this.sizeChangedCallback=null;this.onRemoveItemCallback=e;this.onItemSorted=null;this.canSelect=!1;this.canMoveItems=!0;this.appendFiles=n=>{n.forEach(n=>this.append(n))};this.replaceFiles=n=>{this.clear(),this.appendFiles(n)};this.append=t=>{var f,i,r;if(this.items.length<u)return f=this.isEmpty(),i=new n.ImagingFileUploaderItem(this,t,this.showMoveLinks),this.items.push(i),this.parent.append(i.element),this.updateItemsUi(),this.itemTooltipProvider&&i.setTooltip(this.itemTooltipProvider(i)),this.itemAdditionalContentProvider&&(r=this.itemAdditionalContentProvider(i),r&&i.setAdditionalContent(r)),f&&this.canSelect&&i.setSelected(!0),this.onSizeChanged(),i};this.remove=n=>{var t=this.getItemIndex(n),i;if(t>=0&&(i=n.isSelected(),n.element.remove(),this.items.splice(t,1),this.updateItemsUi(),i&&!this.isEmpty()&&this.items[0].setSelected(!0),this.onSizeChanged(),this.onRemoveItemCallback))this.onRemoveItemCallback(n)};this.removePendingFiles=()=>{const n=t.prop("files");for(let t=0;t<n.length;t++){const i=n.item(t).name;this.remove(i)}t.val("")};this.clear=()=>{this.parent.find(".fileupload").remove(),this.items=[],this.onSizeChanged()};this.retry=()=>r();this.handleUploadError=(n,t)=>{n.status===0?(hideLoader(),retryHandler(()=>{this.retry()},()=>{this.removePendingFiles(),handleError({status:0})})):(handleError(n,t),this.removePendingFiles())};this.moveUp=n=>{var t=this.getItemIndex(n);t>0&&this.changePosition(t,t-1)};this.moveDown=n=>{var t=this.getItemIndex(n);t<this.items.length-1&&this.changePosition(t,t+1)};this.changePosition=(n,t)=>{this.items[n].element.detach();t<this.items.length-1?this.parent.find(".fileupload").eq(t).before(this.items[n].element):this.parent.append(this.items[n].element);var i=this.items.splice(n,1)[0];if(this.items.splice(t,0,i),this.onItemSorted)this.onItemSorted(n,t);this.updateItemsUi()};this.getItemIndex=n=>{for(let t=0;t<this.items.length;t++)if(this.items[t]===n)return t;return-1};this.updateItemsUi=()=>{for(let n=0;n<this.items.length;n++)this.items[n].updateUi(n>0,n<this.items.length-1,this.canMoveItems)};this.onSizeChanged=()=>{this.sizeChangedCallback&&this.sizeChangedCallback(this.items.length),this.checkActive()};this.checkActive=()=>{var n=this.items.length<u;return n?this.fileInput.removeAttr("disabled"):this.fileInput.attr("disabled","disabled"),n};this.onItemSelected=n=>{var t=jQuery.Event("uploader:selected");t.item=n;this.fileInput.trigger(t)};this.find=n=>{for(let t=0;t<this.items.length;t++)if(this.items[t].fileName===n)return this.items[t]};this.getNumItemsBefore=(n,t,i)=>{if(t==null)return this.items.indexOf(n);var r=0;for(let u=0;u<this.items.length;u++){if(this.items[u]===n)return r;t(this.items[u])&&(i?r+=i(this.items[u]):r++)}return-1}};n.ImagingFileUploaderItem=function(t,i,r){function e(n){n=n||event;n.preventDefault();n.stopPropagation()}this.uploader=t;this.fileName=i;this.onRemovedCallback=null;const u=n('                <span class="filename">                    <label class="custom-file-upload" style="display:inline" title="'+this.fileName+'">'+GetShortFileName(this.fileName,16)+"<\/label>                <\/span>                ");if(this.uploader.isMultiple()&&r){const t=n(`<a class="fileMoveUpLink" title="${window.Resources.MoveUp}">`+getIconHtmlCode("sym-icon sym-icon-sm2","arrow-up")+"<\/a>"),i=n(`<a class="fileMoveDownLink" title="${window.Resources.MoveDown}">`+getIconHtmlCode("sym-icon sym-icon-sm2","arrow-down")+"<\/a>");t.on("click",()=>{this.uploader.moveUp(this)});i.on("click",()=>{this.uploader.moveDown(this)});u.append(t);u.append(i)}const f=n(`<a class="fileRemoveLink" title="${window.Resources.RemoveFile}">`+getIconHtmlCode("sym-icon sym-icon-sm2","times")+"<\/a>");f.on("click",()=>{this.uploader.remove(this),this.onRemovedCallback&&this.onRemovedCallback()});u.append(f);this.element=n('<div class="fileupload"><\/div>');this.element.on("dragover",e);this.element.on("drop",e);this.element.append(u);u.hover(()=>this.element.trigger("hover:in"),()=>this.element.trigger("hover:out"));this.updateUi=(n,t,i)=>{n?this.element.find(".fileMoveUpLink").removeClass("disabled"):this.element.find(".fileMoveUpLink").addClass("disabled"),t?this.element.find(".fileMoveDownLink").removeClass("disabled"):this.element.find(".fileMoveDownLink").addClass("disabled"),i!=null&&(i?(this.element.find(".fileMoveUpLink").removeClass("hidden"),this.element.find(".fileMoveDownLink").removeClass("hidden")):(this.element.find(".fileMoveUpLink").addClass("hidden"),this.element.find(".fileMoveDownLink").addClass("hidden")))};this.setTooltip=n=>{n&&(this.tooltipContent=n,this.element.find(".filename").tooltip({content:n}),this.element.find(".fileRemoveLink").tooltip(),this.uploader.isMultiple()&&(this.element.find(".fileMoveUpLink").tooltip(),this.element.find(".fileMoveDownLink").tooltip()))};this.setAdditionalContent=(n,t)=>{n&&n.element&&(t?this.element.find(".filename").before(n.element):this.element.append(n.element))};this.isSelected=()=>this.element.hasClass("file-state-selected");this.setSelected=n=>{if(n==null){this.onSelect();return}if(n){if(this.element.addClass("file-state-selected"),this.onSelected)this.onSelected(this);this.uploader.onItemSelected(this)}else this.element.removeClass("file-state-selected")};this.setError=n=>{if(this.error=n,n){let t=n;t.idError&&(t=t.idError);this.element.addClass("file-state-error");this.tooltipContentBak=this.tooltipContent;this.setTooltip('\t\t\t\t<div class="item-tooltip">\t\t\t\t\t<div class="item-tooltip-header">\t\t\t\t\t\t<span>'+this.fileName+'<\/span>\t\t\t\t\t<\/div>\t\t\t\t\t<div class="item-tooltip-body">\t\t\t\t\t\t<div class="item-tooltip-error">'+t.replace("\n","<br>")+"<\/div>\t\t\t\t\t<\/div>\t\t\t\t<\/div>\t\t\t\t\t")}else this.element.removeClass("file-state-error"),this.setTooltip(this.tooltipContentBak);this.uploader.onSizeChanged()};this.element.find(".filename > label").hover(()=>{t.canSelect&&this.element.addClass("file-state-hovered")},()=>this.element.removeClass("file-state-hovered"));this.onSelect=()=>{if(!this.isSelected())for(let t=0;t<this.uploader.items.length;t++){var n=this.uploader.items[t];n.setSelected(n.fileName===this.fileName)}};t.canSelect&&this.element.find(".filename > label").click(()=>this.onSelect());this.updateImageInfo=n=>{if(!n)throw new Error("request options is not specified.");if(!n.uploadId)throw new Error("upload ID is not specified.");if(!n.cannotReadMsg)throw new Error("cannot read message is not specified.");if(!n.onSuccess)throw new Error("on success event handler is not specified.");const i=n.onSuccess,t=n.onError;n.fileName=this.fileName;n.onSuccess=r=>{if(r.IsSuccess)this.imageInfo=r,i(r);else if(t){let i="";i=r.Error.InnerException&&r.Error.InnerException.ExceptionMessage.toLowerCase().includes("not supported")?r.Error.InnerException.ExceptionMessage:n.cannotReadMsg+(r.Error.InnerException?r.Error.InnerException.ExceptionMessage:r.Error.ExceptionMessage);t(i,r.Error)}else this.setError(n.cannotReadMsg)};n.onError=(i,r)=>{if(!handleAjaxError(i,()=>{requestImageInfo(n)}))if(t)t(r?r:i.idError,i.Error?i.Error:i);else{const n=handleError(i,r);this.setError(n)}};requestImageInfo(n)};this.showProgress=t=>{this._progressIndicator||(this._progressIndicator=new n.ItemProgressPresenter,this.setAdditionalContent(this._progressIndicator,!0)),t!=null?this._progressIndicator.setProgress(t):this._progressIndicator.clearProgress()};this.hideProgress=()=>{this._progressIndicator&&(this._progressIndicator.element.remove(),this._progressIndicator=null)}};n.ItemProgressPresenter=function(){this.element=n('\t\t\t<div class="file-uploader-item-progress">\t\t\t\t<span>0 %<\/span>\t\t\t<\/div>\t\t\t');this.setProgress=n=>{(!this.lastProgress||this.lastProgress<n)&&(this.lastProgress=n,this.element.find("span").html(Math.round(n)+"%"))};this.clearProgress=()=>{this.element.find("span").html("&nbsp;")}}}(jQuery),function(n){n.fn.UrlUploader=function(t,i){function o(n){if(!n)return!1;let t;try{t=new URL(n)}catch(s){return!1}if(t.protocol!=="http:"&&t.protocol!=="https:"||!t.pathname)return!1;const i=t.pathname.split("/");if(!i.length)return!1;const u=i[i.length-1],f=r.attr("accept");if(!f)return u;const e=f.split(",").map(n=>n.toLowerCase()),o=u.toLowerCase();return e.every(n=>!o.endsWith(n))?!1:u}const f=this.find(".filedrop-input-url"),r=this.find(".externalUrlInput"),e=this.find(".button-url-add");let u=f.hasClass("hidden");this.hideUrlPanel=()=>{u||(u=!0,r.val(null),f.animate({height:"0px"},200,()=>{f.addClass("hidden"),r.removeClass("invalid"),e.addClass("invalid")}))};this.showUrlPanel=()=>{u&&(u=!1,f.css("height",0).removeClass("hidden").animate({height:"93px"},200))};this.find(".filedrop-enter-url").click(()=>{u?this.showUrlPanel():this.hideUrlPanel()});this.find(".button-url-cancel").click(()=>{this.hideUrlPanel()});r.on("input",()=>{o(r.val())?(r.removeClass("invalid"),e.removeClass("invalid")):(r.addClass("invalid"),e.addClass("invalid"))});return this.addByUrl=()=>{const u=r.val();var f=o(u);if(f){i&&i(u,f);const e=n("<input />");e.attr("type","hidden").attr("name","link_"+createUUID()).attr("value",u).appendTo(t);t.submit();gaEvent("Upload","webLink");e.remove();this.hideUrlPanel()}},r.keyup(n=>{(n.key==="Enter"||n.keyCode===13)&&this.addByUrl()}),e.click(()=>{this.addByUrl()}),this}}(jQuery),function(n){function t(n,r){if(n=n?n:"",r=r||{},n instanceof t)return n;if(!(this instanceof t))return new t(n,r);var u=tt(n);this._originalInput=n;this._r=u.r;this._g=u.g;this._b=u.b;this._a=u.a;this._roundA=i(100*this._a)/100;this._format=r.format||u.format;this._gradientType=r.gradientType;this._r<1&&(this._r=i(this._r));this._g<1&&(this._g=i(this._g));this._b<1&&(this._b=i(this._b));this._ok=u.ok;this._tc_id=fi++}function tt(n){var t={r:0,g:0,b:0},i=1,r=null,e=null,l=null,u=!1,f=!1;return typeof n=="string"&&(n=ti(n)),typeof n=="object"&&(h(n.r)&&h(n.g)&&h(n.b)?(t=it(n.r,n.g,n.b),u=!0,f=String(n.r).substr(-1)==="%"?"prgb":"rgb"):h(n.h)&&h(n.s)&&h(n.v)?(r=c(n.s),e=c(n.v),t=ut(n.h,r,e),u=!0,f="hsv"):h(n.h)&&h(n.s)&&h(n.l)&&(r=c(n.s),l=c(n.l),t=rt(n.h,r,l),u=!0,f="hsl"),n.hasOwnProperty("a")&&(i=n.a)),i=k(i),{ok:u,format:n.format||f,r:o(255,s(t.r,0)),g:o(255,s(t.g,0)),b:o(255,s(t.b,0)),a:i}}function it(n,t,i){return{r:r(n,255)*255,g:r(t,255)*255,b:r(i,255)*255}}function y(n,t,i){var u;n=r(n,255);t=r(t,255);i=r(i,255);var f=s(n,t,i),h=o(n,t,i),e,c,l=(f+h)/2;if(f==h)e=c=0;else{u=f-h;c=l>.5?u/(2-f-h):u/(f+h);switch(f){case n:e=(t-i)/u+(t<i?6:0);break;case t:e=(i-n)/u+2;break;case i:e=(n-t)/u+4}e/=6}return{h:e,s:c,l:l}}function rt(n,t,i){function e(n,t,i){return(i<0&&(i+=1),i>1&&(i-=1),i<1/6)?n+(t-n)*6*i:i<1/2?t:i<2/3?n+(t-n)*(2/3-i)*6:n}var o,s,h,u,f;return n=r(n,360),t=r(t,100),i=r(i,100),t===0?o=s=h=i:(u=i<.5?i*(1+t):i+t-i*t,f=2*i-u,o=e(f,u,n+1/3),s=e(f,u,n),h=e(f,u,n-1/3)),{r:o*255,g:s*255,b:h*255}}function p(n,t,i){n=r(n,255);t=r(t,255);i=r(i,255);var u=s(n,t,i),h=o(n,t,i),f,c,l=u,e=u-h;if(c=u===0?0:e/u,u==h)f=0;else{switch(u){case n:f=(t-i)/e+(t<i?6:0);break;case t:f=(i-n)/e+2;break;case i:f=(n-t)/e+4}f/=6}return{h:f,s:c,v:l}}function ut(t,i,u){t=r(t,360)*6;i=r(i,100);u=r(u,100);var h=n.floor(t),c=t-h,f=u*(1-i),e=u*(1-c*i),o=u*(1-(1-c)*i),s=h%6,l=[u,e,f,f,o,u][s],a=[o,u,u,e,f,f][s],v=[f,f,o,u,u,e][s];return{r:l*255,g:a*255,b:v*255}}function w(n,t,r,u){var f=[e(i(n).toString(16)),e(i(t).toString(16)),e(i(r).toString(16))];return u&&f[0].charAt(0)==f[0].charAt(1)&&f[1].charAt(0)==f[1].charAt(1)&&f[2].charAt(0)==f[2].charAt(1)?f[0].charAt(0)+f[1].charAt(0)+f[2].charAt(0):f.join("")}function ft(n,t,r,u,f){var o=[e(i(n).toString(16)),e(i(t).toString(16)),e(i(r).toString(16)),e(d(u))];return f&&o[0].charAt(0)==o[0].charAt(1)&&o[1].charAt(0)==o[1].charAt(1)&&o[2].charAt(0)==o[2].charAt(1)&&o[3].charAt(0)==o[3].charAt(1)?o[0].charAt(0)+o[1].charAt(0)+o[2].charAt(0)+o[3].charAt(0):o.join("")}function b(n,t,r,u){var f=[e(d(u)),e(i(n).toString(16)),e(i(t).toString(16)),e(i(r).toString(16))];return f.join("")}function et(n,i){i=i===0?0:i||10;var r=t(n).toHsl();return r.s-=i/100,r.s=l(r.s),t(r)}function ot(n,i){i=i===0?0:i||10;var r=t(n).toHsl();return r.s+=i/100,r.s=l(r.s),t(r)}function st(n){return t(n).desaturate(100)}function ht(n,i){i=i===0?0:i||10;var r=t(n).toHsl();return r.l+=i/100,r.l=l(r.l),t(r)}function ct(n,r){r=r===0?0:r||10;var u=t(n).toRgb();return u.r=s(0,o(255,u.r-i(255*-(r/100)))),u.g=s(0,o(255,u.g-i(255*-(r/100)))),u.b=s(0,o(255,u.b-i(255*-(r/100)))),t(u)}function lt(n,i){i=i===0?0:i||10;var r=t(n).toHsl();return r.l-=i/100,r.l=l(r.l),t(r)}function at(n,i){var r=t(n).toHsl(),u=(r.h+i)%360;return r.h=u<0?360+u:u,t(r)}function vt(n){var i=t(n).toHsl();return i.h=(i.h+180)%360,t(i)}function yt(n){var i=t(n).toHsl(),r=i.h;return[t(n),t({h:(r+120)%360,s:i.s,l:i.l}),t({h:(r+240)%360,s:i.s,l:i.l})]}function pt(n){var i=t(n).toHsl(),r=i.h;return[t(n),t({h:(r+90)%360,s:i.s,l:i.l}),t({h:(r+180)%360,s:i.s,l:i.l}),t({h:(r+270)%360,s:i.s,l:i.l})]}function wt(n){var i=t(n).toHsl(),r=i.h;return[t(n),t({h:(r+72)%360,s:i.s,l:i.l}),t({h:(r+216)%360,s:i.s,l:i.l})]}function bt(n,i,r){i=i||6;r=r||30;var u=t(n).toHsl(),f=360/r,e=[t(n)];for(u.h=(u.h-(f*i>>1)+720)%360;--i;)u.h=(u.h+f)%360,e.push(t(u));return e}function kt(n,i){i=i||6;for(var r=t(n).toHsv(),e=r.h,o=r.s,u=r.v,f=[],s=1/i;i--;)f.push(t({h:e,s:o,v:u})),u=(u+s)%1;return f}function dt(n){var i={};for(var t in n)n.hasOwnProperty(t)&&(i[n[t]]=t);return i}function k(n){return n=parseFloat(n),(isNaN(n)||n<0||n>1)&&(n=1),n}function r(t,i){gt(t)&&(t="100%");var r=ni(t);return(t=o(i,s(0,parseFloat(t))),r&&(t=parseInt(t*i,10)/100),n.abs(t-i)<1e-6)?1:t%i/parseFloat(i)}function l(n){return o(1,s(0,n))}function u(n){return parseInt(n,16)}function gt(n){return typeof n=="string"&&n.indexOf(".")!=-1&&parseFloat(n)===1}function ni(n){return typeof n=="string"&&n.indexOf("%")!=-1}function e(n){return n.length==1?"0"+n:""+n}function c(n){return n<=1&&(n=n*100+"%"),n}function d(t){return n.round(parseFloat(t)*255).toString(16)}function g(n){return u(n)/255}function h(n){return!!f.CSS_UNIT.exec(n)}function ti(n){var i,t;if(n=n.replace(ri,"").replace(ui,"").toLowerCase(),i=!1,a[n])n=a[n],i=!0;else if(n=="transparent")return{r:0,g:0,b:0,a:0,format:"name"};return(t=f.rgb.exec(n))?{r:t[1],g:t[2],b:t[3]}:(t=f.rgba.exec(n))?{r:t[1],g:t[2],b:t[3],a:t[4]}:(t=f.hsl.exec(n))?{h:t[1],s:t[2],l:t[3]}:(t=f.hsla.exec(n))?{h:t[1],s:t[2],l:t[3],a:t[4]}:(t=f.hsv.exec(n))?{h:t[1],s:t[2],v:t[3]}:(t=f.hsva.exec(n))?{h:t[1],s:t[2],v:t[3],a:t[4]}:(t=f.hex8.exec(n))?{r:u(t[1]),g:u(t[2]),b:u(t[3]),a:g(t[4]),format:i?"name":"hex8"}:(t=f.hex6.exec(n))?{r:u(t[1]),g:u(t[2]),b:u(t[3]),format:i?"name":"hex"}:(t=f.hex4.exec(n))?{r:u(t[1]+""+t[1]),g:u(t[2]+""+t[2]),b:u(t[3]+""+t[3]),a:g(t[4]+""+t[4]),format:i?"name":"hex8"}:(t=f.hex3.exec(n))?{r:u(t[1]+""+t[1]),g:u(t[2]+""+t[2]),b:u(t[3]+""+t[3]),format:i?"name":"hex"}:!1}function ii(n){var t,i;return n=n||{level:"AA",size:"small"},t=(n.level||"AA").toUpperCase(),i=(n.size||"small").toLowerCase(),t!=="AA"&&t!=="AAA"&&(t="AA"),i!=="small"&&i!=="large"&&(i="small"),{level:t,size:i}}var ri=/^\s+/,ui=/\s+$/,fi=0,i=n.round,o=n.min,s=n.max,v=n.random,a,nt,f;t.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var n=this.toRgb();return(n.r*299+n.g*587+n.b*114)/1e3},getLuminance:function(){var u=this.toRgb(),t,i,r,f,e,o;return t=u.r/255,i=u.g/255,r=u.b/255,f=t<=.03928?t/12.92:n.pow((t+.055)/1.055,2.4),e=i<=.03928?i/12.92:n.pow((i+.055)/1.055,2.4),o=r<=.03928?r/12.92:n.pow((r+.055)/1.055,2.4),.2126*f+.7152*e+.0722*o},setAlpha:function(n){return this._a=k(n),this._roundA=i(100*this._a)/100,this},toHsv:function(){var n=p(this._r,this._g,this._b);return{h:n.h*360,s:n.s,v:n.v,a:this._a}},toHsvString:function(){var n=p(this._r,this._g,this._b),t=i(n.h*360),r=i(n.s*100),u=i(n.v*100);return this._a==1?"hsv("+t+", "+r+"%, "+u+"%)":"hsva("+t+", "+r+"%, "+u+"%, "+this._roundA+")"},toHsl:function(){var n=y(this._r,this._g,this._b);return{h:n.h*360,s:n.s,l:n.l,a:this._a}},toHslString:function(){var n=y(this._r,this._g,this._b),t=i(n.h*360),r=i(n.s*100),u=i(n.l*100);return this._a==1?"hsl("+t+", "+r+"%, "+u+"%)":"hsla("+t+", "+r+"%, "+u+"%, "+this._roundA+")"},toHex:function(n){return w(this._r,this._g,this._b,n)},toHexString:function(n){return"#"+this.toHex(n)},toHex8:function(n){return ft(this._r,this._g,this._b,this._a,n)},toHex8String:function(n){return"#"+this.toHex8(n)},toRgb:function(){return{r:i(this._r),g:i(this._g),b:i(this._b),a:this._a}},toRgbString:function(){return this._a==1?"rgb("+i(this._r)+", "+i(this._g)+", "+i(this._b)+")":"rgba("+i(this._r)+", "+i(this._g)+", "+i(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:i(r(this._r,255)*100)+"%",g:i(r(this._g,255)*100)+"%",b:i(r(this._b,255)*100)+"%",a:this._a}},toPercentageRgbString:function(){return this._a==1?"rgb("+i(r(this._r,255)*100)+"%, "+i(r(this._g,255)*100)+"%, "+i(r(this._b,255)*100)+"%)":"rgba("+i(r(this._r,255)*100)+"%, "+i(r(this._g,255)*100)+"%, "+i(r(this._b,255)*100)+"%, "+this._roundA+")"},toName:function(){return this._a===0?"transparent":this._a<1?!1:nt[w(this._r,this._g,this._b,!0)]||!1},toFilter:function(n){var r="#"+b(this._r,this._g,this._b,this._a),u=r,f=this._gradientType?"GradientType = 1, ":"",i;return n&&(i=t(n),u="#"+b(i._r,i._g,i._b,i._a)),"progid:DXImageTransform.Microsoft.gradient("+f+"startColorstr="+r+",endColorstr="+u+")"},toString:function(n){var i=!!n;n=n||this._format;var t=!1,r=this._a<1&&this._a>=0,u=!i&&r&&(n==="hex"||n==="hex6"||n==="hex3"||n==="hex4"||n==="hex8"||n==="name");return u?n==="name"&&this._a===0?this.toName():this.toRgbString():(n==="rgb"&&(t=this.toRgbString()),n==="prgb"&&(t=this.toPercentageRgbString()),(n==="hex"||n==="hex6")&&(t=this.toHexString()),n==="hex3"&&(t=this.toHexString(!0)),n==="hex4"&&(t=this.toHex8String(!0)),n==="hex8"&&(t=this.toHex8String()),n==="name"&&(t=this.toName()),n==="hsl"&&(t=this.toHslString()),n==="hsv"&&(t=this.toHsvString()),t||this.toHexString())},clone:function(){return t(this.toString())},_applyModification:function(n,t){var i=n.apply(null,[this].concat([].slice.call(t)));return this._r=i._r,this._g=i._g,this._b=i._b,this.setAlpha(i._a),this},lighten:function(){return this._applyModification(ht,arguments)},brighten:function(){return this._applyModification(ct,arguments)},darken:function(){return this._applyModification(lt,arguments)},desaturate:function(){return this._applyModification(et,arguments)},saturate:function(){return this._applyModification(ot,arguments)},greyscale:function(){return this._applyModification(st,arguments)},spin:function(){return this._applyModification(at,arguments)},_applyCombination:function(n,t){return n.apply(null,[this].concat([].slice.call(t)))},analogous:function(){return this._applyCombination(bt,arguments)},complement:function(){return this._applyCombination(vt,arguments)},monochromatic:function(){return this._applyCombination(kt,arguments)},splitcomplement:function(){return this._applyCombination(wt,arguments)},triad:function(){return this._applyCombination(yt,arguments)},tetrad:function(){return this._applyCombination(pt,arguments)}};t.fromRatio=function(n,i){var u,r;if(typeof n=="object"){u={};for(r in n)n.hasOwnProperty(r)&&(u[r]=r==="a"?n[r]:c(n[r]));n=u}return t(n,i)};t.equals=function(n,i){return!n||!i?!1:t(n).toRgbString()==t(i).toRgbString()};t.random=function(){return t.fromRatio({r:v(),g:v(),b:v()})};t.mix=function(n,i,r){r=r===0?0:r||50;var u=t(n).toRgb(),f=t(i).toRgb(),e=r/100,o={r:(f.r-u.r)*e+u.r,g:(f.g-u.g)*e+u.g,b:(f.b-u.b)*e+u.b,a:(f.a-u.a)*e+u.a};return t(o)};t.readability=function(i,r){var u=t(i),f=t(r);return(n.max(u.getLuminance(),f.getLuminance())+.05)/(n.min(u.getLuminance(),f.getLuminance())+.05)};t.isReadable=function(n,i,r){var f=t.readability(n,i),e,u;u=!1;e=ii(r);switch(e.level+e.size){case"AAsmall":case"AAAlarge":u=f>=4.5;break;case"AAlarge":u=f>=3;break;case"AAAsmall":u=f>=7}return u};t.mostReadable=function(n,i,r){var f=null,o=0,e,s,h,c,u;for(r=r||{},s=r.includeFallbackColors,h=r.level,c=r.size,u=0;u<i.length;u++)e=t.readability(n,i[u]),e>o&&(o=e,f=t(i[u]));return t.isReadable(n,f,{level:h,size:c})||!s?f:(r.includeFallbackColors=!1,t.mostReadable(n,["#fff","#000"],r))};a=t.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"};nt=t.hexNames=dt(a);f=function(){var n="(?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?)",t="[\\s|\\(]+("+n+")[,|\\s]+("+n+")[,|\\s]+("+n+")\\s*\\)?",i="[\\s|\\(]+("+n+")[,|\\s]+("+n+")[,|\\s]+("+n+")[,|\\s]+("+n+")\\s*\\)?";return{CSS_UNIT:new RegExp(n),rgb:new RegExp("rgb"+t),rgba:new RegExp("rgba"+i),hsl:new RegExp("hsl"+t),hsla:new RegExp("hsla"+i),hsv:new RegExp("hsv"+t),hsva:new RegExp("hsva"+i),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}}();typeof module!="undefined"&&module.exports?module.exports=t:typeof define=="function"&&define.amd?define(function(){return t}):window.tinycolor=t}(Math),function(n){n.ColorPicker=function(t,i,r,u){function v(n){var r=n.data("hex"),i;p.setColor(r);i=jQuery.Event("colorpicker:changed");i.colorHex=r;t.trigger(i)}var s,f;t.empty();t.addClass("colorpicker");const y=u?` id="${u}"`:"";t.append(n('\t\t\t<div class="color-wrapper">\t\t\t\t<input type="text" name="custom_color" placeholder="#FFFFFF" '+y+'value="transparent" class="call-picker pickcolor" readonly/>\t\t\t\t<div class="color-holder call-picker"><\/div>\t\t\t\t<div class="color-picker" style="display: none"><\/div>\t\t\t<\/div>\t\t'));i==null&&(i=!0);r==null&&(r=!0);this.container=t;const h=window.Resources["default"],c="Transparent",e=t.find(".color-holder"),a=t.find(".pickcolor"),p=this,l=[h,c,"FFFFFF","000000","993300","333300","003300","003366","000066","333399","333333","660000","FF6633","666633","336633","336666","0066FF","666699","666666","CC3333","FF9933","99CC33","669966","66CCCC","3366FF","663366","999999","CC66FF","FFCC33","FFFF66","99FF66","99CCCC","66CCFF","993366","CCCCCC","FF99CC","FFCC99","FFFF99","CCffCC","CCFFff","99CCFF","CC99FF"];i||l.splice(1,1);r||l.splice(0,1);const o=t.find(".color-picker");for(s=0;s<l.length;s++){f=l[s];switch(f){case h:o.append(`<li class="color-item color-item-default" data-color="${f}"></li>`);break;case c:o.append(`<li class="color-item color-item-transparent" data-hex="transparent" data-color="${f}"></li>`);break;default:o.append(`<li class="color-item" data-hex="#${f}" data-color="#${f}" style="background-color: #${f};"></li>`)}}n("body").click(function(){o.fadeOut()});t.find(".call-picker").click(function(n){n.stopPropagation();o.fadeIn()});o.children("li").click(function(){v(n(this))});this.getColor=()=>a.data("hex");this.hasTransparentColor=()=>i;this.setColor=n=>{var t=h;n&&(t=n==="transparent"?c:n);e.removeClass();e.addClass("color-holder");e.addClass("call-picker");e.css("background-color","");switch(t){case h:e.addClass("color-item-default");break;case c:e.addClass("color-item-transparent");break;default:e.css("background-color",n)}a.val(t);a.data("hex",n)};v(o.find(".color-item").eq(0))};n.fn.ColorPicker=function(){function r(){const n=t.val();s.css({left:n/100*(t.width()*5/6)}).html(n)}function f(){t.css("background-image",`linear-gradient(to right, transparent, ${i.val()})`)}function e(){o.trigger(Object.assign(jQuery.Event("color:changed"),o.getColor()))}const o=this;this.empty();this.addClass("aspose-colorPicker");const u=n('<div class="rangebar"><\/div>'),t=n('<input type="range" min="0" max="100" value="100">'),s=n("<span>100<span>"),i=n('<input type="color">');u.append(n('<div class="bg"><\/div>'));u.append(t);u.append(s);this.append(u);this.append(i);t.on("input",()=>{r()});addEvent(window,"resize",()=>{r()});t.on("change",()=>{e()});i.on("change",()=>{f(),e()});return this.getColor=()=>{const n=tinycolor(i.val()),r=t.val();return n.setAlpha(r/100),{colorHex:r&&r<100?n.toHex8String():n.toHexString(),colorRgb:n.toRgbString()}},this.setColor=n=>{var u;u=n==null?tinycolor("rgba(0,0,0,0)"):n.colorHex||n.colorRgb?tinycolor(n.colorHex?n.colorHex:n.colorRgb):typeof n.getAlpha=="function"?n:tinycolor(n);i.val(u.toHexString());t.val(Math.round(u.getAlpha()*100));r();f();e()},this.updateUi=()=>{r(),f()},this}}(jQuery),function(n){n.fn.StyledDropdown=function(){this.addClass("styled-dropdown");const t=n('<input class="chosen-value" type="text">'),i=n('<ul class="value-list"><\/ul>');this.append(n(getIconHtmlCode("sym-icon","caret-down")));this.append(t);this.append(i);var r=[],e="type to filter",u="",f,o;this.setEmptyText=n=>{u=n?n:"",t.attr("placeholder",u)};this.setFilterText=n=>{e=n?n:""};this.setElements=u=>{r=u.map(n=>String(n)),i.empty(),r.forEach(t=>{const r=n(`<li class="closed">${t}</li>`);i.append(r)}),i.find("li").hover(function(){t.val(n(this).html())},function(){})};this.setSelectedIndex=n=>{var i="";n>=0&&n<r.length&&(i=r[n]);t.val(i);this._onSelectedChanged(n)};this.getSelectedIndex=()=>r.indexOf(t.val());this.getCount=()=>r.length;this.closeDropdown=()=>{i.removeClass("open")};this.setChanged=(n,t)=>{n==null||n<0||n>=r.length||(t==null||t?i.find("li").eq(n).addClass("dirty"):i.find("li").eq(n).removeClass("dirty"))};t.on("input",()=>{i.addClass("open");const n=t.val().toLowerCase();if(n.length>0)for(let t=0;t<r.length;t++)n===r[t].substring(0,n.length)?i.find("li").eq(t).removeClass("closed"):i.find("li").eq(t).addClass("closed");else i.find("li").removeClass("closed")});t.on("keyup",r=>{if(r.key==="Enter"||r.keyCode===13){const r=i.find("li").filter(function(){return!n(this).hasClass("closed")}).eq(0);r.length?(t.val(r.html()),this._onSelectedChanged(this.getSelectedIndex())):f!=null&&t.val(f);i.find("li").addClass("closed");t.blur()}});t.on("focus",()=>{t.attr("placeholder",e),i.addClass("open"),o=t.val(),i.find("li").removeClass("closed")});t.on("blur",()=>{t.attr("placeholder",u),i.removeClass("open"),t.val()!==o&&this._onSelectedChanged(this.getSelectedIndex())});return this._onSelectedChanged=n=>{const t=jQuery.Event("dropdown:changed");t.selectedIndex=n;t.value=n>=0&&n<r.length?r[n]:null;t.value!=null&&(this.trigger(t),f=t.value)},this}}(jQuery);
/*! pako 2.0.3 https://github.com/nodeca/pako @license (MIT AND Zlib) */
(function(n,t){typeof exports=="object"&&typeof module!="undefined"?t(exports):typeof define=="function"&&define.amd?define(["exports"],t):(n=typeof globalThis!="undefined"?globalThis:n||self,t(n.pako={}))})(this,function(n){"use strict";function lt(n){let t=n.length;while(--t>=0)n[t]=0}function vr(n,t,i,r,u){this.static_tree=n;this.extra_bits=t;this.extra_base=i;this.elems=r;this.max_length=u;this.has_stree=n&&n.length}function yr(n,t){this.dyn_tree=n;this.max_code=0;this.stat_desc=t}function v(n,t,i,r,u){this.good_length=n;this.max_lazy=t;this.nice_length=i;this.max_chain=r;this.func=u}function el(){this.strm=null;this.status=0;this.pending_buf=null;this.pending_buf_size=0;this.pending_out=0;this.pending=0;this.wrap=0;this.gzhead=null;this.gzindex=0;this.method=wi;this.last_flush=-1;this.w_size=0;this.w_bits=0;this.w_mask=0;this.window=null;this.window_size=0;this.prev=null;this.head=null;this.ins_h=0;this.hash_size=0;this.hash_bits=0;this.hash_mask=0;this.hash_shift=0;this.block_start=0;this.match_length=0;this.prev_match=0;this.match_available=0;this.strstart=0;this.match_start=0;this.lookahead=0;this.prev_length=0;this.max_chain_length=0;this.max_lazy_match=0;this.level=0;this.strategy=0;this.good_match=0;this.nice_match=0;this.dyn_ltree=new Uint16Array(bc*2);this.dyn_dtree=new Uint16Array((2*pc+1)*2);this.bl_tree=new Uint16Array((2*wc+1)*2);nt(this.dyn_ltree);nt(this.dyn_dtree);nt(this.bl_tree);this.l_desc=null;this.d_desc=null;this.bl_desc=null;this.bl_count=new Uint16Array(kc+1);this.heap=new Uint16Array(2*kr+1);nt(this.heap);this.heap_len=0;this.heap_max=0;this.depth=new Uint16Array(2*kr+1);nt(this.depth);this.l_buf=0;this.lit_bufsize=0;this.last_lit=0;this.d_buf=0;this.opt_len=0;this.static_len=0;this.matches=0;this.insert=0;this.bi_buf=0;this.bi_valid=0}function fa(){this.input=null;this.next_in=0;this.avail_in=0;this.total_in=0;this.output=null;this.next_out=0;this.avail_out=0;this.total_out=0;this.msg="";this.state=null;this.data_type=2;this.adler=0}function ci(n){this.options=nr.assign({level:la,method:va,chunkSize:16384,windowBits:15,memLevel:8,strategy:aa},n||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16);this.err=0;this.msg="";this.ended=!1;this.chunks=[];this.strm=new nu;this.strm.avail_out=0;let i=oi.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(i!==tr)throw new Error(ut[i]);if(t.header&&oi.deflateSetHeader(this.strm,t.header),t.dictionary){let n;if(n=typeof t.dictionary=="string"?hi.string2buf(t.dictionary):te.call(t.dictionary)==="[object ArrayBuffer]"?new Uint8Array(t.dictionary):t.dictionary,i=oi.deflateSetDictionary(this.strm,n),i!==tr)throw new Error(ut[i]);this._dict_set=!0}}function tu(n,t){const i=new ci(t);if(i.push(n,!0),i.err)throw i.msg||ut[i.err];return i.result}function ya(n,t){return t=t||{},t.raw=!0,tu(n,t)}function pa(n,t){return t=t||{},t.gzip=!0,tu(n,t)}function wv(){this.mode=0;this.last=!1;this.wrap=0;this.havedict=!1;this.flags=0;this.dmax=0;this.check=0;this.total=0;this.head=null;this.wbits=0;this.wsize=0;this.whave=0;this.wnext=0;this.window=null;this.hold=0;this.bits=0;this.length=0;this.offset=0;this.extra=0;this.lencode=null;this.distcode=null;this.lenbits=0;this.distbits=0;this.ncode=0;this.nlen=0;this.ndist=0;this.have=0;this.next=null;this.lens=new Uint16Array(320);this.work=new Uint16Array(288);this.lendyn=null;this.distdyn=null;this.sane=0;this.back=0;this.was=0}function ly(){this.text=0;this.time=0;this.xflags=0;this.os=0;this.extra=null;this.extra_len=0;this.name="";this.comment="";this.hcrc=0;this.done=!1}function ai(n){this.options=nr.assign({chunkSize:65536,windowBits:15,to:""},n||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15));t.windowBits>=0&&t.windowBits<16&&!(n&&n.windowBits)&&(t.windowBits+=32);t.windowBits>15&&t.windowBits<48&&(t.windowBits&15)==0&&(t.windowBits|=15);this.err=0;this.msg="";this.ended=!1;this.chunks=[];this.strm=new nu;this.strm.avail_out=0;let i=w.inflateInit2(this.strm,t.windowBits);if(i!==li)throw new Error(ut[i]);if(this.header=new is,w.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=hi.string2buf(t.dictionary):rs.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(i=w.inflateSetDictionary(this.strm,t.dictionary),i!==li)))throw new Error(ut[i]);}function cu(n,t){const i=new ai(t);if(i.push(n),i.err)throw i.msg||ut[i.err];return i.result}function wy(n,t){return t=t||{},t.raw=!0,cu(n,t)}var vt,ne,nu,ie,bt,is;const ys=4,lu=0,au=1,ps=2;const ws=0,vu=1,bs=2,or=29,kt=256,dt=kt+1+or,at=30,sr=19,yu=2*dt+1,rt=15,hr=16,ks=7,cr=256,pu=16,wu=17,bu=18,lr=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),vi=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),ds=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),ku=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),y=new Array((dt+2)*2);lt(y);const gt=new Array(at*2);lt(gt);const ni=new Array(512);lt(ni);const ti=new Array(256);lt(ti);const ar=new Array(or);lt(ar);const yi=new Array(at);lt(yi);let du,gu,nf;const tf=n=>n<256?ni[n]:ni[256+(n>>>7)],ii=(n,t)=>{n.pending_buf[n.pending++]=t&255,n.pending_buf[n.pending++]=t>>>8&255},o=(n,t,i)=>{n.bi_valid>hr-i?(n.bi_buf|=t<<n.bi_valid&65535,ii(n,n.bi_buf),n.bi_buf=t>>hr-n.bi_valid,n.bi_valid+=i-hr):(n.bi_buf|=t<<n.bi_valid&65535,n.bi_valid+=i)},l=(n,t,i)=>{o(n,i[t*2],i[t*2+1])},rf=(n,t)=>{let i=0;do i|=n&1,n>>>=1,i<<=1;while(--t>0);return i>>>1},gs=n=>{n.bi_valid===16?(ii(n,n.bi_buf),n.bi_buf=0,n.bi_valid=0):n.bi_valid>=8&&(n.pending_buf[n.pending++]=n.bi_buf&255,n.bi_buf>>=8,n.bi_valid-=8)},nh=(n,t)=>{const u=t.dyn_tree,l=t.max_code,v=t.stat_desc.static_tree,y=t.stat_desc.has_stree,p=t.stat_desc.extra_bits,a=t.stat_desc.extra_base,e=t.stat_desc.max_length;let o,r,f,i,s,c,h=0;for(i=0;i<=rt;i++)n.bl_count[i]=0;for(u[n.heap[n.heap_max]*2+1]=0,o=n.heap_max+1;o<yu;o++)(r=n.heap[o],i=u[u[r*2+1]*2+1]+1,i>e&&(i=e,h++),u[r*2+1]=i,r>l)||(n.bl_count[i]++,s=0,r>=a&&(s=p[r-a]),c=u[r*2],n.opt_len+=c*(i+s),y&&(n.static_len+=c*(v[r*2+1]+s)));if(h!==0){do{for(i=e-1;n.bl_count[i]===0;)i--;n.bl_count[i]--;n.bl_count[i+1]+=2;n.bl_count[e]--;h-=2}while(h>0);for(i=e;i!==0;i--)for(r=n.bl_count[i];r!==0;)(f=n.heap[--o],f>l)||(u[f*2+1]!==i&&(n.opt_len+=(i-u[f*2+1])*u[f*2],u[f*2+1]=i),r--)}},uf=(n,t,i)=>{const f=new Array(rt+1);let e=0,r,u;for(r=1;r<=rt;r++)f[r]=e=e+i[r-1]<<1;for(u=0;u<=t;u++){let t=n[u*2+1];t!==0&&(n[u*2]=rf(f[t]++,t))}},th=()=>{let n,u,f,t,i;const r=new Array(rt+1);for(f=0,t=0;t<or-1;t++)for(ar[t]=f,n=0;n<1<<lr[t];n++)ti[f++]=t;for(ti[f-1]=t,i=0,t=0;t<16;t++)for(yi[t]=i,n=0;n<1<<vi[t];n++)ni[i++]=t;for(i>>=7;t<at;t++)for(yi[t]=i<<7,n=0;n<1<<vi[t]-7;n++)ni[256+i++]=t;for(u=0;u<=rt;u++)r[u]=0;for(n=0;n<=143;)y[n*2+1]=8,n++,r[8]++;while(n<=255)y[n*2+1]=9,n++,r[9]++;while(n<=279)y[n*2+1]=7,n++,r[7]++;while(n<=287)y[n*2+1]=8,n++,r[8]++;for(uf(y,dt+1,r),n=0;n<at;n++)gt[n*2+1]=5,gt[n*2]=rf(n,5);du=new vr(y,lr,kt+1,dt,rt);gu=new vr(gt,vi,0,at,rt);nf=new vr(new Array(0),ds,0,sr,ks)},ff=n=>{let t;for(t=0;t<dt;t++)n.dyn_ltree[t*2]=0;for(t=0;t<at;t++)n.dyn_dtree[t*2]=0;for(t=0;t<sr;t++)n.bl_tree[t*2]=0;n.dyn_ltree[cr*2]=1;n.opt_len=n.static_len=0;n.last_lit=n.matches=0},ef=n=>{n.bi_valid>8?ii(n,n.bi_buf):n.bi_valid>0&&(n.pending_buf[n.pending++]=n.bi_buf),n.bi_buf=0,n.bi_valid=0},ih=(n,t,i,r)=>{ef(n),r&&(ii(n,i),ii(n,~i)),n.pending_buf.set(n.window.subarray(t,t+i),n.pending),n.pending+=i},of=(n,t,i,r)=>{const u=t*2,f=i*2;return n[u]<n[f]||n[u]===n[f]&&r[t]<=r[i]},pr=(n,t,i)=>{const u=n.heap[i];let r=i<<1;while(r<=n.heap_len){if(r<n.heap_len&&of(t,n.heap[r+1],n.heap[r],n.depth)&&r++,of(t,u,n.heap[r],n.depth))break;n.heap[i]=n.heap[r];i=r;r<<=1}n.heap[i]=u},sf=(n,t,i)=>{let u,e,s=0,r,f;if(n.last_lit!==0)do u=n.pending_buf[n.d_buf+s*2]<<8|n.pending_buf[n.d_buf+s*2+1],e=n.pending_buf[n.l_buf+s],s++,u===0?l(n,e,t):(r=ti[e],l(n,r+kt+1,t),f=lr[r],f!==0&&(e-=ar[r],o(n,e,f)),u--,r=tf(u),l(n,r,i),f=vi[r],f!==0&&(u-=yi[r],o(n,u,f)));while(s<n.last_lit);l(n,cr,t)},wr=(n,t)=>{const r=t.dyn_tree,s=t.stat_desc.static_tree,h=t.stat_desc.has_stree,o=t.stat_desc.elems;let i,f,e=-1,u;for(n.heap_len=0,n.heap_max=yu,i=0;i<o;i++)r[i*2]!==0?(n.heap[++n.heap_len]=e=i,n.depth[i]=0):r[i*2+1]=0;while(n.heap_len<2)u=n.heap[++n.heap_len]=e<2?++e:0,r[u*2]=1,n.depth[u]=0,n.opt_len--,h&&(n.static_len-=s[u*2+1]);for(t.max_code=e,i=n.heap_len>>1;i>=1;i--)pr(n,r,i);u=o;do i=n.heap[1],n.heap[1]=n.heap[n.heap_len--],pr(n,r,1),f=n.heap[1],n.heap[--n.heap_max]=i,n.heap[--n.heap_max]=f,r[u*2]=r[i*2]+r[f*2],n.depth[u]=(n.depth[i]>=n.depth[f]?n.depth[i]:n.depth[f])+1,r[i*2+1]=r[f*2+1]=u,n.heap[1]=u++,pr(n,r,1);while(n.heap_len>=2);n.heap[--n.heap_max]=n.heap[1];nh(n,t);uf(r,e,n.bl_count)},hf=(n,t,i)=>{let s,h=-1,r,u=t[1],f=0,e=7,o=4;for(u===0&&(e=138,o=3),t[(i+1)*2+1]=65535,s=0;s<=i;s++){if(r=u,u=t[(s+1)*2+1],++f<e&&r===u)continue;else f<o?n.bl_tree[r*2]+=f:r!==0?(r!==h&&n.bl_tree[r*2]++,n.bl_tree[pu*2]++):f<=10?n.bl_tree[wu*2]++:n.bl_tree[bu*2]++;f=0;h=r;u===0?(e=138,o=3):r===u?(e=6,o=3):(e=7,o=4)}},cf=(n,t,i)=>{let h,c=-1,u,f=t[1],r=0,e=7,s=4;for(f===0&&(e=138,s=3),h=0;h<=i;h++){if(u=f,f=t[(h+1)*2+1],++r<e&&u===f)continue;else if(r<s){do l(n,u,n.bl_tree);while(--r!=0)}else u!==0?(u!==c&&(l(n,u,n.bl_tree),r--),l(n,pu,n.bl_tree),o(n,r-3,2)):r<=10?(l(n,wu,n.bl_tree),o(n,r-3,3)):(l(n,bu,n.bl_tree),o(n,r-11,7));r=0;c=u;f===0?(e=138,s=3):u===f?(e=6,s=3):(e=7,s=4)}},rh=n=>{let t;for(hf(n,n.dyn_ltree,n.l_desc.max_code),hf(n,n.dyn_dtree,n.d_desc.max_code),wr(n,n.bl_desc),t=sr-1;t>=3;t--)if(n.bl_tree[ku[t]*2+1]!==0)break;return n.opt_len+=3*(t+1)+5+5+4,t},uh=(n,t,i,r)=>{let u;for(o(n,t-257,5),o(n,i-1,5),o(n,r-4,4),u=0;u<r;u++)o(n,n.bl_tree[ku[u]*2+1],3);cf(n,n.dyn_ltree,t-1);cf(n,n.dyn_dtree,i-1)},fh=n=>{let i=4093624447,t;for(t=0;t<=31;t++,i>>>=1)if(i&1&&n.dyn_ltree[t*2]!==0)return lu;if(n.dyn_ltree[18]!==0||n.dyn_ltree[20]!==0||n.dyn_ltree[26]!==0)return au;for(t=32;t<kt;t++)if(n.dyn_ltree[t*2]!==0)return au;return lu};let lf=!1;const eh=n=>{lf||(th(),lf=!0),n.l_desc=new yr(n.dyn_ltree,du),n.d_desc=new yr(n.dyn_dtree,gu),n.bl_desc=new yr(n.bl_tree,nf),n.bi_buf=0,n.bi_valid=0,ff(n)},af=(n,t,i,r)=>{o(n,(ws<<1)+(r?1:0),3),ih(n,t,i,!0)},oh=n=>{o(n,vu<<1,3),l(n,cr,y),gs(n)},sh=(n,t,i,r)=>{let u,f,e=0;n.level>0?(n.strm.data_type===ps&&(n.strm.data_type=fh(n)),wr(n,n.l_desc),wr(n,n.d_desc),e=rh(n),u=n.opt_len+3+7>>>3,f=n.static_len+3+7>>>3,f<=u&&(u=f)):u=f=i+5;i+4<=u&&t!==-1?af(n,t,i,r):n.strategy===ys||f===u?(o(n,(vu<<1)+(r?1:0),3),sf(n,y,gt)):(o(n,(bs<<1)+(r?1:0),3),uh(n,n.l_desc.max_code+1,n.d_desc.max_code+1,e+1),sf(n,n.dyn_ltree,n.dyn_dtree));ff(n);r&&ef(n)},hh=(n,t,i)=>(n.pending_buf[n.d_buf+n.last_lit*2]=t>>>8&255,n.pending_buf[n.d_buf+n.last_lit*2+1]=t&255,n.pending_buf[n.l_buf+n.last_lit]=i&255,n.last_lit++,t===0?n.dyn_ltree[i*2]++:(n.matches++,t--,n.dyn_ltree[(ti[i]+kt+1)*2]++,n.dyn_dtree[tf(t)*2]++),n.last_lit===n.lit_bufsize-1);var ch=eh,lh=af,ah=sh,vh=hh,yh=oh,ph={_tr_init:ch,_tr_stored_block:lh,_tr_flush_block:ah,_tr_tally:vh,_tr_align:yh};const wh=(n,t,i,r)=>{let u=n&65535|0,f=n>>>16&65535|0,e=0;while(i!==0){e=i>2e3?2e3:i;i-=e;do u=u+t[r++]|0,f=f+u|0;while(--e);u%=65521;f%=65521}return u|f<<16|0};vt=wh;const bh=()=>{var t,i;let n,r=[];for(t=0;t<256;t++){for(n=t,i=0;i<8;i++)n=n&1?3988292384^n>>>1:n>>>1;r[t]=n}return r},kh=new Uint32Array(bh()),dh=(n,t,i,r)=>{const u=kh,f=r+i;n^=-1;for(let i=r;i<f;i++)n=n>>>8^u[(n^t[i])&255];return n^-1};var f=dh,ut={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},ft={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:gh,_tr_stored_block:nc,_tr_flush_block:tc,_tr_tally:b,_tr_align:ic}=ph,{Z_NO_FLUSH:et,Z_PARTIAL_FLUSH:rc,Z_FULL_FLUSH:uc,Z_FINISH:k,Z_BLOCK:vf,Z_OK:a,Z_STREAM_END:yf,Z_STREAM_ERROR:s,Z_DATA_ERROR:fc,Z_BUF_ERROR:br,Z_DEFAULT_COMPRESSION:ec,Z_FILTERED:oc,Z_HUFFMAN_ONLY:pi,Z_RLE:sc,Z_FIXED:hc,Z_DEFAULT_STRATEGY:cc,Z_UNKNOWN:lc,Z_DEFLATED:wi}=ft,ac=9,vc=15,yc=8,kr=286,pc=30,wc=19,bc=2*kr+1,kc=15,t=3,d=258,c=d+t+1,dc=32,bi=42,dr=69,ki=73,di=91,gi=103,ot=113,ri=666,u=1,ui=2,st=3,yt=4,gc=3,g=(n,t)=>(n.msg=ut[t],t),pf=n=>(n<<1)-(n>4?9:0),nt=n=>{let t=n.length;while(--t>=0)n[t]=0};let nl=(n,t,i)=>(t<<n.hash_shift^i)&n.hash_mask,tt=nl;const it=n=>{const i=n.state;let t=i.pending;(t>n.avail_out&&(t=n.avail_out),t!==0)&&(n.output.set(i.pending_buf.subarray(i.pending_out,i.pending_out+t),n.next_out),n.next_out+=t,i.pending_out+=t,n.total_out+=t,n.avail_out-=t,i.pending-=t,i.pending===0&&(i.pending_out=0))},e=(n,t)=>{tc(n,n.block_start>=0?n.block_start:-1,n.strstart-n.block_start,t),n.block_start=n.strstart,it(n.strm)},i=(n,t)=>{n.pending_buf[n.pending++]=t},fi=(n,t)=>{n.pending_buf[n.pending++]=t>>>8&255,n.pending_buf[n.pending++]=t&255},tl=(n,t,i,r)=>{let u=n.avail_in;return(u>r&&(u=r),u===0)?0:(n.avail_in-=u,t.set(n.input.subarray(n.next_in,n.next_in+u),i),n.state.wrap===1?n.adler=vt(n.adler,t,u,i):n.state.wrap===2&&(n.adler=f(n.adler,t,u,i)),n.next_in+=u,n.total_in+=u,u)},wf=(n,t)=>{let h=n.max_chain_length,r=n.strstart,u,e,f=n.prev_length,o=n.nice_match;const v=n.strstart>n.w_size-c?n.strstart-(n.w_size-c):0,i=n.window,y=n.w_mask,p=n.prev,s=n.strstart+d;let l=i[r+f-1],a=i[r+f];n.prev_length>=n.good_match&&(h>>=2);o>n.lookahead&&(o=n.lookahead);do if(u=t,i[u+f]===a&&i[u+f-1]===l&&i[u]===i[r]&&i[++u]===i[r+1]){r+=2;u++;do;while(i[++r]===i[++u]&&i[++r]===i[++u]&&i[++r]===i[++u]&&i[++r]===i[++u]&&i[++r]===i[++u]&&i[++r]===i[++u]&&i[++r]===i[++u]&&i[++r]===i[++u]&&r<s);if(e=d-(s-r),r=s-d,e>f){if(n.match_start=t,f=e,e>=o)break;l=i[r+f-1];a=i[r+f]}}while((t=p[t&y])>v&&--h!=0);return f<=n.lookahead?f:n.lookahead},ht=n=>{const i=n.w_size;let f,r,e,o,u;do{if(o=n.window_size-n.lookahead-n.strstart,n.strstart>=i+(i-c)){n.window.set(n.window.subarray(i,i+i),0);n.match_start-=i;n.strstart-=i;n.block_start-=i;r=n.hash_size;f=r;do e=n.head[--f],n.head[f]=e>=i?e-i:0;while(--r);r=i;f=r;do e=n.prev[--f],n.prev[f]=e>=i?e-i:0;while(--r);o+=i}if(n.strm.avail_in===0)break;if(r=tl(n.strm,n.window,n.strstart+n.lookahead,o),n.lookahead+=r,n.lookahead+n.insert>=t)for(u=n.strstart-n.insert,n.ins_h=n.window[u],n.ins_h=tt(n,n.ins_h,n.window[u+1]);n.insert;)if(n.ins_h=tt(n,n.ins_h,n.window[u+t-1]),n.prev[u&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=u,u++,n.insert--,n.lookahead+n.insert<t)break}while(n.lookahead<c&&n.strm.avail_in!==0)},il=(n,t)=>{let i=65535;for(i>n.pending_buf_size-5&&(i=n.pending_buf_size-5);;){if(n.lookahead<=1){if(ht(n),n.lookahead===0&&t===et)return u;if(n.lookahead===0)break}n.strstart+=n.lookahead;n.lookahead=0;const r=n.block_start+i;if((n.strstart===0||n.strstart>=r)&&(n.lookahead=n.strstart-r,n.strstart=r,e(n,!1),n.strm.avail_out===0)||n.strstart-n.block_start>=n.w_size-c&&(e(n,!1),n.strm.avail_out===0))return u}return(n.insert=0,t===k)?(e(n,!0),n.strm.avail_out===0)?st:yt:(n.strstart>n.block_start&&(e(n,!1),n.strm.avail_out===0),u)},gr=(n,i)=>{let r,f;for(;;){if(n.lookahead<c){if(ht(n),n.lookahead<c&&i===et)return u;if(n.lookahead===0)break}if(r=0,n.lookahead>=t&&(n.ins_h=tt(n,n.ins_h,n.window[n.strstart+t-1]),r=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart),r!==0&&n.strstart-r<=n.w_size-c&&(n.match_length=wf(n,r)),n.match_length>=t)if(f=b(n,n.strstart-n.match_start,n.match_length-t),n.lookahead-=n.match_length,n.match_length<=n.max_lazy_match&&n.lookahead>=t){n.match_length--;do n.strstart++,n.ins_h=tt(n,n.ins_h,n.window[n.strstart+t-1]),r=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart;while(--n.match_length!=0);n.strstart++}else n.strstart+=n.match_length,n.match_length=0,n.ins_h=n.window[n.strstart],n.ins_h=tt(n,n.ins_h,n.window[n.strstart+1]);else f=b(n,0,n.window[n.strstart]),n.lookahead--,n.strstart++;if(f&&(e(n,!1),n.strm.avail_out===0))return u}return(n.insert=n.strstart<t-1?n.strstart:t-1,i===k)?(e(n,!0),n.strm.avail_out===0)?st:yt:n.last_lit&&(e(n,!1),n.strm.avail_out===0)?u:ui},pt=(n,i)=>{let r,f,o;for(;;){if(n.lookahead<c){if(ht(n),n.lookahead<c&&i===et)return u;if(n.lookahead===0)break}if(r=0,n.lookahead>=t&&(n.ins_h=tt(n,n.ins_h,n.window[n.strstart+t-1]),r=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart),n.prev_length=n.match_length,n.prev_match=n.match_start,n.match_length=t-1,r!==0&&n.prev_length<n.max_lazy_match&&n.strstart-r<=n.w_size-c&&(n.match_length=wf(n,r),n.match_length<=5&&(n.strategy===oc||n.match_length===t&&n.strstart-n.match_start>4096)&&(n.match_length=t-1)),n.prev_length>=t&&n.match_length<=n.prev_length){o=n.strstart+n.lookahead-t;f=b(n,n.strstart-1-n.prev_match,n.prev_length-t);n.lookahead-=n.prev_length-1;n.prev_length-=2;do++n.strstart<=o&&(n.ins_h=tt(n,n.ins_h,n.window[n.strstart+t-1]),r=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart);while(--n.prev_length!=0);if(n.match_available=0,n.match_length=t-1,n.strstart++,f&&(e(n,!1),n.strm.avail_out===0))return u}else if(n.match_available){if(f=b(n,0,n.window[n.strstart-1]),f&&e(n,!1),n.strstart++,n.lookahead--,n.strm.avail_out===0)return u}else n.match_available=1,n.strstart++,n.lookahead--}return(n.match_available&&(f=b(n,0,n.window[n.strstart-1]),n.match_available=0),n.insert=n.strstart<t-1?n.strstart:t-1,i===k)?(e(n,!0),n.strm.avail_out===0)?st:yt:n.last_lit&&(e(n,!1),n.strm.avail_out===0)?u:ui},rl=(n,i)=>{let s,f,r,h;const o=n.window;for(;;){if(n.lookahead<=d){if(ht(n),n.lookahead<=d&&i===et)return u;if(n.lookahead===0)break}if(n.match_length=0,n.lookahead>=t&&n.strstart>0&&(r=n.strstart-1,f=o[r],f===o[++r]&&f===o[++r]&&f===o[++r])){h=n.strstart+d;do;while(f===o[++r]&&f===o[++r]&&f===o[++r]&&f===o[++r]&&f===o[++r]&&f===o[++r]&&f===o[++r]&&f===o[++r]&&r<h);n.match_length=d-(h-r);n.match_length>n.lookahead&&(n.match_length=n.lookahead)}if(n.match_length>=t?(s=b(n,1,n.match_length-t),n.lookahead-=n.match_length,n.strstart+=n.match_length,n.match_length=0):(s=b(n,0,n.window[n.strstart]),n.lookahead--,n.strstart++),s&&(e(n,!1),n.strm.avail_out===0))return u}return(n.insert=0,i===k)?(e(n,!0),n.strm.avail_out===0)?st:yt:n.last_lit&&(e(n,!1),n.strm.avail_out===0)?u:ui},ul=(n,t)=>{let i;for(;;){if(n.lookahead===0&&(ht(n),n.lookahead===0)){if(t===et)return u;break}if(n.match_length=0,i=b(n,0,n.window[n.strstart]),n.lookahead--,n.strstart++,i&&(e(n,!1),n.strm.avail_out===0))return u}return(n.insert=0,t===k)?(e(n,!0),n.strm.avail_out===0)?st:yt:n.last_lit&&(e(n,!1),n.strm.avail_out===0)?u:ui};const ei=[new v(0,0,0,0,il),new v(4,4,8,4,gr),new v(4,5,16,8,gr),new v(4,6,32,32,gr),new v(4,4,16,16,pt),new v(8,16,32,32,pt),new v(8,16,128,128,pt),new v(8,32,128,256,pt),new v(32,128,258,1024,pt),new v(32,258,258,4096,pt)],fl=n=>{n.window_size=2*n.w_size,nt(n.head),n.max_lazy_match=ei[n.level].max_lazy,n.good_match=ei[n.level].good_length,n.nice_match=ei[n.level].nice_length,n.max_chain_length=ei[n.level].max_chain,n.strstart=0,n.block_start=0,n.lookahead=0,n.insert=0,n.match_length=n.prev_length=t-1,n.match_available=0,n.ins_h=0};const bf=n=>{if(!n||!n.state)return g(n,s);n.total_in=n.total_out=0;n.data_type=lc;const t=n.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?bi:ot,n.adler=t.wrap===2?0:1,t.last_flush=et,gh(t),a},kf=n=>{const t=bf(n);return t===a&&fl(n.state),t},ol=(n,t)=>!n||!n.state?s:n.state.wrap!==2?s:(n.state.gzhead=t,a),df=(n,i,r,u,f,e)=>{if(!n)return s;let h=1;if(i===ec&&(i=6),u<0?(h=0,u=-u):u>15&&(h=2,u-=16),f<1||f>ac||r!==wi||u<8||u>15||i<0||i>9||e<0||e>hc)return g(n,s);u===8&&(u=9);const o=new el;return n.state=o,o.strm=n,o.wrap=h,o.gzhead=null,o.w_bits=u,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=f+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+t-1)/t),o.window=new Uint8Array(o.w_size*2),o.head=new Uint16Array(o.hash_size),o.prev=new Uint16Array(o.w_size),o.lit_bufsize=1<<f+6,o.pending_buf_size=o.lit_bufsize*4,o.pending_buf=new Uint8Array(o.pending_buf_size),o.d_buf=1*o.lit_bufsize,o.l_buf=3*o.lit_bufsize,o.level=i,o.strategy=e,o.method=r,kf(n)},sl=(n,t)=>df(n,t,wi,vc,yc,cc),hl=(n,t)=>{let e,o;if(!n||!n.state||t>vf||t<0)return n?g(n,s):s;const r=n.state;if(!n.output||!n.input&&n.avail_in!==0||r.status===ri&&t!==k)return g(n,n.avail_out===0?br:s);r.strm=n;const h=r.last_flush;if(r.last_flush=t,r.status===bi)if(r.wrap===2)n.adler=0,i(r,31),i(r,139),i(r,8),r.gzhead?(i(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),i(r,r.gzhead.time&255),i(r,r.gzhead.time>>8&255),i(r,r.gzhead.time>>16&255),i(r,r.gzhead.time>>24&255),i(r,r.level===9?2:r.strategy>=pi||r.level<2?4:0),i(r,r.gzhead.os&255),r.gzhead.extra&&r.gzhead.extra.length&&(i(r,r.gzhead.extra.length&255),i(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(n.adler=f(n.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=dr):(i(r,0),i(r,0),i(r,0),i(r,0),i(r,0),i(r,r.level===9?2:r.strategy>=pi||r.level<2?4:0),i(r,gc),r.status=ot);else{let t=wi+(r.w_bits-8<<4)<<8,i=-1;i=r.strategy>=pi||r.level<2?0:r.level<6?1:r.level===6?2:3;t|=i<<6;r.strstart!==0&&(t|=dc);t+=31-t%31;r.status=ot;fi(r,t);r.strstart!==0&&(fi(r,n.adler>>>16),fi(r,n.adler&65535));n.adler=1}if(r.status===dr)if(r.gzhead.extra){for(e=r.pending;r.gzindex<(r.gzhead.extra.length&65535);){if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>e&&(n.adler=f(n.adler,r.pending_buf,r.pending-e,e)),it(n),e=r.pending,r.pending===r.pending_buf_size))break;i(r,r.gzhead.extra[r.gzindex]&255);r.gzindex++}r.gzhead.hcrc&&r.pending>e&&(n.adler=f(n.adler,r.pending_buf,r.pending-e,e));r.gzindex===r.gzhead.extra.length&&(r.gzindex=0,r.status=ki)}else r.status=ki;if(r.status===ki)if(r.gzhead.name){e=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>e&&(n.adler=f(n.adler,r.pending_buf,r.pending-e,e)),it(n),e=r.pending,r.pending===r.pending_buf_size)){o=1;break}o=r.gzindex<r.gzhead.name.length?r.gzhead.name.charCodeAt(r.gzindex++)&255:0;i(r,o)}while(o!==0);r.gzhead.hcrc&&r.pending>e&&(n.adler=f(n.adler,r.pending_buf,r.pending-e,e));o===0&&(r.gzindex=0,r.status=di)}else r.status=di;if(r.status===di)if(r.gzhead.comment){e=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>e&&(n.adler=f(n.adler,r.pending_buf,r.pending-e,e)),it(n),e=r.pending,r.pending===r.pending_buf_size)){o=1;break}o=r.gzindex<r.gzhead.comment.length?r.gzhead.comment.charCodeAt(r.gzindex++)&255:0;i(r,o)}while(o!==0);r.gzhead.hcrc&&r.pending>e&&(n.adler=f(n.adler,r.pending_buf,r.pending-e,e));o===0&&(r.status=gi)}else r.status=gi;if(r.status===gi&&(r.gzhead.hcrc?(r.pending+2>r.pending_buf_size&&it(n),r.pending+2<=r.pending_buf_size&&(i(r,n.adler&255),i(r,n.adler>>8&255),n.adler=0,r.status=ot)):r.status=ot),r.pending!==0){if(it(n),n.avail_out===0)return r.last_flush=-1,a}else if(n.avail_in===0&&pf(t)<=pf(h)&&t!==k)return g(n,br);if(r.status===ri&&n.avail_in!==0)return g(n,br);if(n.avail_in!==0||r.lookahead!==0||t!==et&&r.status!==ri){let i=r.strategy===pi?ul(r,t):r.strategy===sc?rl(r,t):ei[r.level].func(r,t);if((i===st||i===yt)&&(r.status=ri),i===u||i===st)return n.avail_out===0&&(r.last_flush=-1),a;if(i===ui&&(t===rc?ic(r):t!==vf&&(nc(r,0,0,!1),t===uc&&(nt(r.head),r.lookahead===0&&(r.strstart=0,r.block_start=0,r.insert=0))),it(n),n.avail_out===0))return r.last_flush=-1,a}return t!==k?a:r.wrap<=0?yf:(r.wrap===2?(i(r,n.adler&255),i(r,n.adler>>8&255),i(r,n.adler>>16&255),i(r,n.adler>>24&255),i(r,n.total_in&255),i(r,n.total_in>>8&255),i(r,n.total_in>>16&255),i(r,n.total_in>>24&255)):(fi(r,n.adler>>>16),fi(r,n.adler&65535)),it(n),r.wrap>0&&(r.wrap=-r.wrap),r.pending!==0?a:yf)},cl=n=>{if(!n||!n.state)return s;const t=n.state.status;return t!==bi&&t!==dr&&t!==ki&&t!==di&&t!==gi&&t!==ot&&t!==ri?g(n,s):(n.state=null,t===ot?g(n,fc):a)},ll=(n,i)=>{let u=i.length;if(!n||!n.state)return s;const r=n.state,f=r.wrap;if(f===2||f===1&&r.status!==bi||r.lookahead)return s;if(f===1&&(n.adler=vt(n.adler,i,u,0)),r.wrap=0,u>=r.w_size){f===0&&(nt(r.head),r.strstart=0,r.block_start=0,r.insert=0);let n=new Uint8Array(r.w_size);n.set(i.subarray(u-r.w_size,u),0);i=n;u=r.w_size}const e=n.avail_in,o=n.next_in,h=n.input;for(n.avail_in=u,n.next_in=0,n.input=i,ht(r);r.lookahead>=t;){let n=r.strstart,i=r.lookahead-(t-1);do r.ins_h=tt(r,r.ins_h,r.window[n+t-1]),r.prev[n&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=n,n++;while(--i);r.strstart=n;r.lookahead=t-1;ht(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=t-1,r.match_available=0,n.next_in=o,n.input=h,n.avail_in=e,r.wrap=f,a};var al=sl,vl=df,yl=kf,pl=bf,wl=ol,bl=hl,kl=cl,dl=ll,oi={deflateInit:al,deflateInit2:vl,deflateReset:yl,deflateResetKeep:pl,deflateSetHeader:wl,deflate:bl,deflateEnd:kl,deflateSetDictionary:dl,deflateInfo:"pako deflate (from Nodeca project)"};const gl=(n,t)=>Object.prototype.hasOwnProperty.call(n,t);var na=function(n){const t=Array.prototype.slice.call(arguments,1);while(t.length){const i=t.shift();if(i){if(typeof i!="object")throw new TypeError(i+"must be non-object");for(const t in i)gl(i,t)&&(n[t]=i[t])}}return n},ta=n=>{let t=0;for(let i=0,r=n.length;i<r;i++)t+=n[i].length;const i=new Uint8Array(t);for(let t=0,r=0,u=n.length;t<u;t++){let u=n[t];i.set(u,r);r+=u.length}return i},nr={assign:na,flattenChunks:ta};let gf=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(lp){gf=!1}const si=new Uint8Array(256);for(let n=0;n<256;n++)si[n]=n>=252?6:n>=248?5:n>=240?4:n>=224?3:n>=192?2:1;si[254]=si[254]=1;ne=n=>{let r,t,f,i,u,e=n.length,o=0;for(i=0;i<e;i++)t=n.charCodeAt(i),(t&64512)==55296&&i+1<e&&(f=n.charCodeAt(i+1),(f&64512)==56320&&(t=65536+(t-55296<<10)+(f-56320),i++)),o+=t<128?1:t<2048?2:t<65536?3:4;for(r=new Uint8Array(o),u=0,i=0;u<o;i++)t=n.charCodeAt(i),(t&64512)==55296&&i+1<e&&(f=n.charCodeAt(i+1),(f&64512)==56320&&(t=65536+(t-55296<<10)+(f-56320),i++)),t<128?r[u++]=t:t<2048?(r[u++]=192|t>>>6,r[u++]=128|t&63):t<65536?(r[u++]=224|t>>>12,r[u++]=128|t>>>6&63,r[u++]=128|t&63):(r[u++]=240|t>>>18,r[u++]=128|t>>>12&63,r[u++]=128|t>>>6&63,r[u++]=128|t&63);return r};const ia=(n,t)=>{if(t<65534&&n.subarray&&gf)return String.fromCharCode.apply(null,n.length===t?n:n.subarray(0,t));let i="";for(let r=0;r<t;r++)i+=String.fromCharCode(n[r]);return i};var ra=(n,t)=>{let u,i;const f=t||n.length,r=new Array(f*2);for(i=0,u=0;u<f;){let t=n[u++];if(t<128){r[i++]=t;continue}let e=si[t];if(e>4){r[i++]=65533;u+=e-1;continue}for(t&=e===2?31:e===3?15:7;e>1&&u<f;)t=t<<6|n[u++]&63,e--;if(e>1){r[i++]=65533;continue}t<65536?r[i++]=t:(t-=65536,r[i++]=55296|t>>10&1023,r[i++]=56320|t&1023)}return ia(r,i)},ua=(n,t)=>{t=t||n.length;t>n.length&&(t=n.length);let i=t-1;while(i>=0&&(n[i]&192)==128)i--;return i<0?t:i===0?t:i+si[n[i]]>t?i:t},hi={string2buf:ne,buf2string:ra,utf8border:ua};nu=fa;const te=Object.prototype.toString,{Z_NO_FLUSH:ea,Z_SYNC_FLUSH:oa,Z_FULL_FLUSH:sa,Z_FINISH:ha,Z_OK:tr,Z_STREAM_END:ca,Z_DEFAULT_COMPRESSION:la,Z_DEFAULT_STRATEGY:aa,Z_DEFLATED:va}=ft;ci.prototype.push=function(n,t){const i=this.strm,f=this.options.chunkSize;let r,u;if(this.ended)return!1;for(u=t===~~t?t:t===!0?ha:ea,i.input=typeof n=="string"?hi.string2buf(n):te.call(n)==="[object ArrayBuffer]"?new Uint8Array(n):n,i.next_in=0,i.avail_in=i.input.length;;){if(i.avail_out===0&&(i.output=new Uint8Array(f),i.next_out=0,i.avail_out=f),(u===oa||u===sa)&&i.avail_out<=6){this.onData(i.output.subarray(0,i.next_out));i.avail_out=0;continue}if(r=oi.deflate(i,u),r===ca){if(i.next_out>0)this.onData(i.output.subarray(0,i.next_out));r=oi.deflateEnd(this.strm);this.onEnd(r);return this.ended=!0,r===tr}if(i.avail_out===0){this.onData(i.output);continue}if(u>0&&i.next_out>0){this.onData(i.output.subarray(0,i.next_out));i.avail_out=0;continue}if(i.avail_in===0)break}return!0};ci.prototype.onData=function(n){this.chunks.push(n)};ci.prototype.onEnd=function(n){n===tr&&(this.result=nr.flattenChunks(this.chunks));this.chunks=[];this.err=n;this.msg=this.strm.msg};var wa=ci,ba=tu,ka=ya,da=pa,ga=ft,nv={Deflate:wa,deflate:ba,deflateRaw:ka,gzip:da,constants:ga};const ir=30,tv=12;ie=function(n,t){let c,b,r,tt,k,it,d,rt,y,w,s,u,g,nt,ut,ft,l,i,o,a,e,v,p,f;const h=n.state;c=n.next_in;p=n.input;b=c+(n.avail_in-5);r=n.next_out;f=n.output;tt=r-(t-n.avail_out);k=r+(n.avail_out-257);it=h.dmax;d=h.wsize;rt=h.whave;y=h.wnext;w=h.window;s=h.hold;u=h.bits;g=h.lencode;nt=h.distcode;ut=(1<<h.lenbits)-1;ft=(1<<h.distbits)-1;n:do{u<15&&(s+=p[c++]<<u,u+=8,s+=p[c++]<<u,u+=8);l=g[s&ut];t:for(;;){if(i=l>>>24,s>>>=i,u-=i,i=l>>>16&255,i===0)f[r++]=l&65535;else if(i&16){o=l&65535;i&=15;i&&(u<i&&(s+=p[c++]<<u,u+=8),o+=s&(1<<i)-1,s>>>=i,u-=i);u<15&&(s+=p[c++]<<u,u+=8,s+=p[c++]<<u,u+=8);l=nt[s&ft];i:for(;;){if(i=l>>>24,s>>>=i,u-=i,i=l>>>16&255,i&16){if(a=l&65535,i&=15,u<i&&(s+=p[c++]<<u,u+=8,u<i&&(s+=p[c++]<<u,u+=8)),a+=s&(1<<i)-1,a>it){n.msg="invalid distance too far back";h.mode=ir;break n}if(s>>>=i,u-=i,i=r-tt,a>i){if(i=a-i,i>rt&&h.sane){n.msg="invalid distance too far back";h.mode=ir;break n}if(e=0,v=w,y===0){if(e+=d-i,i<o){o-=i;do f[r++]=w[e++];while(--i);e=r-a;v=f}}else if(y<i){if(e+=d+y-i,i-=y,i<o){o-=i;do f[r++]=w[e++];while(--i);if(e=0,y<o){i=y;o-=i;do f[r++]=w[e++];while(--i);e=r-a;v=f}}}else if(e+=y-i,i<o){o-=i;do f[r++]=w[e++];while(--i);e=r-a;v=f}while(o>2)f[r++]=v[e++],f[r++]=v[e++],f[r++]=v[e++],o-=3;o&&(f[r++]=v[e++],o>1&&(f[r++]=v[e++]))}else{e=r-a;do f[r++]=f[e++],f[r++]=f[e++],f[r++]=f[e++],o-=3;while(o>2);o&&(f[r++]=f[e++],o>1&&(f[r++]=f[e++]))}}else if((i&64)==0){l=nt[(l&65535)+(s&(1<<i)-1)];continue i}else{n.msg="invalid distance code";h.mode=ir;break n}break}}else if((i&64)==0){l=g[(l&65535)+(s&(1<<i)-1)];continue t}else if(i&32){h.mode=tv;break n}else{n.msg="invalid literal/length code";h.mode=ir;break n}break}}while(c<b&&r<k);o=u>>3;c-=o;u-=o<<3;s&=(1<<u)-1;n.next_in=c;n.next_out=r;n.avail_in=c<b?5+(b-c):5-(c-b);n.avail_out=r<k?257+(k-r):257-(r-k);h.hold=s;h.bits=u;return};const wt=15,re=852,ue=592,fe=0,iu=1,ee=2,iv=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),rv=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),uv=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),fv=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),ev=(n,t,i,r,u,f,e,o)=>{const at=o.bits;let s=0,h=0,y=0,c=0,l=0,p=0,a=0,w=0,d=0,v=0,b,g,it,st,nt,rt=null,ht=0,tt;const k=new Uint16Array(wt+1),ut=new Uint16Array(wt+1);let ft=null,ct=0,lt,et,ot;for(s=0;s<=wt;s++)k[s]=0;for(h=0;h<r;h++)k[t[i+h]]++;for(l=at,c=wt;c>=1;c--)if(k[c]!==0)break;if(l>c&&(l=c),c===0)return u[f++]=20971520,u[f++]=20971520,o.bits=1,0;for(y=1;y<c;y++)if(k[y]!==0)break;for(l<y&&(l=y),w=1,s=1;s<=wt;s++)if(w<<=1,w-=k[s],w<0)return-1;if(w>0&&(n===fe||c!==1))return-1;for(ut[1]=0,s=1;s<wt;s++)ut[s+1]=ut[s]+k[s];for(h=0;h<r;h++)t[i+h]!==0&&(e[ut[t[i+h]]++]=h);if(n===fe?(rt=ft=e,tt=19):n===iu?(rt=iv,ht-=257,ft=rv,ct-=257,tt=256):(rt=uv,ft=fv,tt=-1),v=0,h=0,s=y,nt=f,p=l,a=0,it=-1,d=1<<l,st=d-1,n===iu&&d>re||n===ee&&d>ue)return 1;for(;;){lt=s-a;e[h]<tt?(et=0,ot=e[h]):e[h]>tt?(et=ft[ct+e[h]],ot=rt[ht+e[h]]):(et=96,ot=0);b=1<<s-a;g=1<<p;y=g;do g-=b,u[nt+(v>>a)+g]=lt<<24|et<<16|ot|0;while(g!==0);for(b=1<<s-1;v&b;)b>>=1;if(b!==0?(v&=b-1,v+=b):v=0,h++,--k[s]==0){if(s===c)break;s=t[i+e[h]]}if(s>l&&(v&st)!==it){for(a===0&&(a=l),nt+=y,p=s-a,w=1<<p;p+a<c;){if(w-=k[p+a],w<=0)break;p++;w<<=1}if(d+=1<<p,n===iu&&d>re||n===ee&&d>ue)return 1;it=v&st;u[it]=l<<24|p<<16|nt-f|0}}return v!==0&&(u[nt+v]=s-a<<24|4194304),o.bits=l,0};bt=ev;const ov=0,oe=1,se=2,{Z_FINISH:he,Z_BLOCK:sv,Z_TREES:rr,Z_OK:ct,Z_STREAM_END:hv,Z_NEED_DICT:cv,Z_STREAM_ERROR:h,Z_DATA_ERROR:ce,Z_MEM_ERROR:le,Z_BUF_ERROR:lv,Z_DEFLATED:ae}=ft,ve=1,ye=2,pe=3,we=4,be=5,ke=6,de=7,ge=8,no=9,to=10,ur=11,p=12,ru=13,io=14,uu=15,ro=16,uo=17,fo=18,eo=19,fr=20,er=21,oo=22,so=23,ho=24,co=25,lo=26,fu=27,ao=28,vo=29,r=30,yo=31,av=32,vv=852,yv=592,pv=15,po=n=>(n>>>24&255)+(n>>>8&65280)+((n&65280)<<8)+((n&255)<<24);const wo=n=>{if(!n||!n.state)return h;const t=n.state;return n.total_in=n.total_out=t.total=0,n.msg="",t.wrap&&(n.adler=t.wrap&1),t.mode=ve,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(vv),t.distcode=t.distdyn=new Int32Array(yv),t.sane=1,t.back=-1,ct},bo=n=>{if(!n||!n.state)return h;const t=n.state;return t.wsize=0,t.whave=0,t.wnext=0,wo(n)},ko=(n,t)=>{let r;if(!n||!n.state)return h;const i=n.state;return(t<0?(r=0,t=-t):(r=(t>>4)+1,t<48&&(t&=15)),t&&(t<8||t>15))?h:(i.window!==null&&i.wbits!==t&&(i.window=null),i.wrap=r,i.wbits=t,bo(n))},go=(n,t)=>{if(!n)return h;const i=new wv;n.state=i;i.window=null;const r=ko(n,t);return r!==ct&&(n.state=null),r},bv=n=>go(n,pv);let ns=!0,eu,ou;const kv=n=>{if(ns){eu=new Int32Array(512);ou=new Int32Array(32);let t=0;while(t<144)n.lens[t++]=8;while(t<256)n.lens[t++]=9;while(t<280)n.lens[t++]=7;while(t<288)n.lens[t++]=8;for(bt(oe,n.lens,0,288,eu,0,n.work,{bits:9}),t=0;t<32;)n.lens[t++]=5;bt(se,n.lens,0,32,ou,0,n.work,{bits:5});ns=!1}n.lencode=eu;n.lenbits=9;n.distcode=ou;n.distbits=5},ts=(n,t,i,r)=>{let f;const u=n.state;return u.window===null&&(u.wsize=1<<u.wbits,u.wnext=0,u.whave=0,u.window=new Uint8Array(u.wsize)),r>=u.wsize?(u.window.set(t.subarray(i-u.wsize,i),0),u.wnext=0,u.whave=u.wsize):(f=u.wsize-u.wnext,f>r&&(f=r),u.window.set(t.subarray(i-r,i-r+f),u.wnext),r-=f,r?(u.window.set(t.subarray(i-r,i),0),u.wnext=r,u.whave=u.wsize):(u.wnext+=f,u.wnext===u.wsize&&(u.wnext=0),u.whave<u.wsize&&(u.whave+=f))),0},dv=(n,t)=>{let i,l,rt,c,tt,o,w,e,u,et,v,s,ot,lt,y=0,a,d,nt,g,st,ht,b,it;const k=new Uint8Array(4);let ft,ut;const at=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!n||!n.state||!n.output||!n.input&&n.avail_in!==0)return h;i=n.state;i.mode===p&&(i.mode=ru);tt=n.next_out;rt=n.output;w=n.avail_out;c=n.next_in;l=n.input;o=n.avail_in;e=i.hold;u=i.bits;et=o;v=w;it=ct;n:for(;;)switch(i.mode){case ve:if(i.wrap===0){i.mode=ru;break}while(u<16){if(o===0)break n;o--;e+=l[c++]<<u;u+=8}if(i.wrap&2&&e===35615){i.check=0;k[0]=e&255;k[1]=e>>>8&255;i.check=f(i.check,k,2,0);e=0;u=0;i.mode=ye;break}if(i.flags=0,i.head&&(i.head.done=!1),!(i.wrap&1)||(((e&255)<<8)+(e>>8))%31){n.msg="incorrect header check";i.mode=r;break}if((e&15)!==ae){n.msg="unknown compression method";i.mode=r;break}if(e>>>=4,u-=4,b=(e&15)+8,i.wbits===0)i.wbits=b;else if(b>i.wbits){n.msg="invalid window size";i.mode=r;break}i.dmax=1<<i.wbits;n.adler=i.check=1;i.mode=e&512?to:p;e=0;u=0;break;case ye:while(u<16){if(o===0)break n;o--;e+=l[c++]<<u;u+=8}if(i.flags=e,(i.flags&255)!==ae){n.msg="unknown compression method";i.mode=r;break}if(i.flags&57344){n.msg="unknown header flags set";i.mode=r;break}i.head&&(i.head.text=e>>8&1);i.flags&512&&(k[0]=e&255,k[1]=e>>>8&255,i.check=f(i.check,k,2,0));e=0;u=0;i.mode=pe;case pe:while(u<32){if(o===0)break n;o--;e+=l[c++]<<u;u+=8}i.head&&(i.head.time=e);i.flags&512&&(k[0]=e&255,k[1]=e>>>8&255,k[2]=e>>>16&255,k[3]=e>>>24&255,i.check=f(i.check,k,4,0));e=0;u=0;i.mode=we;case we:while(u<16){if(o===0)break n;o--;e+=l[c++]<<u;u+=8}i.head&&(i.head.xflags=e&255,i.head.os=e>>8);i.flags&512&&(k[0]=e&255,k[1]=e>>>8&255,i.check=f(i.check,k,2,0));e=0;u=0;i.mode=be;case be:if(i.flags&1024){while(u<16){if(o===0)break n;o--;e+=l[c++]<<u;u+=8}i.length=e;i.head&&(i.head.extra_len=e);i.flags&512&&(k[0]=e&255,k[1]=e>>>8&255,i.check=f(i.check,k,2,0));e=0;u=0}else i.head&&(i.head.extra=null);i.mode=ke;case ke:if(i.flags&1024&&(s=i.length,s>o&&(s=o),s&&(i.head&&(b=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Uint8Array(i.head.extra_len)),i.head.extra.set(l.subarray(c,c+s),b)),i.flags&512&&(i.check=f(i.check,l,s,c)),o-=s,c+=s,i.length-=s),i.length))break n;i.length=0;i.mode=de;case de:if(i.flags&2048){if(o===0)break n;s=0;do b=l[c+s++],i.head&&b&&i.length<65536&&(i.head.name+=String.fromCharCode(b));while(b&&s<o);if(i.flags&512&&(i.check=f(i.check,l,s,c)),o-=s,c+=s,b)break n}else i.head&&(i.head.name=null);i.length=0;i.mode=ge;case ge:if(i.flags&4096){if(o===0)break n;s=0;do b=l[c+s++],i.head&&b&&i.length<65536&&(i.head.comment+=String.fromCharCode(b));while(b&&s<o);if(i.flags&512&&(i.check=f(i.check,l,s,c)),o-=s,c+=s,b)break n}else i.head&&(i.head.comment=null);i.mode=no;case no:if(i.flags&512){while(u<16){if(o===0)break n;o--;e+=l[c++]<<u;u+=8}if(e!==(i.check&65535)){n.msg="header crc mismatch";i.mode=r;break}e=0;u=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0);n.adler=i.check=0;i.mode=p;break;case to:while(u<32){if(o===0)break n;o--;e+=l[c++]<<u;u+=8}n.adler=i.check=po(e);e=0;u=0;i.mode=ur;case ur:if(i.havedict===0)return n.next_out=tt,n.avail_out=w,n.next_in=c,n.avail_in=o,i.hold=e,i.bits=u,cv;n.adler=i.check=1;i.mode=p;case p:if(t===sv||t===rr)break n;case ru:if(i.last){e>>>=u&7;u-=u&7;i.mode=fu;break}while(u<3){if(o===0)break n;o--;e+=l[c++]<<u;u+=8}i.last=e&1;e>>>=1;u-=1;switch(e&3){case 0:i.mode=io;break;case 1:if(kv(i),i.mode=fr,t===rr){e>>>=2;u-=2;break n}break;case 2:i.mode=uo;break;case 3:n.msg="invalid block type";i.mode=r}e>>>=2;u-=2;break;case io:for(e>>>=u&7,u-=u&7;u<32;){if(o===0)break n;o--;e+=l[c++]<<u;u+=8}if((e&65535)!=(e>>>16^65535)){n.msg="invalid stored block lengths";i.mode=r;break}if(i.length=e&65535,e=0,u=0,i.mode=uu,t===rr)break n;case uu:i.mode=ro;case ro:if(s=i.length,s){if(s>o&&(s=o),s>w&&(s=w),s===0)break n;rt.set(l.subarray(c,c+s),tt);o-=s;c+=s;w-=s;tt+=s;i.length-=s;break}i.mode=p;break;case uo:while(u<14){if(o===0)break n;o--;e+=l[c++]<<u;u+=8}if(i.nlen=(e&31)+257,e>>>=5,u-=5,i.ndist=(e&31)+1,e>>>=5,u-=5,i.ncode=(e&15)+4,e>>>=4,u-=4,i.nlen>286||i.ndist>30){n.msg="too many length or distance symbols";i.mode=r;break}i.have=0;i.mode=fo;case fo:while(i.have<i.ncode){while(u<3){if(o===0)break n;o--;e+=l[c++]<<u;u+=8}i.lens[at[i.have++]]=e&7;e>>>=3;u-=3}while(i.have<19)i.lens[at[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,ft={bits:i.lenbits},it=bt(ov,i.lens,0,19,i.lencode,0,i.work,ft),i.lenbits=ft.bits,it){n.msg="invalid code lengths set";i.mode=r;break}i.have=0;i.mode=eo;case eo:while(i.have<i.nlen+i.ndist){for(;;){if(y=i.lencode[e&(1<<i.lenbits)-1],a=y>>>24,d=y>>>16&255,nt=y&65535,a<=u)break;if(o===0)break n;o--;e+=l[c++]<<u;u+=8}if(nt<16)e>>>=a,u-=a,i.lens[i.have++]=nt;else{if(nt===16){for(ut=a+2;u<ut;){if(o===0)break n;o--;e+=l[c++]<<u;u+=8}if(e>>>=a,u-=a,i.have===0){n.msg="invalid bit length repeat";i.mode=r;break}b=i.lens[i.have-1];s=3+(e&3);e>>>=2;u-=2}else if(nt===17){for(ut=a+3;u<ut;){if(o===0)break n;o--;e+=l[c++]<<u;u+=8}e>>>=a;u-=a;b=0;s=3+(e&7);e>>>=3;u-=3}else{for(ut=a+7;u<ut;){if(o===0)break n;o--;e+=l[c++]<<u;u+=8}e>>>=a;u-=a;b=0;s=11+(e&127);e>>>=7;u-=7}if(i.have+s>i.nlen+i.ndist){n.msg="invalid bit length repeat";i.mode=r;break}while(s--)i.lens[i.have++]=b}}if(i.mode===r)break;if(i.lens[256]===0){n.msg="invalid code -- missing end-of-block";i.mode=r;break}if(i.lenbits=9,ft={bits:i.lenbits},it=bt(oe,i.lens,0,i.nlen,i.lencode,0,i.work,ft),i.lenbits=ft.bits,it){n.msg="invalid literal/lengths set";i.mode=r;break}if(i.distbits=6,i.distcode=i.distdyn,ft={bits:i.distbits},it=bt(se,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,ft),i.distbits=ft.bits,it){n.msg="invalid distances set";i.mode=r;break}if(i.mode=fr,t===rr)break n;case fr:i.mode=er;case er:if(o>=6&&w>=258){n.next_out=tt;n.avail_out=w;n.next_in=c;n.avail_in=o;i.hold=e;i.bits=u;ie(n,v);tt=n.next_out;rt=n.output;w=n.avail_out;c=n.next_in;l=n.input;o=n.avail_in;e=i.hold;u=i.bits;i.mode===p&&(i.back=-1);break}for(i.back=0;;){if(y=i.lencode[e&(1<<i.lenbits)-1],a=y>>>24,d=y>>>16&255,nt=y&65535,a<=u)break;if(o===0)break n;o--;e+=l[c++]<<u;u+=8}if(d&&(d&240)==0){for(g=a,st=d,ht=nt;;){if(y=i.lencode[ht+((e&(1<<g+st)-1)>>g)],a=y>>>24,d=y>>>16&255,nt=y&65535,g+a<=u)break;if(o===0)break n;o--;e+=l[c++]<<u;u+=8}e>>>=g;u-=g;i.back+=g}if(e>>>=a,u-=a,i.back+=a,i.length=nt,d===0){i.mode=lo;break}if(d&32){i.back=-1;i.mode=p;break}if(d&64){n.msg="invalid literal/length code";i.mode=r;break}i.extra=d&15;i.mode=oo;case oo:if(i.extra){for(ut=i.extra;u<ut;){if(o===0)break n;o--;e+=l[c++]<<u;u+=8}i.length+=e&(1<<i.extra)-1;e>>>=i.extra;u-=i.extra;i.back+=i.extra}i.was=i.length;i.mode=so;case so:for(;;){if(y=i.distcode[e&(1<<i.distbits)-1],a=y>>>24,d=y>>>16&255,nt=y&65535,a<=u)break;if(o===0)break n;o--;e+=l[c++]<<u;u+=8}if((d&240)==0){for(g=a,st=d,ht=nt;;){if(y=i.distcode[ht+((e&(1<<g+st)-1)>>g)],a=y>>>24,d=y>>>16&255,nt=y&65535,g+a<=u)break;if(o===0)break n;o--;e+=l[c++]<<u;u+=8}e>>>=g;u-=g;i.back+=g}if(e>>>=a,u-=a,i.back+=a,d&64){n.msg="invalid distance code";i.mode=r;break}i.offset=nt;i.extra=d&15;i.mode=ho;case ho:if(i.extra){for(ut=i.extra;u<ut;){if(o===0)break n;o--;e+=l[c++]<<u;u+=8}i.offset+=e&(1<<i.extra)-1;e>>>=i.extra;u-=i.extra;i.back+=i.extra}if(i.offset>i.dmax){n.msg="invalid distance too far back";i.mode=r;break}i.mode=co;case co:if(w===0)break n;if(s=v-w,i.offset>s){if(s=i.offset-s,s>i.whave&&i.sane){n.msg="invalid distance too far back";i.mode=r;break}s>i.wnext?(s-=i.wnext,ot=i.wsize-s):ot=i.wnext-s;s>i.length&&(s=i.length);lt=i.window}else lt=rt,ot=tt-i.offset,s=i.length;s>w&&(s=w);w-=s;i.length-=s;do rt[tt++]=lt[ot++];while(--s);i.length===0&&(i.mode=er);break;case lo:if(w===0)break n;rt[tt++]=i.length;w--;i.mode=er;break;case fu:if(i.wrap){while(u<32){if(o===0)break n;o--;e|=l[c++]<<u;u+=8}if(v-=w,n.total_out+=v,i.total+=v,v&&(n.adler=i.check=i.flags?f(i.check,rt,v,tt-v):vt(i.check,rt,v,tt-v)),v=w,(i.flags?e:po(e))!==i.check){n.msg="incorrect data check";i.mode=r;break}e=0;u=0}i.mode=ao;case ao:if(i.wrap&&i.flags){while(u<32){if(o===0)break n;o--;e+=l[c++]<<u;u+=8}if(e!==(i.total&4294967295)){n.msg="incorrect length check";i.mode=r;break}e=0;u=0}i.mode=vo;case vo:it=hv;break n;case r:it=ce;break n;case yo:return le;case av:default:return h}return n.next_out=tt,n.avail_out=w,n.next_in=c,n.avail_in=o,i.hold=e,i.bits=u,(i.wsize||v!==n.avail_out&&i.mode<r&&(i.mode<fu||t!==he))&&ts(n,n.output,n.next_out,v-n.avail_out),et-=n.avail_in,v-=n.avail_out,n.total_in+=et,n.total_out+=v,i.total+=v,i.wrap&&v&&(n.adler=i.check=i.flags?f(i.check,rt,v,n.next_out-v):vt(i.check,rt,v,n.next_out-v)),n.data_type=i.bits+(i.last?64:0)+(i.mode===p?128:0)+(i.mode===fr||i.mode===uu?256:0),(et===0&&v===0||t===he)&&it===ct&&(it=lv),it},gv=n=>{if(!n||!n.state)return h;let t=n.state;return t.window&&(t.window=null),n.state=null,ct},ny=(n,t)=>{if(!n||!n.state)return h;const i=n.state;return(i.wrap&2)==0?h:(i.head=t,t.done=!1,ct)},ty=(n,t)=>{const u=t.length;let i,r,f;return!n||!n.state?h:(i=n.state,i.wrap!==0&&i.mode!==ur)?h:i.mode===ur&&(r=1,r=vt(r,t,u,0),r!==i.check)?ce:(f=ts(n,t,u,u),f)?(i.mode=yo,le):(i.havedict=1,ct)};var iy=bo,ry=ko,uy=wo,fy=bv,ey=go,oy=dv,sy=gv,hy=ny,cy=ty,w={inflateReset:iy,inflateReset2:ry,inflateResetKeep:uy,inflateInit:fy,inflateInit2:ey,inflate:oy,inflateEnd:sy,inflateGetHeader:hy,inflateSetDictionary:cy,inflateInfo:"pako inflate (from Nodeca project)"};is=ly;const rs=Object.prototype.toString,{Z_NO_FLUSH:ay,Z_FINISH:vy,Z_OK:li,Z_STREAM_END:su,Z_NEED_DICT:hu,Z_STREAM_ERROR:yy,Z_DATA_ERROR:us,Z_MEM_ERROR:py}=ft;ai.prototype.push=function(n,t){const i=this.strm,f=this.options.chunkSize,e=this.options.dictionary;let r,u,o;if(this.ended)return!1;for(u=t===~~t?t:t===!0?vy:ay,i.input=rs.call(n)==="[object ArrayBuffer]"?new Uint8Array(n):n,i.next_in=0,i.avail_in=i.input.length;;){for(i.avail_out===0&&(i.output=new Uint8Array(f),i.next_out=0,i.avail_out=f),r=w.inflate(i,u),r===hu&&e&&(r=w.inflateSetDictionary(i,e),r===li?r=w.inflate(i,u):r===us&&(r=hu));i.avail_in>0&&r===su&&i.state.wrap>0&&n[i.next_in]!==0;)w.inflateReset(i),r=w.inflate(i,u);switch(r){case yy:case us:case hu:case py:this.onEnd(r);return this.ended=!0,!1}if(o=i.avail_out,i.next_out&&(i.avail_out===0||r===su))if(this.options.to==="string"){let n=hi.utf8border(i.output,i.next_out),t=i.next_out-n,r=hi.buf2string(i.output,n);i.next_out=t;i.avail_out=f-t;t&&i.output.set(i.output.subarray(n,n+t),0);this.onData(r)}else this.onData(i.output.length===i.next_out?i.output:i.output.subarray(0,i.next_out));if(r!==li||o!==0){if(r===su){r=w.inflateEnd(this.strm);this.onEnd(r);return this.ended=!0,!0}if(i.avail_in===0)break}}return!0};ai.prototype.onData=function(n){this.chunks.push(n)};ai.prototype.onEnd=function(n){n===li&&(this.result=this.options.to==="string"?this.chunks.join(""):nr.flattenChunks(this.chunks));this.chunks=[];this.err=n;this.msg=this.strm.msg};var by=ai,ky=cu,dy=wy,gy=cu,np=ft,tp={Inflate:by,inflate:ky,inflateRaw:dy,ungzip:gy,constants:np};const{Deflate:ip,deflate:rp,deflateRaw:up,gzip:fp}=nv,{Inflate:ep,inflate:op,inflateRaw:sp,ungzip:hp}=tp;var fs=ip,es=rp,os=up,ss=fp,hs=ep,cs=op,ls=sp,as=hp,vs=ft,cp={Deflate:fs,deflate:es,deflateRaw:os,gzip:ss,Inflate:hs,inflate:cs,inflateRaw:ls,ungzip:as,constants:vs};n.Deflate=fs;n.Inflate=hs;n.constants=vs;n.default=cp;n.deflate=es;n.deflateRaw=os;n.gzip=ss;n.inflate=cs;n.inflateRaw=ls;n.ungzip=as;Object.defineProperty(n,"__esModule",{value:!0})});window.GoogleDriveService=new GoogleDriveService;$(document).ready(function(){registerErrorPublishingFormHandler({})});window.uploadModelId=createUUID();const btnWork=$("#workButton");const fileUploaderInput=$("#uploader-input"),fileUploaderParent=$("#uploader-parent"),fileUploaderForm=$("#uploader-frm"),urlUploader=$("#uploader-url").UrlUploader(fileUploaderForm,()=>{hideAlert()});$("input[name='idUpload']").val(window.uploadModelId);const fileUploader=new $.ImagingFileUploader(fileUploaderInput,fileUploaderParent,()=>{hideAlert(),urlUploader.hideUrlPanel(),fileUploaderForm.submit()});fileUploader.canSelect=!0;fileUploader.canMoveItems=!1;registerFileUpload(fileUploaderForm,fileUploaderInput,fileUploader);UploadFilesFromPreviousOperation(fileUploaderInput,fileUploader);const slider=$("#slider"),slideShow=new Slider(slider);fileUploader.itemAdditionalContentProvider=n=>(showLoader(),n.processingState=new MultipleProcessingState(()=>{n.hasMaskingResult=!1,n.showProgress(),updateWorkBtnState()},()=>{n.hasMaskingResult=!0,n.hideProgress(),updateWorkBtnState()}),n.updateImageInfo({controllerName:"Common",uploadId:window.uploadModelId,onSuccess:t=>{n.imageInfo=t;const i=t.PageType==="MultiPage"||t.PageType==="Animation"?t.NumPages:1;n.slideController=new PreviewSlideContentController({uploadId:window.uploadModelId,fileName:n.fileName,viewerFlags:"hideAnimationPreview",hasAlpha:t.HasAlpha&&t.ImageType==="Bitmap",hideCommonPage:!0,numPages:i,contentProviderFactory:(n,t)=>new BackgroundOffSlideContent(n,t),onError:t=>{n.setError(t),showReportWindow({idUpload:window.uploadModelId,fileName:n.uploaderItem.fileName,msg:Resources.BackgroundOffPreviewError,explanation:Resources.ServerErrorExplanation,data1:t})},onBusy:t=>{t?n.processingState.startProcessing():n.processingState.stopProcessing()}});n.slide=new ImagingSlide(n.slideController,i);n.slide.uploaderItem=n;slideShow.add(n.slide,fileUploader.getNumItemsBefore(n,n=>n.slide),n.isSelected());n.onRemovedCallback=()=>{slideShow.remove(slideShow.elements.indexOf(n.slide))};hideLoader();requestImagingFormats({method:window.Method,sourceFormat:t.Format,onSuccess:t=>{n.imageInfo.ToFormats=t.toFormats.map(n=>n.toUpperCase()),updateWorkBtnState()}})},cannotReadMsg:Resources.imagingCannotReadMsg,onError:(t,i)=>{hideLoader(),n.setError(t),needShowReportWindow(i)&&showReportWindow({idUpload:window.uploadModelId,fileName:n.fileName,msg:Resources.imagingCannotReadMsg,explanation:Resources.ServerErrorExplanation,data1:i,data2:t})}}),null);fileUploader.onRemoveItemCallback=n=>{if(n.slideController){const t=[],i=n.slideController.getOptions();i&&t.push(i);const r=n.slideController.getPageOptions();r&&r.forEach(n=>{t.push(n)});t.forEach(n=>{runImageMasking({removeSession:!0,sessionId:n.SessionId})})}};fileUploaderInput.on("uploader:selected",function(n){n.item.slide&&(slideShow.selectSlide(slideShow.elements.indexOf(n.item.slide)),n.item.slide.onDisplayed())});slider.on("slider:selected",function(n){n.item&&(n.item.uploaderItem.setSelected(),n.item.onDisplayed())});slider.on("slider:selecting",function(n){n.oldItem&&n.oldItem.setEnabled(!1);n.newItem&&n.newItem.setEnabled()});fileUploader.sizeChangedCallback=n=>{updateWorkBtnState(),n?$("#WorkPlaceHolder").removeClass("hidden"):$("#WorkPlaceHolder").addClass("hidden")};btnWork.click(n=>{if(n.preventDefault(),fileUploader.items.length===0){showAlert(Resources.FileSelectMessage);return}hideAlert();btnWork.addClass("hidden");slideShow.hide();$("#WorkPlaceHolder").addClass("hidden");const r=$("#format").val(),t=fileUploader.items.reduce((n,t)=>{const r=t.slideController,i=r.getOptions();if(i)return i.uploaderItem=t,n.push(i),n;const u=r.getPageOptions();return u&&u.forEach(i=>{i.uploaderItem=t,n.push(i)}),n},[]);var i=t.length;t.forEach(n=>{n.uploaderItem.processingState.startProcessing();const u=n.pageIndex?n.pageIndex+1:1;runImageMasking({withProgress:!0,idUpload:window.uploadModelId,fileName:n.uploaderItem.fileName,page:u,destFormat:r,getResult:!0,sessionId:n.SessionId,backgroundColor:n.BackgroundColor,smooth:n.Smooth}).done(r=>{r.IsSuccess?(n.Result=r.Payload,i--,i===0&&onGettingAllResults(t.map(n=>n.Result))):(gaEvent("Processing","error"),showReportWindow({idUpload:window.uploadModelId,fileName:n.uploaderItem.fileName,msg:Resources.BackgroundOffApplyMaskError,explanation:Resources.ServerErrorExplanation,data1:`Page index: ${u}`,data2:r.Error}))}).fail(t=>{handleAjaxError(t,()=>{btnWork.click()})||(gaEvent("Processing","error"),showReportWindow({idUpload:window.uploadModelId,fileName:n.uploaderItem.fileName,msg:Resources.BackgroundOffApplyMaskError,explanation:Resources.ServerErrorExplanation,data1:`Page index: ${u}`,data2:t.Error?t.Error:t}))}).always(()=>{n.uploaderItem.processingState.stopProcessing()})});gaEvent("Processing","sent")});initalizeGoogleUploadFromButton(fileUploader);initalizeDropboxUploadFromButton(fileUploader);